import './polyfills.server.mjs';
import{$ as Qe,$a as Kr,A as Es,Aa as $S,Ab as Un,B as Ts,Ba as GS,Bb as en,C as df,Ca as vf,Cb as rC,D as Is,Da as Ue,Db as Ms,E as PS,Ea as WS,Eb as tn,F as dc,Fa as ha,Fb as iC,G as Fn,Ga as re,Gb as sC,H as hf,Ha as Sf,Hb as oC,I as NS,Ia as D,Ib as aC,J as ff,Ja as O,Jb as lC,K as pf,Ka as ue,Kb as cC,L as mf,La as St,Lb as uC,M as ot,Ma as Ce,Mb as dC,N as gf,Na as $e,Nb as hC,O as FS,Oa as Zt,Ob as fC,P as at,Pa as U,Q as rt,Qa as Dt,R as pr,Ra as Xe,S as he,Sa as gr,T as Ln,Ta as yr,U as LS,Ua as vr,V as fe,Va as Sr,W as yf,Wa as Je,X as ae,Xa as qi,Y as ee,Ya as hc,Z as Xt,Za as Cr,_ as VS,_a as HS,a as IS,aa as Vn,ab as fc,b as of,ba as lt,bb as pc,c as zr,ca as As,cb as mc,d as af,da as la,db as KS,e as lf,ea as ca,eb as gc,f as Yt,fa as Bn,fb as Cf,g as Rt,ga as Gr,gb as _f,h as AS,ha as Re,hb as QS,i as RS,ia as De,ib as yc,j as jr,ja as Wr,jb as bf,k as $r,ka as BS,kb as wf,l as Ui,la as Hr,lb as fa,m as nt,ma as US,mb as Qr,n as J,na as Ye,nb as Os,o as aa,oa as zt,ob as _r,p as DS,pa as ua,pb as YS,q as OS,qa as Rs,qb as XS,r as le,ra as mr,rb as Ef,s as uc,sa as qS,sb as JS,t as qt,ta as B,tb as ZS,u as cf,ua as G,ub as pa,v as MS,va as zS,w as uf,wa as da,wb as eC,x as xS,xa as jS,xb as tC,y as kS,ya as Ds,yb as ma,z as Nn,za as Jt,zb as nC}from"./chunk-LWYMROJT.mjs";import{a as pC,b as mC,c as Tf,d as gC,e as yC,f as vC,g as If,h as SC,i as CC,j as nn,k as ga,l as br,m as vc,n as ya,o as Af,p as _C,q as Sc,r as va,s as Cc,t as Ot,u as vn,v as ED}from"./chunk-DKQMDCC4.mjs";import{a as q,b as Ae,c as be,f as I,h as sf,j as A}from"./chunk-EXD34EPT.mjs";var Se=I(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=on.DEFAULT_MAX_SEND_MESSAGE_LENGTH=on.Propagate=on.LogVerbosity=on.Status=void 0;var pb=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(pb||(on.Status=pb={})),mb=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(mb||(on.LogVerbosity=mb={})),gb=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(gb||(on.Propagate=gb={}));on.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;on.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Up=I((q9,ck)=>{ck.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var qe=I(Mt=>{"use strict";var qp,zp,jp,$p;Object.defineProperty(Mt,"__esModule",{value:!0});Mt.isTracerEnabled=Mt.trace=Mt.log=Mt.setLoggerVerbosity=Mt.setLogger=Mt.getLogger=void 0;var ai=Se(),uk=be("process"),dk=Up().version,hk={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Yi=hk,Zs=ai.LogVerbosity.ERROR,fk=(zp=(qp=process.env.GRPC_NODE_VERBOSITY)!==null&&qp!==void 0?qp:process.env.GRPC_VERBOSITY)!==null&&zp!==void 0?zp:"";switch(fk.toUpperCase()){case"DEBUG":Zs=ai.LogVerbosity.DEBUG;break;case"INFO":Zs=ai.LogVerbosity.INFO;break;case"ERROR":Zs=ai.LogVerbosity.ERROR;break;case"NONE":Zs=ai.LogVerbosity.NONE;break;default:}var pk=()=>Yi;Mt.getLogger=pk;var mk=n=>{Yi=n};Mt.setLogger=mk;var gk=n=>{Zs=n};Mt.setLoggerVerbosity=gk;var yk=(n,...e)=>{let t;if(n>=Zs){switch(n){case ai.LogVerbosity.DEBUG:t=Yi.debug;break;case ai.LogVerbosity.INFO:t=Yi.info;break;case ai.LogVerbosity.ERROR:t=Yi.error;break}t||(t=Yi.error),t&&t.bind(Yi)(...e)}};Mt.log=yk;var vk=($p=(jp=process.env.GRPC_NODE_TRACE)!==null&&jp!==void 0?jp:process.env.GRPC_TRACE)!==null&&$p!==void 0?$p:"",Gp=new Set,yb=new Set;for(let n of vk.split(","))n.startsWith("-")?yb.add(n.substring(1)):Gp.add(n);var Sk=Gp.has("all");function Ck(n,e,t){vb(e)&&(0,Mt.log)(n,new Date().toISOString()+" | v"+dk+" "+uk.pid+" | "+e+" | "+t)}Mt.trace=Ck;function vb(n){return!yb.has(n)&&(Sk||Gp.has(n))}Mt.isTracerEnabled=vb});var cu=I(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.getErrorCode=eo.getErrorMessage=void 0;function _k(n){return n instanceof Error?n.message:String(n)}eo.getErrorMessage=_k;function bk(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}eo.getErrorCode=bk});var Ft=I(du=>{"use strict";Object.defineProperty(du,"__esModule",{value:!0});du.Metadata=void 0;var wk=qe(),Ek=Se(),Tk=cu(),Ik=/^[0-9a-z_.-]+$/,Ak=/^[ -~]*$/;function Rk(n){return Ik.test(n)}function Dk(n){return Ak.test(n)}function Cb(n){return n.endsWith("-bin")}function Ok(n){return!n.startsWith("grpc-")}function uu(n){return n.toLowerCase()}function Sb(n,e){if(!Rk(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(Cb(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!Dk(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Wp=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=uu(e),Sb(e,t),this.internalRepr.set(e,[t])}add(e,t){e=uu(e),Sb(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=uu(e),this.internalRepr.delete(e)}get(e){return e=uu(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(Mk);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{Cb(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(Ok(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,Tk.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,wk.log)(Ek.LogVerbosity.ERROR,o)}}return t}};du.Metadata=Wp;var Mk=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Xp=I(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.CallCredentials=void 0;var Yp=Ft();function xk(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var to=class n{static createFromMetadataGenerator(e){return new Kp(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;xk(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Yp.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new Qp}};hu.CallCredentials=to;var Hp=class n extends to{constructor(e){super(),this.creds=e}generateMetadata(e){return A(this,null,function*(){let t=new Yp.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},Kp=class n extends to{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Hp([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},Qp=class n extends to{generateMetadata(e){return Promise.resolve(new Yp.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Zp=I(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.getDefaultRootsData=no.CIPHER_SUITES=void 0;var kk=be("fs");no.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var _b=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Jp=null;function Pk(){return _b?(Jp===null&&(Jp=kk.readFileSync(_b)),Jp):null}no.getDefaultRootsData=Pk});var mu=I(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.ChannelCredentials=void 0;var Nk=be("tls"),Fk=Xp(),bb=Zp();function em(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var ro=class{constructor(e){this.callCredentials=e||Fk.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(em(e,"Root certificate"),em(t,"Private key"),em(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,Nk.createSecureContext)({ca:(s=e??(0,bb.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:bb.CIPHER_SUITES});return new fu(o,i??{})}static createFromSecureContext(e,t){return new fu(e,t??{})}static createInsecure(){return new tm}};pu.ChannelCredentials=ro;var tm=class n extends ro{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},fu=class n extends ro{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new nm(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},nm=class n extends ro{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var ci=I(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.validateLoadBalancingConfig=Ct.getFirstUsableConfig=Ct.isLoadBalancerNameRegistered=Ct.createLoadBalancer=Ct.registerDefaultLoadBalancerType=Ct.registerLoadBalancerType=Ct.createChildChannelControlHelper=void 0;function Lk(n,e){var t,r,i,s,o,a,l,c,u,h;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(h=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&h!==void 0?h:n.removeChannelzChild.bind(n)}}Ct.createChildChannelControlHelper=Lk;var li={},rm=null;function Vk(n,e,t){li[n]={LoadBalancer:e,LoadBalancingConfig:t}}Ct.registerLoadBalancerType=Vk;function Bk(n){rm=n}Ct.registerDefaultLoadBalancerType=Bk;function Uk(n,e){let t=n.getLoadBalancerName();return t in li?new li[t].LoadBalancer(e):null}Ct.createLoadBalancer=Uk;function qk(n){return n in li}Ct.isLoadBalancerNameRegistered=qk;function zk(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in li)return t;return e&&rm?new li[rm].LoadBalancingConfig:null}Ct.getFirstUsableConfig=zk;function jk(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in li)return li[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Ct.validateLoadBalancingConfig=jk});var im=I(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.extractAndSelectServiceConfig=ui.validateServiceConfig=ui.validateRetryThrottling=void 0;var $k=be("os"),gu=Se(),Gk=ci(),yu=/^\d+(\.\d{1,9})?s$/,Wk="node";function Hk(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function Kk(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!yu.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!yu.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(gu.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(gu.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function Qk(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!yu.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(gu.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(gu.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function Yk(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(Hk(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&yu.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=Kk(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=Qk(n.hedgingPolicy));return t}function wb(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}ui.validateRetryThrottling=wb;function Eb(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,Gk.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(Yk(r));"retryThrottling"in n&&(e.retryThrottling=wb(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}ui.validateServiceConfig=Eb;function Xk(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:Eb(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function Jk(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=Xk(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===$k.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===Wk&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function Zk(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return Jk(i,e)}return null}ui.extractAndSelectServiceConfig=Zk});var an=I(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});vu.ConnectivityState=void 0;var Tb=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(Tb||(vu.ConnectivityState=Tb={}))});var Gt=I(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.uriToString=di.splitHostPort=di.parseUri=void 0;var eP=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function tP(n){let e=eP.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}di.parseUri=tP;var Ib=/^\d+$/;function nP(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return Ib.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?Ib.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}di.splitHostPort=nP;function rP(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}di.uriToString=rP});var Hn=I(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.mapUriDefaultScheme=ln.getDefaultAuthority=ln.createResolver=ln.registerDefaultScheme=ln.registerResolver=void 0;var om=Gt(),io={},sm=null;function iP(n,e){io[n]=e}ln.registerResolver=iP;function sP(n){sm=n}ln.registerDefaultScheme=sP;function oP(n,e,t){if(n.scheme!==void 0&&n.scheme in io)return new io[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,om.uriToString)(n)}`)}ln.createResolver=oP;function aP(n){if(n.scheme!==void 0&&n.scheme in io)return io[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,om.uriToString)(n)}`)}ln.getDefaultAuthority=aP;function lP(n){return n.scheme===void 0||!(n.scheme in io)?sm!==null?{scheme:sm,authority:void 0,path:(0,om.uriToString)(n)}:null:n}ln.mapUriDefaultScheme=lP});var fi=I(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.QueuePicker=hi.UnavailablePicker=hi.PickResultType=void 0;var cP=Ft(),uP=Se(),Su=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Su||(hi.PickResultType=Su={})),am=class{constructor(e){this.status=Object.assign({code:uP.Status.UNAVAILABLE,details:"No connection established",metadata:new cP.Metadata},e)}pick(e){return{pickResultType:Su.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};hi.UnavailablePicker=am;var lm=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Su.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};hi.QueuePicker=lm});var tl=I(Cu=>{"use strict";Object.defineProperty(Cu,"__esModule",{value:!0});Cu.BackoffTimeout=void 0;var dP=1e3,hP=1.6,fP=12e4,pP=.2;function mP(n,e){return Math.random()*(e-n)+n}var cm=class{constructor(e,t){this.callback=e,this.initialDelay=dP,this.multiplier=hP,this.maxDelay=fP,this.jitter=pP,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+mP(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Cu.BackoffTimeout=cm});var bu=I(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.ChildLoadBalancerHandler=void 0;var gP=ci(),yP=an(),vP="child_load_balancer_helper",um=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===yP.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,gP.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return vP}};_u.ChildLoadBalancerHandler=um});var Rb=I(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});wu.ResolvingLoadBalancer=void 0;var SP=ci(),CP=im(),Lt=an(),_P=Hn(),so=fi(),bP=tl(),dm=Se(),wP=Ft(),EP=qe(),TP=Se(),IP=Gt(),AP=bu(),RP="resolving_load_balancer";function Ab(n){EP.trace(TP.LogVerbosity.DEBUG,RP,n)}var DP=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function OP(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function MP(n,e,t,r){for(let i of t)if(OP(n,e,i,r))return i;return null}function xP(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of DP){let u=MP(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:dm.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:dm.Status.OK,dynamicFilterFactories:[]}}}var hm=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Lt.ConnectivityState.IDLE,this.latestChildPicker=new so.QueuePicker(this),this.currentState=Lt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,CP.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Lt.ConnectivityState.IDLE,new so.QueuePicker(this)),this.childLoadBalancer=new AP.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Ab("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,_P.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,h)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let v=null;l===null?c===null?(this.previousServiceConfig=null,v=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):v=this.previousServiceConfig:(v=l,this.previousServiceConfig=l);let b=(f=v?.loadBalancingConfig)!==null&&f!==void 0?f:[],E=(0,SP.getFirstUsableConfig)(b,!0);if(E===null){this.handleResolutionFailure({code:dm.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new wP.Metadata});return}this.childLoadBalancer.updateAddressList(a,E,h);let w=v??this.defaultServiceConfig;this.onSuccessfulResolution(w,u??xP(w))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new bP.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Lt.ConnectivityState.IDLE&&this.updateState(Lt.ConnectivityState.CONNECTING,new so.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){Ab((0,IP.uriToString)(this.target)+" "+Lt.ConnectivityState[this.currentState]+" -> "+Lt.ConnectivityState[e]),e===Lt.ConnectivityState.IDLE&&(t=new so.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Lt.ConnectivityState.IDLE&&(this.updateState(Lt.ConnectivityState.TRANSIENT_FAILURE,new so.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Lt.ConnectivityState.IDLE||this.currentState===Lt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Lt.ConnectivityState.IDLE,this.latestChildPicker=new so.QueuePicker(this),this.currentState=Lt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};wu.ResolvingLoadBalancer=hm});var Db=I(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.channelOptionsEqual=oo.recognizedOptions=void 0;oo.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function kP(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}oo.channelOptionsEqual=kP});var Qn=I(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.stringToSubchannelAddress=Kn.subchannelAddressToString=Kn.subchannelAddressEqual=Kn.isTcpSubchannelAddress=void 0;var PP=be("net");function nl(n){return"port"in n}Kn.isTcpSubchannelAddress=nl;function NP(n,e){return!n&&!e?!0:!n||!e?!1:nl(n)?nl(e)&&n.host===e.host&&n.port===e.port:!nl(e)&&n.path===e.path}Kn.subchannelAddressEqual=NP;function FP(n){return nl(n)?n.host+":"+n.port:n.path}Kn.subchannelAddressToString=FP;var LP=443;function VP(n,e){return(0,PP.isIP)(n)?{host:n,port:e??LP}:{path:n}}Kn.stringToSubchannelAddress=VP});var Eu=I(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.addAdminServicesToServer=ao.registerAdminService=void 0;var Ob=[];function BP(n,e){Ob.push({getServiceDefinition:n,getHandlers:e})}ao.registerAdminService=BP;function UP(n){for(let{getServiceDefinition:e,getHandlers:t}of Ob)n.addService(e(),t())}ao.addAdminServicesToServer=UP});var Mb=I(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.ClientDuplexStreamImpl=cn.ClientWritableStreamImpl=cn.ClientReadableStreamImpl=cn.ClientUnaryCallImpl=cn.callErrorFromStatus=void 0;var qP=be("events"),ym=be("stream"),rl=Se();function zP(n,e){let t=`${n.code} ${rl.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}cn.callErrorFromStatus=zP;var fm=class extends qP.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(rl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};cn.ClientUnaryCallImpl=fm;var pm=class extends ym.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(rl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};cn.ClientReadableStreamImpl=pm;var mm=class extends ym.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(rl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};cn.ClientWritableStreamImpl=mm;var gm=class extends ym.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(rl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};cn.ClientDuplexStreamImpl=gm});var xb=I(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.InterceptingListenerImpl=lo.isInterceptingListener=void 0;function jP(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}lo.isInterceptingListener=jP;var vm=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};lo.InterceptingListenerImpl=vm});var Tm=I(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.getInterceptingCall=un.InterceptingCall=un.RequesterBuilder=un.ListenerBuilder=un.InterceptorConfigurationError=void 0;var $P=Ft(),kb=xb(),Pb=Se(),Nb=cu(),sl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};un.InterceptorConfigurationError=sl;var Cm=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};un.ListenerBuilder=Cm;var _m=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};un.RequesterBuilder=_m;var Sm={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},il={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},bm=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:il.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:il.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:il.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:il.cancel}:this.requester=il}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,h)=>{var f,v,b;this.processingMetadata=!1;let E;if((0,kb.isInterceptingListener)(h))E=h;else{let w={onReceiveMetadata:(f=h.onReceiveMetadata)!==null&&f!==void 0?f:Sm.onReceiveMetadata,onReceiveMessage:(v=h.onReceiveMessage)!==null&&v!==void 0?v:Sm.onReceiveMessage,onReceiveStatus:(b=h.onReceiveStatus)!==null&&b!==void 0?b:Sm.onReceiveStatus};E=new kb.InterceptingListenerImpl(w,c)}this.nextCall.start(u,E),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};un.InterceptingCall=bm;function GP(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var Tu=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(Pb.Status.INTERNAL,`Request message serialization failure: ${(0,Nb.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:Pb.Status.INTERNAL,details:`Response message parsing error: ${(0,Nb.getErrorMessage)(a)}`,metadata:new $P.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},wm=class extends Tu{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},Em=class extends Tu{};function WP(n,e,t){let r=GP(n,t.path,e);return t.responseStream?new Em(r,t):new wm(r,t)}function HP(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new sl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new sl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>WP(r,a,e))(s)}un.getInterceptingCall=HP});var Rm=I(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.Client=void 0;var Yn=Mb(),KP=Dm(),QP=an(),pi=Se(),co=Ft(),Iu=Tm(),bn=Symbol(),uo=Symbol(),ho=Symbol(),Rr=Symbol();function Im(n){return typeof n=="function"}function fo(n){return n.stack.split(`
`).slice(1).join(`
`)}var Am=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[uo]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[ho]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[uo].length>0&&this[ho].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Rr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[bn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[bn]=o(e,t,r)}else this[bn]=new KP.ChannelImplementation(e,t,r)}close(){this[bn].close()}getChannel(){return this[bn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[bn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===QP.ConnectivityState.READY)t();else try{this[bn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Im(e))return{metadata:new co.Metadata,options:{},callback:e};if(Im(t))return e instanceof co.Metadata?{metadata:e,options:{},callback:t}:{metadata:new co.Metadata,options:e,callback:t};if(!(e instanceof co.Metadata&&t instanceof Object&&Im(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),h={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new Yn.ClientUnaryCallImpl,channel:this[bn],methodDefinition:h,callOptions:u.options,callback:u.callback};this[Rr]&&(f=this[Rr](f));let v=f.call,b={clientInterceptors:this[uo],clientInterceptorProviders:this[ho],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},E=(0,Iu.getInterceptingCall)(b,f.methodDefinition,f.callOptions,f.channel);v.call=E;let w=null,M=!1,T=new Error;return E.start(f.metadata,{onReceiveMetadata:P=>{v.emit("metadata",P)},onReceiveMessage(P){w!==null&&E.cancelWithStatus(pi.Status.INTERNAL,"Too many responses received"),w=P},onReceiveStatus(P){if(!M){if(M=!0,P.code===pi.Status.OK)if(w===null){let N=fo(T);f.callback((0,Yn.callErrorFromStatus)({code:pi.Status.INTERNAL,details:"No message received",metadata:P.metadata},N))}else f.callback(null,w);else{let N=fo(T);f.callback((0,Yn.callErrorFromStatus)(P,N))}T=null,v.emit("status",P)}}}),E.sendMessage(i),E.halfClose(),v}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={metadata:c.metadata,call:new Yn.ClientWritableStreamImpl(t),channel:this[bn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Rr]&&(h=this[Rr](h));let f=h.call,v={clientInterceptors:this[uo],clientInterceptorProviders:this[ho],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},b=(0,Iu.getInterceptingCall)(v,h.methodDefinition,h.callOptions,h.channel);f.call=b;let E=null,w=!1,M=new Error;return b.start(h.metadata,{onReceiveMetadata:T=>{f.emit("metadata",T)},onReceiveMessage(T){E!==null&&b.cancelWithStatus(pi.Status.INTERNAL,"Too many responses received"),E=T},onReceiveStatus(T){if(!w){if(w=!0,T.code===pi.Status.OK)if(E===null){let P=fo(M);h.callback((0,Yn.callErrorFromStatus)({code:pi.Status.INTERNAL,details:"No message received",metadata:T.metadata},P))}else h.callback(null,E);else{let P=fo(M);h.callback((0,Yn.callErrorFromStatus)(T,P))}M=null,f.emit("status",T)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof co.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new co.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:c.metadata,call:new Yn.ClientReadableStreamImpl(r),channel:this[bn],methodDefinition:u,callOptions:c.options};this[Rr]&&(h=this[Rr](h));let f=h.call,v={clientInterceptors:this[uo],clientInterceptorProviders:this[ho],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},b=(0,Iu.getInterceptingCall)(v,h.methodDefinition,h.callOptions,h.channel);f.call=b;let E=!1,w=new Error;return b.start(h.metadata,{onReceiveMetadata(M){f.emit("metadata",M)},onReceiveMessage(M){f.push(M)},onReceiveStatus(M){if(!E){if(E=!0,f.push(null),M.code!==pi.Status.OK){let T=fo(w);f.emit("error",(0,Yn.callErrorFromStatus)(M,T))}w=null,f.emit("status",M)}}}),b.sendMessage(i),b.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Yn.ClientDuplexStreamImpl(t,r),channel:this[bn],methodDefinition:c,callOptions:l.options};this[Rr]&&(u=this[Rr](u));let h=u.call,f={clientInterceptors:this[uo],clientInterceptorProviders:this[ho],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},v=(0,Iu.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);h.call=v;let b=!1,E=new Error;return v.start(u.metadata,{onReceiveMetadata(w){h.emit("metadata",w)},onReceiveMessage(w){h.push(w)},onReceiveStatus(w){if(!b){if(b=!0,h.push(null),w.code!==pi.Status.OK){let M=fo(E);h.emit("error",(0,Yn.callErrorFromStatus)(w,M))}E=null,h.emit("status",w)}}}),h}};Au.Client=Am});var Mm=I(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.loadPackageDefinition=po.makeClientConstructor=void 0;var ol=Rm(),YP={unary:ol.Client.prototype.makeUnaryRequest,server_stream:ol.Client.prototype.makeServerStreamRequest,client_stream:ol.Client.prototype.makeClientStreamRequest,bidi:ol.Client.prototype.makeBidiStreamRequest};function Om(n){return["__proto__","prototype","constructor"].includes(n)}function Fb(n,e,t){t||(t={});class r extends ol.Client{}return Object.keys(n).forEach(i=>{if(Om(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=XP(YP[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Om(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}po.makeClientConstructor=Fb;function XP(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function JP(n){return"format"in n}function ZP(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Om(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];JP(r)?o[s]=r:o[s]=Fb(r,s,{})}return e}po.loadPackageDefinition=ZP});var aw=I((f5,ow)=>{"use strict";var eN=1/0,tN="[object Symbol]",nN=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,rN=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Du="\\ud800-\\udfff",$b="\\u0300-\\u036f\\ufe20-\\ufe23",Gb="\\u20d0-\\u20f0",Wb="\\u2700-\\u27bf",Hb="a-z\\xdf-\\xf6\\xf8-\\xff",iN="\\xac\\xb1\\xd7\\xf7",sN="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",oN="\\u2000-\\u206f",aN=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Kb="A-Z\\xc0-\\xd6\\xd8-\\xde",Qb="\\ufe0e\\ufe0f",Yb=iN+sN+oN+aN,km="['\u2019]",lN="["+Du+"]",Lb="["+Yb+"]",Ru="["+$b+Gb+"]",Xb="\\d+",cN="["+Wb+"]",Jb="["+Hb+"]",Zb="[^"+Du+Yb+Xb+Wb+Hb+Kb+"]",xm="\\ud83c[\\udffb-\\udfff]",uN="(?:"+Ru+"|"+xm+")",ew="[^"+Du+"]",Pm="(?:\\ud83c[\\udde6-\\uddff]){2}",Nm="[\\ud800-\\udbff][\\udc00-\\udfff]",mo="["+Kb+"]",tw="\\u200d",Vb="(?:"+Jb+"|"+Zb+")",dN="(?:"+mo+"|"+Zb+")",Bb="(?:"+km+"(?:d|ll|m|re|s|t|ve))?",Ub="(?:"+km+"(?:D|LL|M|RE|S|T|VE))?",nw=uN+"?",rw="["+Qb+"]?",hN="(?:"+tw+"(?:"+[ew,Pm,Nm].join("|")+")"+rw+nw+")*",iw=rw+nw+hN,fN="(?:"+[cN,Pm,Nm].join("|")+")"+iw,pN="(?:"+[ew+Ru+"?",Ru,Pm,Nm,lN].join("|")+")",mN=RegExp(km,"g"),gN=RegExp(Ru,"g"),yN=RegExp(xm+"(?="+xm+")|"+pN+iw,"g"),vN=RegExp([mo+"?"+Jb+"+"+Bb+"(?="+[Lb,mo,"$"].join("|")+")",dN+"+"+Ub+"(?="+[Lb,mo+Vb,"$"].join("|")+")",mo+"?"+Vb+"+"+Bb,mo+"+"+Ub,Xb,fN].join("|"),"g"),SN=RegExp("["+tw+Du+$b+Gb+Qb+"]"),CN=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_N={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},bN=typeof global=="object"&&global&&global.Object===Object&&global,wN=typeof self=="object"&&self&&self.Object===Object&&self,EN=bN||wN||Function("return this")();function TN(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function IN(n){return n.split("")}function AN(n){return n.match(nN)||[]}function RN(n){return function(e){return n?.[e]}}var DN=RN(_N);function sw(n){return SN.test(n)}function ON(n){return CN.test(n)}function MN(n){return sw(n)?xN(n):IN(n)}function xN(n){return n.match(yN)||[]}function kN(n){return n.match(vN)||[]}var PN=Object.prototype,NN=PN.toString,qb=EN.Symbol,zb=qb?qb.prototype:void 0,jb=zb?zb.toString:void 0;function FN(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function LN(n){if(typeof n=="string")return n;if(zN(n))return jb?jb.call(n):"";var e=n+"";return e=="0"&&1/n==-eN?"-0":e}function VN(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:FN(n,e,t)}function BN(n){return function(e){e=Ou(e);var t=sw(e)?MN(e):void 0,r=t?t[0]:e.charAt(0),i=t?VN(t,1).join(""):e.slice(1);return r[n]()+i}}function UN(n){return function(e){return TN(HN(GN(e).replace(mN,"")),n,"")}}function qN(n){return!!n&&typeof n=="object"}function zN(n){return typeof n=="symbol"||qN(n)&&NN.call(n)==tN}function Ou(n){return n==null?"":LN(n)}var jN=UN(function(n,e,t){return e=e.toLowerCase(),n+(t?$N(e):e)});function $N(n){return WN(Ou(n).toLowerCase())}function GN(n){return n=Ou(n),n&&n.replace(rN,DN).replace(gN,"")}var WN=BN("toUpperCase");function HN(n,e,t){return n=Ou(n),e=t?void 0:e,e===void 0?ON(n)?kN(n):AN(n):n.match(e)||[]}ow.exports=jN});var Fm=I((p5,lw)=>{"use strict";lw.exports=KN;function KN(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var h=new Array(arguments.length-1),f=0;f<h.length;)h[f++]=arguments[f];a.apply(null,h)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var hw=I(dw=>{"use strict";var Mu=dw;Mu.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var go=new Array(64),uw=new Array(123);for(wn=0;wn<64;)uw[go[wn]=wn<26?wn+65:wn<52?wn+71:wn<62?wn-4:wn-59|43]=wn++;var wn;Mu.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=go[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=go[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=go[l|c>>6],s[o++]=go[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=go[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var cw="invalid encoding";Mu.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=uw[l])===void 0)throw Error(cw);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(cw);return r-i};Mu.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var pw=I((g5,fw)=>{"use strict";fw.exports=xu;function xu(){this._listeners={}}xu.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};xu.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};xu.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var _w=I((y5,Cw)=>{"use strict";Cw.exports=mw(mw);function mw(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,gw),n.writeFloatBE=e.bind(null,yw);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,vw),n.readFloatBE=t.bind(null,Sw)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var h=Math.floor(Math.log(o)/Math.LN2);h===1024&&(h=1023),u=o*Math.pow(2,-h),r(u*4503599627370496>>>0,a,l+i),r((c<<31|h+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,gw,0,4),n.writeDoubleBE=e.bind(null,yw,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,h=c>>>20&2047,f=4294967296*(c&1048575)+l;return h===2047?f?NaN:u*(1/0):h===0?u*5e-324*f:u*Math.pow(2,h-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,vw,0,4),n.readDoubleBE=t.bind(null,Sw,4,0)}(),n}function gw(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function yw(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function vw(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function Sw(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Lm=I((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var ww=I(bw=>{"use strict";var Vm=bw;Vm.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Vm.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Vm.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var Tw=I((S5,Ew)=>{"use strict";Ew.exports=QN;function QN(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var Aw=I((C5,Iw)=>{"use strict";Iw.exports=dt;var al=Xn();function dt(n,e){this.lo=n>>>0,this.hi=e>>>0}var Xi=dt.zero=new dt(0,0);Xi.toNumber=function(){return 0};Xi.zzEncode=Xi.zzDecode=function(){return this};Xi.length=function(){return 1};var YN=dt.zeroHash="\0\0\0\0\0\0\0\0";dt.fromNumber=function(e){if(e===0)return Xi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new dt(r,i)};dt.from=function(e){if(typeof e=="number")return dt.fromNumber(e);if(al.isString(e))if(al.Long)e=al.Long.fromString(e);else return dt.fromNumber(parseInt(e,10));return e.low||e.high?new dt(e.low>>>0,e.high>>>0):Xi};dt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};dt.prototype.toLong=function(e){return al.Long?new al.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var mi=String.prototype.charCodeAt;dt.fromHash=function(e){return e===YN?Xi:new dt((mi.call(e,0)|mi.call(e,1)<<8|mi.call(e,2)<<16|mi.call(e,3)<<24)>>>0,(mi.call(e,4)|mi.call(e,5)<<8|mi.call(e,6)<<16|mi.call(e,7)<<24)>>>0)};dt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};dt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};dt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};dt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Xn=I(Bm=>{"use strict";var H=Bm;H.asPromise=Fm();H.base64=hw();H.EventEmitter=pw();H.float=_w();H.inquire=Lm();H.utf8=ww();H.pool=Tw();H.LongBits=Aw();H.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);H.global=H.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Bm;H.emptyArray=Object.freeze?Object.freeze([]):[];H.emptyObject=Object.freeze?Object.freeze({}):{};H.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};H.isString=function(e){return typeof e=="string"||e instanceof String};H.isObject=function(e){return e&&typeof e=="object"};H.isset=H.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};H.Buffer=function(){try{var n=H.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();H._Buffer_from=null;H._Buffer_allocUnsafe=null;H.newBuffer=function(e){return typeof e=="number"?H.Buffer?H._Buffer_allocUnsafe(e):new H.Array(e):H.Buffer?H._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};H.Array=typeof Uint8Array<"u"?Uint8Array:Array;H.Long=H.global.dcodeIO&&H.global.dcodeIO.Long||H.global.Long||H.inquire("long");H.key2Re=/^true|false|0|1$/;H.key32Re=/^-?(?:0|[1-9][0-9]*)$/;H.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;H.longToHash=function(e){return e?H.LongBits.from(e).toHash():H.LongBits.zeroHash};H.longFromHash=function(e,t){var r=H.LongBits.fromHash(e);return H.Long?H.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function Rw(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}H.merge=Rw;H.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Dw(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&Rw(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}H.newError=Dw;H.ProtocolError=Dw("ProtocolError");H.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};H.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};H.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};H._configure=function(){var n=H.Buffer;if(!n){H._Buffer_from=H._Buffer_allocUnsafe=null;return}H._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},H._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Pu=I((b5,kw)=>{"use strict";kw.exports=ge;var dn=Xn(),Um,ku=dn.LongBits,Ow=dn.base64,Mw=dn.utf8;function ll(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function zm(){}function XN(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function ge(){this.len=0,this.head=new ll(zm,0,0),this.tail=this.head,this.states=null}var xw=function(){return dn.Buffer?function(){return(ge.create=function(){return new Um})()}:function(){return new ge}};ge.create=xw();ge.alloc=function(e){return new dn.Array(e)};dn.Array!==Array&&(ge.alloc=dn.pool(ge.alloc,dn.Array.prototype.subarray));ge.prototype._push=function(e,t,r){return this.tail=this.tail.next=new ll(e,t,r),this.len+=t,this};function jm(n,e,t){e[t]=n&255}function JN(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function $m(n,e){this.len=n,this.next=void 0,this.val=e}$m.prototype=Object.create(ll.prototype);$m.prototype.fn=JN;ge.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new $m((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ge.prototype.int32=function(e){return e<0?this._push(Gm,10,ku.fromNumber(e)):this.uint32(e)};ge.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Gm(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}ge.prototype.uint64=function(e){var t=ku.from(e);return this._push(Gm,t.length(),t)};ge.prototype.int64=ge.prototype.uint64;ge.prototype.sint64=function(e){var t=ku.from(e).zzEncode();return this._push(Gm,t.length(),t)};ge.prototype.bool=function(e){return this._push(jm,1,e?1:0)};function qm(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}ge.prototype.fixed32=function(e){return this._push(qm,4,e>>>0)};ge.prototype.sfixed32=ge.prototype.fixed32;ge.prototype.fixed64=function(e){var t=ku.from(e);return this._push(qm,4,t.lo)._push(qm,4,t.hi)};ge.prototype.sfixed64=ge.prototype.fixed64;ge.prototype.float=function(e){return this._push(dn.float.writeFloatLE,4,e)};ge.prototype.double=function(e){return this._push(dn.float.writeDoubleLE,8,e)};var ZN=dn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};ge.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(jm,1,0);if(dn.isString(e)){var r=ge.alloc(t=Ow.length(e));Ow.decode(e,r,0),e=r}return this.uint32(t)._push(ZN,t,e)};ge.prototype.string=function(e){var t=Mw.length(e);return t?this.uint32(t)._push(Mw.write,t,e):this._push(jm,1,0)};ge.prototype.fork=function(){return this.states=new XN(this),this.head=this.tail=new ll(zm,0,0),this.len=0,this};ge.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ll(zm,0,0),this.len=0),this};ge.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};ge.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};ge._configure=function(n){Um=n,ge.create=xw(),Um._configure()}});var Fw=I((w5,Nw)=>{"use strict";Nw.exports=Jn;var Pw=Pu();(Jn.prototype=Object.create(Pw.prototype)).constructor=Jn;var gi=Xn();function Jn(){Pw.call(this)}Jn._configure=function(){Jn.alloc=gi._Buffer_allocUnsafe,Jn.writeBytesBuffer=gi.Buffer&&gi.Buffer.prototype instanceof Uint8Array&&gi.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Jn.prototype.bytes=function(e){gi.isString(e)&&(e=gi._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Jn.writeBytesBuffer,t,e),this};function eF(n,e,t){n.length<40?gi.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Jn.prototype.string=function(e){var t=gi.Buffer.byteLength(e);return this.uint32(t),t&&this._push(eF,t,e),this};Jn._configure()});var Fu=I((E5,qw)=>{"use strict";qw.exports=Ge;var En=Xn(),Hm,Bw=En.LongBits,tF=En.utf8;function Tn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Ge(n){this.buf=n,this.pos=0,this.len=n.length}var Lw=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ge(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ge(e);throw Error("illegal buffer")},Uw=function(){return En.Buffer?function(t){return(Ge.create=function(i){return En.Buffer.isBuffer(i)?new Hm(i):Lw(i)})(t)}:Lw};Ge.create=Uw();Ge.prototype._slice=En.Array.prototype.subarray||En.Array.prototype.slice;Ge.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Tn(this,10);return e}}();Ge.prototype.int32=function(){return this.uint32()|0};Ge.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Wm(){var n=new Bw(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Tn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Tn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Ge.prototype.bool=function(){return this.uint32()!==0};function Nu(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Ge.prototype.fixed32=function(){if(this.pos+4>this.len)throw Tn(this,4);return Nu(this.buf,this.pos+=4)};Ge.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Tn(this,4);return Nu(this.buf,this.pos+=4)|0};function Vw(){if(this.pos+8>this.len)throw Tn(this,8);return new Bw(Nu(this.buf,this.pos+=4),Nu(this.buf,this.pos+=4))}Ge.prototype.float=function(){if(this.pos+4>this.len)throw Tn(this,4);var e=En.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ge.prototype.double=function(){if(this.pos+8>this.len)throw Tn(this,4);var e=En.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ge.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Tn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=En.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Ge.prototype.string=function(){var e=this.bytes();return tF.read(e,0,e.length)};Ge.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Tn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Tn(this);while(this.buf[this.pos++]&128);return this};Ge.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Ge._configure=function(n){Hm=n,Ge.create=Uw(),Hm._configure();var e=En.Long?"toLong":"toNumber";En.merge(Ge.prototype,{int64:function(){return Wm.call(this)[e](!1)},uint64:function(){return Wm.call(this)[e](!0)},sint64:function(){return Wm.call(this).zzDecode()[e](!1)},fixed64:function(){return Vw.call(this)[e](!0)},sfixed64:function(){return Vw.call(this)[e](!1)}})}});var Gw=I((T5,$w)=>{"use strict";$w.exports=Ji;var jw=Fu();(Ji.prototype=Object.create(jw.prototype)).constructor=Ji;var zw=Xn();function Ji(n){jw.call(this,n)}Ji._configure=function(){zw.Buffer&&(Ji.prototype._slice=zw.Buffer.prototype.slice)};Ji.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ji._configure()});var Hw=I((I5,Ww)=>{"use strict";Ww.exports=cl;var Km=Xn();(cl.prototype=Object.create(Km.EventEmitter.prototype)).constructor=cl;function cl(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");Km.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}cl.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Km.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};cl.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Qm=I(Kw=>{"use strict";var nF=Kw;nF.Service=Hw()});var Ym=I((R5,Qw)=>{"use strict";Qw.exports={}});var Jw=I(Xw=>{"use strict";var Vt=Xw;Vt.build="minimal";Vt.Writer=Pu();Vt.BufferWriter=Fw();Vt.Reader=Fu();Vt.BufferReader=Gw();Vt.util=Xn();Vt.rpc=Qm();Vt.roots=Ym();Vt.configure=Yw;function Yw(){Vt.util._configure(),Vt.Writer._configure(Vt.BufferWriter),Vt.Reader._configure(Vt.BufferReader)}Yw()});var eE=I((O5,Zw)=>{"use strict";Zw.exports=Xm;function Xm(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Xm.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var h=new Array(arguments.length-1),f=0;f<h.length;)h[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(b,E){var w=h[f++];switch(E){case"d":case"f":return String(Number(w));case"i":return String(Math.floor(w));case"j":return JSON.stringify(w);case"s":return String(w)}return"%"}),f!==h.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Xm.verbose=!1});var nE=I((M5,tE)=>{"use strict";tE.exports=ul;var rF=Fm(),iF=Lm(),Jm=iF("fs");function ul(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Jm&&Jm.readFile?Jm.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?ul.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):ul.xhr(n,e,t):rF(ul,this,n,e)}ul.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var sE=I(iE=>{"use strict";var eg=iE,rE=eg.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Zm=eg.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=rE(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};eg.resolve=function(e,t,r){return r||(t=Zm(t)),rE(t)?t:(r||(e=Zm(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Zm(e+"/"+t):t)}});var Zi=I(oE=>{"use strict";var dl=oE,sF=ht(),oF=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function hl(n,e){var t=0,r={};for(e|=0;t<n.length;)r[oF[t+e]]=n[t++];return r}dl.basic=hl([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);dl.defaults=hl([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",sF.emptyArray,null]);dl.long=hl([0,0,0,1,1],7);dl.mapKey=hl([0,0,0,5,5,0,0,0,1,1,0,2],2);dl.packed=hl([1,5,0,0,0,5,5,0,0,0,1,1,0])});var yi=I((P5,cE)=>{"use strict";cE.exports=hn;var Lu=es();((hn.prototype=Object.create(Lu.prototype)).constructor=hn).className="Field";var aE=In(),lE=Zi(),Ze=ht(),tg,aF=/^required|optional|repeated$/;hn.fromJSON=function(e,t){return new hn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function hn(n,e,t,r,i,s,o){if(Ze.isObject(r)?(o=i,s=r,r=i=void 0):Ze.isObject(i)&&(o=s,s=i,i=void 0),Lu.call(this,n,s),!Ze.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Ze.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!aF.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Ze.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ze.Long?lE.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(hn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});hn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Lu.prototype.setOption.call(this,e,t,r)};hn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ze.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};hn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=lE.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof tg?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof aE&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof aE))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ze.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Ze.base64.test(this.typeDefault)?Ze.base64.decode(this.typeDefault,e=Ze.newBuffer(Ze.base64.length(this.typeDefault)),0):Ze.utf8.write(this.typeDefault,e=Ze.newBuffer(Ze.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Ze.emptyObject:this.repeated?this.defaultValue=Ze.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof tg&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Lu.prototype.resolve.call(this)};hn.d=function(e,t,r,i){return typeof t=="function"?t=Ze.decorateType(t).name:t&&typeof t=="object"&&(t=Ze.decorateEnum(t).name),function(o,a){Ze.decorateType(o.constructor).add(new hn(a,e,t,r,{default:i}))}};hn._configure=function(e){tg=e}});var yo=I((N5,hE)=>{"use strict";hE.exports=fn;var Bu=es();((fn.prototype=Object.create(Bu.prototype)).constructor=fn).className="OneOf";var uE=yi(),Vu=ht();function fn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Bu.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}fn.fromJSON=function(e,t){return new fn(e,t.oneof,t.options,t.comment)};fn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Vu.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function dE(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}fn.prototype.add=function(e){if(!(e instanceof uE))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,dE(this),this};fn.prototype.remove=function(e){if(!(e instanceof uE))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};fn.prototype.onAdd=function(e){Bu.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}dE(this)};fn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Bu.prototype.onRemove.call(this,e)};fn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Vu.decorateType(i.constructor).add(new fn(s,e)),Object.defineProperty(i,s,{get:Vu.oneOfGetter(e),set:Vu.oneOfSetter(e)})}}});var Co=I((F5,gE)=>{"use strict";gE.exports=ye;var ng=es();((ye.prototype=Object.create(ng.prototype)).constructor=ye).className="Namespace";var fE=yi(),Uu=ht(),lF=yo(),vo,fl,So;ye.fromJSON=function(e,t){return new ye(e,t.options).addJSON(t.nested)};function pE(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}ye.arrayToJSON=pE;ye.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};ye.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function ye(n,e){ng.call(this,n,e),this.nested=void 0,this._nestedArray=null}function mE(n){return n._nestedArray=null,n}Object.defineProperty(ye.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Uu.toArray(this.nested))}});ye.prototype.toJSON=function(e){return Uu.toObject(["options",this.options,"nested",pE(this.nestedArray,e)])};ye.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?vo.fromJSON:s.values!==void 0?So.fromJSON:s.methods!==void 0?fl.fromJSON:s.id!==void 0?fE.fromJSON:ye.fromJSON)(r[i],s));return this};ye.prototype.get=function(e){return this.nested&&this.nested[e]||null};ye.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof So)return this.nested[e].values;throw Error("no such enum: "+e)};ye.prototype.add=function(e){if(!(e instanceof fE&&e.extend!==void 0||e instanceof vo||e instanceof lF||e instanceof So||e instanceof fl||e instanceof ye))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof ye&&e instanceof ye&&!(t instanceof vo||t instanceof fl)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),mE(this)};ye.prototype.remove=function(e){if(!(e instanceof ng))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),mE(this)};ye.prototype.define=function(e,t){if(Uu.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof ye))throw Error("path conflicts with non-namespace objects")}else r.add(r=new ye(i))}return t&&r.addJSON(t),r};ye.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof ye?e[t++].resolveAll():e[t++].resolve();return this.resolve()};ye.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Uu.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof ye&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof ye&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};ye.prototype.lookupType=function(e){var t=this.lookup(e,[vo]);if(!t)throw Error("no such type: "+e);return t};ye.prototype.lookupEnum=function(e){var t=this.lookup(e,[So]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};ye.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[vo,So]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};ye.prototype.lookupService=function(e){var t=this.lookup(e,[fl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};ye._configure=function(n,e,t){vo=n,fl=e,So=t}});var qu=I((L5,yE)=>{"use strict";yE.exports=Dr;var rg=yi();((Dr.prototype=Object.create(rg.prototype)).constructor=Dr).className="MapField";var cF=Zi(),pl=ht();function Dr(n,e,t,r,i,s){if(rg.call(this,n,e,r,void 0,void 0,i,s),!pl.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Dr.fromJSON=function(e,t){return new Dr(e,t.id,t.keyType,t.type,t.options,t.comment)};Dr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return pl.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Dr.prototype.resolve=function(){if(this.resolved)return this;if(cF.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return rg.prototype.resolve.call(this)};Dr.d=function(e,t,r){return typeof r=="function"?r=pl.decorateType(r).name:r&&typeof r=="object"&&(r=pl.decorateEnum(r).name),function(s,o){pl.decorateType(s.constructor).add(new Dr(o,e,t,r))}}});var zu=I((V5,vE)=>{"use strict";vE.exports=ts;var ig=es();((ts.prototype=Object.create(ig.prototype)).constructor=ts).className="Method";var _o=ht();function ts(n,e,t,r,i,s,o,a,l){if(_o.isObject(i)?(o=i,i=s=void 0):_o.isObject(s)&&(o=s,s=void 0),!(e===void 0||_o.isString(e)))throw TypeError("type must be a string");if(!_o.isString(t))throw TypeError("requestType must be a string");if(!_o.isString(r))throw TypeError("responseType must be a string");ig.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}ts.fromJSON=function(e,t){return new ts(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};ts.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return _o.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};ts.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),ig.prototype.resolve.call(this))}});var ju=I((B5,CE)=>{"use strict";CE.exports=pn;var vi=Co();((pn.prototype=Object.create(vi.prototype)).constructor=pn).className="Service";var sg=zu(),ml=ht(),uF=Qm();function pn(n,e){vi.call(this,n,e),this.methods={},this._methodsArray=null}pn.fromJSON=function(e,t){var r=new pn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(sg.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};pn.prototype.toJSON=function(e){var t=vi.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return ml.toObject(["options",t&&t.options||void 0,"methods",vi.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(pn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=ml.toArray(this.methods))}});function SE(n){return n._methodsArray=null,n}pn.prototype.get=function(e){return this.methods[e]||vi.prototype.get.call(this,e)};pn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return vi.prototype.resolve.call(this)};pn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof sg?(this.methods[e.name]=e,e.parent=this,SE(this)):vi.prototype.add.call(this,e)};pn.prototype.remove=function(e){if(e instanceof sg){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,SE(this)}return vi.prototype.remove.call(this,e)};pn.prototype.create=function(e,t,r){for(var i=new uF.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=ml.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=ml.codegen(["r","c"],ml.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var $u=I((U5,_E)=>{"use strict";_E.exports=Zn;var dF=Xn();function Zn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Zn.create=function(e){return this.$type.create(e)};Zn.encode=function(e,t){return this.$type.encode(e,t)};Zn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Zn.decode=function(e){return this.$type.decode(e)};Zn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Zn.verify=function(e){return this.$type.verify(e)};Zn.fromObject=function(e){return this.$type.fromObject(e)};Zn.toObject=function(e,t){return this.$type.toObject(e,t)};Zn.prototype.toJSON=function(){return this.$type.toObject(this,dF.toJSONOptions)}});var og=I((q5,wE)=>{"use strict";wE.exports=pF;var hF=In(),Or=Zi(),bE=ht();function fF(n){return"missing required '"+n.name+"'"}function pF(n){var e=bE.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof hF?"int32":r.type,s="m"+bE.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),Or.defaults[r.keyType]!==void 0?e("k=%j",Or.defaults[r.keyType]):e("k=null"),Or.defaults[i]!==void 0?e("value=%j",Or.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),Or.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),Or.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),Or.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),Or.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):Or.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",fF(o))}return e("return m")}});var cg=I((z5,EE)=>{"use strict";EE.exports=yF;var mF=In(),ag=ht();function mn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function lg(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof mF){n("switch(%s){",r)("default:")("return%j",mn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",mn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",mn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",mn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",mn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",mn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",mn(e,"buffer"));break}return n}function gF(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",mn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",mn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",mn(e,"boolean key"));break}return n}function yF(n){var e=ag.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+ag.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",mn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),gF(e,s,"k[i]"),lg(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",mn(s,"array"))("for(var i=0;i<%s.length;++i){",o),lg(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=ag.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}lg(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var hg=I(IE=>{"use strict";var TE=IE,gl=In(),er=ht();function ug(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof gl){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}TE.fromObject=function(e){var t=e.fieldsArray,r=er.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=er.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),ug(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),ug(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof gl||r("if(d%s!=null){",o),ug(r,s,i,o),s.resolvedType instanceof gl||r("}"))}return r("return m")};function dg(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof gl?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}TE.toObject=function(e){var t=e.fieldsArray.slice().sort(er.compareFieldsById);if(!t.length)return er.codegen()("return {}");for(var r=er.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",er.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",er.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=er.safeProp(l.name);if(l.resolvedType instanceof gl)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var h=!1;for(a=0;a<t.length;++a){var l=t[a],f=e._fieldsArray.indexOf(l),c=er.safeProp(l.name);l.map?(h||(h=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),dg(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),dg(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),dg(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",er.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var fg=I(AE=>{"use strict";var vF=AE,SF=$u();vF[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof SF){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Hu=I((G5,DE)=>{"use strict";DE.exports=Oe;var An=Co();((Oe.prototype=Object.create(An.prototype)).constructor=Oe).className="Type";var CF=In(),gg=yo(),Gu=yi(),_F=qu(),bF=ju(),pg=$u(),mg=Fu(),wF=Pu(),_t=ht(),EF=yg(),TF=og(),IF=cg(),RE=hg(),AF=fg();function Oe(n,e){An.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Oe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=_t.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=_t.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Oe.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof pg||((n.prototype=new pg).constructor=n,_t.merge(n.prototype,e)),n.$type=n.prototype.$type=this,_t.merge(n,pg,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:_t.oneOfGetter(this._oneofsArray[t].oneof),set:_t.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Oe.generateConstructor=function(e){for(var t=_t.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",_t.safeProp(i.name)):i.repeated&&t("this%s=[]",_t.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Wu(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Oe.fromJSON=function(e,t){var r=new Oe(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?_F.fromJSON:Gu.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(gg.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Gu.fromJSON:o.fields!==void 0?Oe.fromJSON:o.values!==void 0?CF.fromJSON:o.methods!==void 0?bF.fromJSON:An.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};Oe.prototype.toJSON=function(e){var t=An.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return _t.toObject(["options",t&&t.options||void 0,"oneofs",An.arrayToJSON(this.oneofsArray,e),"fields",An.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Oe.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return An.prototype.resolveAll.call(this)};Oe.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Oe.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Gu&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Wu(this)}return e instanceof gg?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Wu(this)):An.prototype.add.call(this,e)};Oe.prototype.remove=function(e){if(e instanceof Gu&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Wu(this)}if(e instanceof gg){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Wu(this)}return An.prototype.remove.call(this,e)};Oe.prototype.isReservedId=function(e){return An.isReservedId(this.reserved,e)};Oe.prototype.isReservedName=function(e){return An.isReservedName(this.reserved,e)};Oe.prototype.create=function(e){return new this.ctor(e)};Oe.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=EF(this)({Writer:wF,types:t,util:_t}),this.decode=TF(this)({Reader:mg,types:t,util:_t}),this.verify=IF(this)({types:t,util:_t}),this.fromObject=RE.fromObject(this)({types:t,util:_t}),this.toObject=RE.toObject(this)({types:t,util:_t});var i=AF[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Oe.prototype.encode=function(e,t){return this.setup().encode(e,t)};Oe.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Oe.prototype.decode=function(e,t){return this.setup().decode(e,t)};Oe.prototype.decodeDelimited=function(e){return e instanceof mg||(e=mg.create(e)),this.decode(e,e.uint32())};Oe.prototype.verify=function(e){return this.setup().verify(e)};Oe.prototype.fromObject=function(e){return this.setup().fromObject(e)};Oe.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Oe.d=function(e){return function(r){_t.decorateType(r,e)}}});var Yu=I((W5,PE)=>{"use strict";PE.exports=Wt;var Qu=Co();((Wt.prototype=Object.create(Qu.prototype)).constructor=Wt).className="Root";var Sg=yi(),ME=In(),RF=yo(),Si=ht(),xE,vg,yl;function Wt(n){Qu.call(this,"",n),this.deferred=[],this.files=[]}Wt.fromJSON=function(e,t){return t||(t=new Wt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};Wt.prototype.resolvePath=Si.path.resolve;Wt.prototype.fetch=Si.fetch;function kE(){}Wt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Si.asPromise(n,i,e,t);var s=r===kE;function o(v,b){if(r){if(s)throw v;var E=r;r=null,E(v,b)}}function a(v){var b=v.lastIndexOf("google/protobuf/");if(b>-1){var E=v.substring(b);if(E in yl)return E}return null}function l(v,b){try{if(Si.isString(b)&&b.charAt(0)==="{"&&(b=JSON.parse(b)),!Si.isString(b))i.setOptions(b.options).addJSON(b.nested);else{vg.filename=v;var E=vg(b,i,t),w,M=0;if(E.imports)for(;M<E.imports.length;++M)(w=a(E.imports[M])||i.resolvePath(v,E.imports[M]))&&c(w);if(E.weakImports)for(M=0;M<E.weakImports.length;++M)(w=a(E.weakImports[M])||i.resolvePath(v,E.weakImports[M]))&&c(w,!0)}}catch(T){o(T)}!s&&!u&&o(null,i)}function c(v,b){if(v=a(v)||v,!(i.files.indexOf(v)>-1)){if(i.files.push(v),v in yl){s?l(v,yl[v]):(++u,setTimeout(function(){--u,l(v,yl[v])}));return}if(s){var E;try{E=Si.fs.readFileSync(v).toString("utf8")}catch(w){b||o(w);return}l(v,E)}else++u,i.fetch(v,function(w,M){if(--u,!!r){if(w){b?u||o(null,i):o(w);return}l(v,M)}})}}var u=0;Si.isString(e)&&(e=[e]);for(var h=0,f;h<e.length;++h)(f=i.resolvePath("",e[h]))&&c(f);if(s)return i;u||o(null,i)};Wt.prototype.loadSync=function(e,t){if(!Si.isNode)throw Error("not supported");return this.load(e,t,kE)};Wt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Qu.prototype.resolveAll.call(this)};var Ku=/^[A-Z]/;function OE(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Sg(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}Wt.prototype._handleAdd=function(e){if(e instanceof Sg)e.extend!==void 0&&!e.extensionField&&(OE(this,e)||this.deferred.push(e));else if(e instanceof ME)Ku.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof RF)){if(e instanceof xE)for(var t=0;t<this.deferred.length;)OE(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Ku.test(e.name)&&(e.parent[e.name]=e)}};Wt.prototype._handleRemove=function(e){if(e instanceof Sg){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof ME)Ku.test(e.name)&&delete e.parent[e.name];else if(e instanceof Qu){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Ku.test(e.name)&&delete e.parent[e.name]}};Wt._configure=function(n,e,t){xE=n,vg=e,yl=t}});var ht=I((H5,FE)=>{"use strict";var We=FE.exports=Xn(),NE=Ym(),Cg,_g;We.codegen=eE();We.fetch=nE();We.path=sE();We.fs=We.inquire("fs");We.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};We.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var DF=/\\/g,OF=/"/g;We.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};We.safeProp=function(e){return!/^[$\w_]+$/.test(e)||We.isReserved(e)?'["'+e.replace(DF,"\\\\").replace(OF,'\\"')+'"]':"."+e};We.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var MF=/_([a-z])/g;We.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(MF,function(t,r){return r.toUpperCase()})};We.compareFieldsById=function(e,t){return e.id-t.id};We.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(We.decorateRoot.remove(e.$type),e.$type.name=t,We.decorateRoot.add(e.$type)),e.$type;Cg||(Cg=Hu());var r=new Cg(t||e.name);return We.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var xF=0;We.decorateEnum=function(e){if(e.$type)return e.$type;_g||(_g=In());var t=new _g("Enum"+xF++,e);return We.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};We.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(We,"decorateRoot",{get:function(){return NE.decorated||(NE.decorated=new(Yu()))}})});var es=I((K5,LE)=>{"use strict";LE.exports=Ht;Ht.className="ReflectionObject";var Xu=ht(),Ju;function Ht(n,e){if(!Xu.isString(n))throw TypeError("name must be a string");if(e&&!Xu.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Ht.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Ht.prototype.toJSON=function(){throw Error()};Ht.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Ju&&t._handleAdd(this)};Ht.prototype.onRemove=function(e){var t=e.root;t instanceof Ju&&t._handleRemove(this),this.parent=null,this.resolved=!1};Ht.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Ju&&(this.resolved=!0),this)};Ht.prototype.getOption=function(e){if(this.options)return this.options[e]};Ht.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Ht.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Xu.setProperty(o,r,t)}else s={},s[e]=Xu.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Ht.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Ht.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Ht._configure=function(n){Ju=n}});var In=I((Q5,UE)=>{"use strict";UE.exports=tr;var VE=es();((tr.prototype=Object.create(VE.prototype)).constructor=tr).className="Enum";var BE=Co(),Zu=ht();function tr(n,e,t,r,i,s){if(VE.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}tr.fromJSON=function(e,t){var r=new tr(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};tr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Zu.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};tr.prototype.add=function(e,t,r,i){if(!Zu.isString(e))throw TypeError("name must be a string");if(!Zu.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};tr.prototype.remove=function(e){if(!Zu.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};tr.prototype.isReservedId=function(e){return BE.isReservedId(this.reserved,e)};tr.prototype.isReservedName=function(e){return BE.isReservedName(this.reserved,e)}});var yg=I((Y5,zE)=>{"use strict";zE.exports=PF;var kF=In(),bg=Zi(),wg=ht();function qE(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function PF(n){for(var e=wg.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(wg.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof kF?"int32":s.type,l=bg.basic[a];r="m"+wg.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|bg.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&bg.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?qE(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?qE(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var $E=I((X5,jE)=>{"use strict";var pe=jE.exports=Jw();pe.build="light";function NF(n,e,t){return typeof e=="function"?(t=e,e=new pe.Root):e||(e=new pe.Root),e.load(n,t)}pe.load=NF;function FF(n,e){return e||(e=new pe.Root),e.loadSync(n)}pe.loadSync=FF;pe.encoder=yg();pe.decoder=og();pe.verifier=cg();pe.converter=hg();pe.ReflectionObject=es();pe.Namespace=Co();pe.Root=Yu();pe.Enum=In();pe.Type=Hu();pe.Field=yi();pe.OneOf=yo();pe.MapField=qu();pe.Service=ju();pe.Method=zu();pe.Message=$u();pe.wrappers=fg();pe.types=Zi();pe.util=ht();pe.ReflectionObject._configure(pe.Root);pe.Namespace._configure(pe.Type,pe.Service,pe.Enum);pe.Root._configure(pe.Type);pe.Field._configure(pe.Type)});var Tg=I((J5,HE)=>{"use strict";HE.exports=WE;var Eg=/[\s{}=;:[\],'"()<>]/g,LF=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,VF=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,BF=/^ *[*/]+ */,UF=/^\s*\*?\/*/,qF=/\n/g,zF=/\s/,jF=/\\(.?)/g,$F={0:"\0",r:"\r",n:`
`,t:"	"};function GE(n){return n.replace(jF,function(e,t){switch(t){case"\\":case"":return t;default:return $F[t]||""}})}WE.unescape=GE;function WE(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(N){return Error("illegal "+N+" (line "+i+")")}function u(){var N=l==="'"?VF:LF;N.lastIndex=t-1;var W=N.exec(n);if(!W)throw c("string");return t=N.lastIndex,w(l),l=null,GE(W[1])}function h(N){return n.charAt(N)}function f(N,W,X){var C={type:n.charAt(N++),lineEmpty:!1,leading:X},g;e?g=2:g=3;var y=N-g,S;do if(--y<0||(S=n.charAt(y))===`
`){C.lineEmpty=!0;break}while(S===" "||S==="	");for(var p=n.substring(N,W).split(qF),_=0;_<p.length;++_)p[_]=p[_].replace(e?UF:BF,"").trim();C.text=p.join(`
`).trim(),o[i]=C,s=i}function v(N){var W=b(N),X=n.substring(N,W),C=/^\s*\/\//.test(X);return C}function b(N){for(var W=N;W<r&&h(W)!==`
`;)W++;return W}function E(){if(a.length>0)return a.shift();if(l)return u();var N,W,X,C,g,y=t===0;do{if(t===r)return null;for(N=!1;zF.test(X=h(t));)if(X===`
`&&(y=!0,++i),++t===r)return null;if(h(t)==="/"){if(++t===r)throw c("comment");if(h(t)==="/")if(e){if(C=t,g=!1,v(t-1)){g=!0;do if(t=b(t),t===r||(t++,!y))break;while(v(t))}else t=Math.min(r,b(t)+1);g&&(f(C,t,y),y=!0),i++,N=!0}else{for(g=h(C=t+1)==="/";h(++t)!==`
`;)if(t===r)return null;++t,g&&(f(C,t-1,y),y=!0),++i,N=!0}else if((X=h(t))==="*"){C=t+1,g=e||h(C)==="*";do{if(X===`
`&&++i,++t===r)throw c("comment");W=X,X=h(t)}while(W!=="*"||X!=="/");++t,g&&(f(C,t-2,y),y=!0),N=!0}else return"/"}}while(N);var S=t;Eg.lastIndex=0;var p=Eg.test(h(S++));if(!p)for(;S<r&&!Eg.test(h(S));)++S;var _=n.substring(t,t=S);return(_==='"'||_==="'")&&(l=_),_}function w(N){a.push(N)}function M(){if(!a.length){var N=E();if(N===null)return null;w(N)}return a[0]}function T(N,W){var X=M(),C=X===N;if(C)return E(),!0;if(!W)throw c("token '"+X+"', '"+N+"' expected");return!1}function P(N){var W=null,X;return N===void 0?(X=o[i-1],delete o[i-1],X&&(e||X.type==="*"||X.lineEmpty)&&(W=X.leading?X.text:null)):(s<N&&M(),X=o[N],delete o[N],X&&!X.lineEmpty&&(e||X.type==="/")&&(W=X.leading?null:X.text)),W}return Object.defineProperty({next:E,peek:M,push:w,skip:T,cmnt:P},"line",{get:function(){return i}})}});var ZE=I((Z5,JE)=>{"use strict";JE.exports=Mr;Mr.filename=null;Mr.defaults={keepCase:!1};var GF=Tg(),KE=Yu(),QE=Hu(),YE=yi(),WF=qu(),XE=yo(),HF=In(),KF=ju(),QF=zu(),Ig=Zi(),Ag=ht(),YF=/^[1-9][0-9]*$/,XF=/^-?[1-9][0-9]*$/,JF=/^0[x][0-9a-fA-F]+$/,ZF=/^-?0[x][0-9a-fA-F]+$/,eL=/^0[0-7]+$/,tL=/^-?0[0-7]+$/,nL=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,nr=/^[a-zA-Z_][a-zA-Z_0-9]*$/,rr=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,rL=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Mr(n,e,t){e instanceof KE||(t=e,e=new KE),t||(t=Mr.defaults);var r=t.preferTrailingComment||!1,i=GF(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,h,f,v,b,E=!1,w=e,M=t.keepCase?function(x){return x}:Ag.camelCase;function T(x,k,L){var Q=Mr.filename;return L||(Mr.filename=null),Error("illegal "+(k||"token")+" '"+x+"' ("+(Q?Q+", ":"")+"line "+i.line+")")}function P(){var x=[],k;do{if((k=s())!=='"'&&k!=="'")throw T(k);x.push(s()),l(k),k=a()}while(k==='"'||k==="'");return x.join("")}function N(x){var k=s();switch(k){case"'":case'"':return o(k),P();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return X(k,!0)}catch{if(x&&rr.test(k))return k;throw T(k,"value")}}function W(x,k){var L,Q;do k&&((L=a())==='"'||L==="'")?x.push(P()):x.push([Q=C(s()),l("to",!0)?C(s()):Q]);while(l(",",!0));var $={options:void 0};$.setOption=function(se,Fe){this.options===void 0&&(this.options={}),this.options[se]=Fe},_($,function(Fe){if(Fe==="option")Ie($,Fe),l(";");else throw T(Fe)},function(){gt($)})}function X(x,k){var L=1;switch(x.charAt(0)==="-"&&(L=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return L*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(YF.test(x))return L*parseInt(x,10);if(JF.test(x))return L*parseInt(x,16);if(eL.test(x))return L*parseInt(x,8);if(nL.test(x))return L*parseFloat(x);throw T(x,"number",k)}function C(x,k){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!k&&x.charAt(0)==="-")throw T(x,"id");if(XF.test(x))return parseInt(x,10);if(ZF.test(x))return parseInt(x,16);if(tL.test(x))return parseInt(x,8);throw T(x,"id")}function g(){if(h!==void 0)throw T("package");if(h=s(),!rr.test(h))throw T(h,"name");w=w.define(h),l(";")}function y(){var x=a(),k;switch(x){case"weak":k=v||(v=[]),s();break;case"public":s();default:k=f||(f=[]);break}x=P(),l(";"),k.push(x)}function S(){if(l("="),b=P(),E=b==="proto3",!E&&b!=="proto2")throw T(b,"syntax");e.setOption("syntax",b),l(";")}function p(x,k){switch(k){case"option":return Ie(x,k),l(";"),!0;case"message":return d(x,k),!0;case"enum":return Te(x,k),!0;case"service":return Ke(x,k),!0;case"extend":return ws(x,k),!0}return!1}function _(x,k,L){var Q=i.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=Mr.filename),l("{",!0)){for(var $;($=s())!=="}";)k($);l(";",!0)}else L&&L(),l(";"),x&&(typeof x.comment!="string"||r)&&(x.comment=c(Q)||x.comment)}function d(x,k){if(!nr.test(k=s()))throw T(k,"type name");var L=new QE(k);_(L,function($){if(!p(L,$))switch($){case"map":me(L,$);break;case"required":case"repeated":m(L,$);break;case"optional":E?m(L,"proto3_optional"):m(L,"optional");break;case"oneof":ke(L,$);break;case"extensions":W(L.extensions||(L.extensions=[]));break;case"reserved":W(L.reserved||(L.reserved=[]),!0);break;default:if(!E||!rr.test($))throw T($);o($),m(L,"optional");break}}),x.add(L)}function m(x,k,L){var Q=s();if(Q==="group"){V(x,k);return}for(;Q.endsWith(".")||a().startsWith(".");)Q+=s();if(!rr.test(Q))throw T(Q,"type");var $=s();if(!nr.test($))throw T($,"name");$=M($),l("=");var se=new YE($,C(s()),Q,k,L);if(_(se,function(Ut){if(Ut==="option")Ie(se,Ut),l(";");else throw T(Ut)},function(){gt(se)}),k==="proto3_optional"){var Fe=new XE("_"+$);se.setOption("proto3_optional",!0),Fe.add(se),x.add(Fe)}else x.add(se);!E&&se.repeated&&(Ig.packed[Q]!==void 0||Ig.basic[Q]===void 0)&&se.setOption("packed",!1,!0)}function V(x,k){var L=s();if(!nr.test(L))throw T(L,"name");var Q=Ag.lcFirst(L);L===Q&&(L=Ag.ucFirst(L)),l("=");var $=C(s()),se=new QE(L);se.group=!0;var Fe=new YE(Q,$,L,k);Fe.filename=Mr.filename,_(se,function(Ut){switch(Ut){case"option":Ie(se,Ut),l(";");break;case"required":case"repeated":m(se,Ut);break;case"optional":E?m(se,"proto3_optional"):m(se,"optional");break;case"message":d(se,Ut);break;case"enum":Te(se,Ut);break;default:throw T(Ut)}}),x.add(se).add(Fe)}function me(x){l("<");var k=s();if(Ig.mapKey[k]===void 0)throw T(k,"type");l(",");var L=s();if(!rr.test(L))throw T(L,"type");l(">");var Q=s();if(!nr.test(Q))throw T(Q,"name");l("=");var $=new WF(M(Q),C(s()),k,L);_($,function(Fe){if(Fe==="option")Ie($,Fe),l(";");else throw T(Fe)},function(){gt($)}),x.add($)}function ke(x,k){if(!nr.test(k=s()))throw T(k,"name");var L=new XE(M(k));_(L,function($){$==="option"?(Ie(L,$),l(";")):(o($),m(L,"optional"))}),x.add(L)}function Te(x,k){if(!nr.test(k=s()))throw T(k,"name");var L=new HF(k);_(L,function($){switch($){case"option":Ie(L,$),l(";");break;case"reserved":W(L.reserved||(L.reserved=[]),!0);break;default:je(L,$)}}),x.add(L)}function je(x,k){if(!nr.test(k))throw T(k,"name");l("=");var L=C(s(),!0),Q={options:void 0};Q.setOption=function($,se){this.options===void 0&&(this.options={}),this.options[$]=se},_(Q,function(se){if(se==="option")Ie(Q,se),l(";");else throw T(se)},function(){gt(Q)}),x.add(k,L,Q.comment,Q.options)}function Ie(x,k){var L=l("(",!0);if(!rr.test(k=s()))throw T(k,"name");var Q=k,$=Q,se;L&&(l(")"),Q="("+Q+")",$=Q,k=a(),rL.test(k)&&(se=k.slice(1),Q+=k,s())),l("=");var Fe=It(x,Q);Be(x,$,Fe,se)}function It(x,k){if(l("{",!0)){for(var L={};!l("}",!0);){if(!nr.test(vt=s()))throw T(vt,"name");if(vt===null)throw T(vt,"end of input");var Q,$=vt;if(l(":",!0),a()==="{")Q=It(x,k+"."+vt);else if(a()==="["){Q=[];var se;if(l("[",!0)){do se=N(!0),Q.push(se);while(l(",",!0));l("]"),typeof se<"u"&&He(x,k+"."+vt,se)}}else Q=N(!0),He(x,k+"."+vt,Q);var Fe=L[$];Fe&&(Q=[].concat(Fe).concat(Q)),L[$]=Q,l(",",!0),l(";",!0)}return L}var qr=N(!0);return He(x,k,qr),qr}function He(x,k,L){x.setOption&&x.setOption(k,L)}function Be(x,k,L,Q){x.setParsedOption&&x.setParsedOption(k,L,Q)}function gt(x){if(l("[",!0)){do Ie(x,"option");while(l(",",!0));l("]")}return x}function Ke(x,k){if(!nr.test(k=s()))throw T(k,"service name");var L=new KF(k);_(L,function($){if(!p(L,$))if($==="rpc")At(L,$);else throw T($)}),x.add(L)}function At(x,k){var L=c(),Q=k;if(!nr.test(k=s()))throw T(k,"name");var $=k,se,Fe,qr,Ut;if(l("("),l("stream",!0)&&(Fe=!0),!rr.test(k=s())||(se=k,l(")"),l("returns"),l("("),l("stream",!0)&&(Ut=!0),!rr.test(k=s())))throw T(k);qr=k,l(")");var cc=new QF($,Q,se,qr,Fe,Ut);cc.comment=L,_(cc,function(rf){if(rf==="option")Ie(cc,rf),l(";");else throw T(rf)}),x.add(cc)}function ws(x,k){if(!rr.test(k=s()))throw T(k,"reference");var L=k;_(null,function($){switch($){case"required":case"repeated":m(x,$,L);break;case"optional":E?m(x,"proto3_optional",L):m(x,"optional",L);break;default:if(!E||!rr.test($))throw T($);o($),m(x,"optional",L);break}})}for(var vt;(vt=s())!==null;)switch(vt){case"package":if(!u)throw T(vt);g();break;case"import":if(!u)throw T(vt);y();break;case"syntax":if(!u)throw T(vt);S();break;case"option":Ie(w,vt),l(";");break;default:if(p(w,vt)){u=!1;continue}throw T(vt)}return Mr.filename=null,{package:h,imports:f,weakImports:v,syntax:b,root:e}}});var nT=I((eW,tT)=>{"use strict";tT.exports=Rn;var iL=/\/|\./;function Rn(n,e){iL.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Rn[n]=e}Rn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var eT;Rn("duration",{Duration:eT={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Rn("timestamp",{Timestamp:eT});Rn("empty",{Empty:{fields:{}}});Rn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Rn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Rn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Rn.get=function(e){return Rn[e]||null}});var iT=I((tW,rT)=>{"use strict";var Ci=rT.exports=$E();Ci.build="full";Ci.tokenize=Tg();Ci.parse=ZE();Ci.common=nT();Ci.Root._configure(Ci.Type,Ci.parse,Ci.common)});var ed=I((nW,sT)=>{"use strict";sT.exports=iT()});var Rg=I((rW,sL)=>{sL.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var uT=I((ce,cT)=>{"use strict";var xt=ed();cT.exports=ce=xt.descriptor=xt.Root.fromJSON(Rg()).lookup(".google.protobuf");var oT=xt.Namespace,vl=xt.Root,xr=xt.Enum,_i=xt.Type,bi=xt.Field,oL=xt.MapField,td=xt.OneOf,Sl=xt.Service,nd=xt.Method;vl.fromDescriptor=function(e){typeof e.length=="number"&&(e=ce.FileDescriptorSet.decode(e));var t=new vl;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(_i.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(xr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(bi.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Sl.fromDescriptor(r.service[o]));var a=bo(r.options,ce.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};vl.prototype.toDescriptor=function(e){var t=ce.FileDescriptorSet.create();return aT(this,t.file,e),t};function aT(n,e,t){var r=ce.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof vl||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof _i?r.messageType.push(s.toDescriptor(t)):s instanceof xr?r.enumType.push(s.toDescriptor()):s instanceof bi?r.extension.push(s.toDescriptor(t)):s instanceof Sl?r.service.push(s.toDescriptor()):s instanceof oT&&aT(s,e,t);r.options=wo(n.options,ce.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var aL=0;_i.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=ce.DescriptorProto.decode(e));var r=new _i(e.name.length?e.name:"Type"+aL++,bo(e.options,ce.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(td.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=bi.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(bi.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(_i.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(xr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};_i.prototype.toDescriptor=function(e){var t=ce.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof oL){var s=Dg(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Dg(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&lT(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(ce.DescriptorProto.create({name:i.typeName,field:[ce.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),ce.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:ce.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof bi?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof _i?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof xr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(ce.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(ce.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=wo(this.options,ce.MessageOptions),t};var lL=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;bi.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=ce.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=fL(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new bi(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=bo(e.options,ce.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=lL.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return pL(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};bi.prototype.toDescriptor=function(e){var t=ce.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=xt.util.ucFirst(this.name),t.label=3;else{switch(t.type=Dg(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?lT(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=wo(this.options,ce.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=ce.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=ce.FieldOptions.create())).packed=!0),t};var cL=0;xr.fromDescriptor=function(e){typeof e.length=="number"&&(e=ce.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new xr(e.name&&e.name.length?e.name:"Enum"+cL++,t,bo(e.options,ce.EnumOptions))};xr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(ce.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return ce.EnumDescriptorProto.create({name:this.name,value:e,options:wo(this.options,ce.EnumOptions)})};var uL=0;td.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ce.OneofDescriptorProto.decode(e)),new td(e.name&&e.name.length?e.name:"oneof"+uL++)};td.prototype.toDescriptor=function(){return ce.OneofDescriptorProto.create({name:this.name})};var dL=0;Sl.fromDescriptor=function(e){typeof e.length=="number"&&(e=ce.ServiceDescriptorProto.decode(e));var t=new Sl(e.name&&e.name.length?e.name:"Service"+dL++,bo(e.options,ce.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(nd.fromDescriptor(e.method[r]));return t};Sl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return ce.ServiceDescriptorProto.create({name:this.name,method:e,options:wo(this.options,ce.ServiceOptions)})};var hL=0;nd.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ce.MethodDescriptorProto.decode(e)),new nd(e.name&&e.name.length?e.name:"Method"+hL++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,bo(e.options,ce.MethodOptions))};nd.prototype.toDescriptor=function(){return ce.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:wo(this.options,ce.MethodOptions)})};function fL(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function pL(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Dg(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof xr)return 14;if(e instanceof _i)return e.group?10:11;throw Error("illegal type: "+n)}function bo(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof xr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(mL(s),o));return t.length?xt.util.toObject(t):void 0}}function wo(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=xt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(xt.util.toObject(t)):void 0}}function lT(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof vl)&&e instanceof oT)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function mL(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var dT=I((iW,gL)=>{gL.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var hT=I((sW,yL)=>{yL.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var fT=I((oW,vL)=>{vL.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var yT=I(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.addCommonProtos=wi.loadProtosWithOptionsSync=wi.loadProtosWithOptions=void 0;var pT=be("fs"),mT=be("path"),Eo=ed();function gT(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(mT.isAbsolute(i))return i;for(let s of e){let o=mT.join(s,i);try{return pT.accessSync(o,pT.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function SL(n,e){return A(this,null,function*(){let t=new Eo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));gT(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}wi.loadProtosWithOptions=SL;function CL(n,e){let t=new Eo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");gT(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}wi.loadProtosWithOptionsSync=CL;function _L(){let n=dT(),e=Rg(),t=hT(),r=fT();Eo.common("api",n.nested.google.nested.protobuf.nested),Eo.common("descriptor",e.nested.google.nested.protobuf.nested),Eo.common("source_context",t.nested.google.nested.protobuf.nested),Eo.common("type",r.nested.google.nested.protobuf.nested)}wi.addCommonProtos=_L});var CT=I((ST,Og)=>{"use strict";var vT=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(d,m,V){this.low=d|0,this.high=m|0,this.unsigned=!!V}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(d){return(d&&d.__isLong__)===!0}function i(d){var m=Math.clz32(d&-d);return d?31-m:m}t.isLong=r;var s={},o={};function a(d,m){var V,me,ke;return m?(d>>>=0,(ke=0<=d&&d<256)&&(me=o[d],me)?me:(V=c(d,0,!0),ke&&(o[d]=V),V)):(d|=0,(ke=-128<=d&&d<128)&&(me=s[d],me)?me:(V=c(d,d<0?-1:0,!1),ke&&(s[d]=V),V))}t.fromInt=a;function l(d,m){if(isNaN(d))return m?N:P;if(m){if(d<0)return N;if(d>=w)return y}else{if(d<=-M)return S;if(d+1>=M)return g}return d<0?l(-d,m).neg():c(d%E|0,d/E|0,m)}t.fromNumber=l;function c(d,m,V){return new t(d,m,V)}t.fromBits=c;var u=Math.pow;function h(d,m,V){if(d.length===0)throw Error("empty string");if(typeof m=="number"?(V=m,m=!1):m=!!m,d==="NaN"||d==="Infinity"||d==="+Infinity"||d==="-Infinity")return m?N:P;if(V=V||10,V<2||36<V)throw RangeError("radix");var me;if((me=d.indexOf("-"))>0)throw Error("interior hyphen");if(me===0)return h(d.substring(1),m,V).neg();for(var ke=l(u(V,8)),Te=P,je=0;je<d.length;je+=8){var Ie=Math.min(8,d.length-je),It=parseInt(d.substring(je,je+Ie),V);if(Ie<8){var He=l(u(V,Ie));Te=Te.mul(He).add(l(It))}else Te=Te.mul(ke),Te=Te.add(l(It))}return Te.unsigned=m,Te}t.fromString=h;function f(d,m){return typeof d=="number"?l(d,m):typeof d=="string"?h(d,m):c(d.low,d.high,typeof m=="boolean"?m:d.unsigned)}t.fromValue=f;var v=65536,b=1<<24,E=v*v,w=E*E,M=w/2,T=a(b),P=a(0);t.ZERO=P;var N=a(0,!0);t.UZERO=N;var W=a(1);t.ONE=W;var X=a(1,!0);t.UONE=X;var C=a(-1);t.NEG_ONE=C;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var S=c(0,-2147483648,!1);t.MIN_VALUE=S;var p=t.prototype;p.toInt=function(){return this.unsigned?this.low>>>0:this.low},p.toNumber=function(){return this.unsigned?(this.high>>>0)*E+(this.low>>>0):this.high*E+(this.low>>>0)},p.toString=function(m){if(m=m||10,m<2||36<m)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(S)){var V=l(m),me=this.div(V),ke=me.mul(V).sub(this);return me.toString(m)+ke.toInt().toString(m)}else return"-"+this.neg().toString(m);for(var Te=l(u(m,6),this.unsigned),je=this,Ie="";;){var It=je.div(Te),He=je.sub(It.mul(Te)).toInt()>>>0,Be=He.toString(m);if(je=It,je.isZero())return Be+Ie;for(;Be.length<6;)Be="0"+Be;Ie=""+Be+Ie}},p.getHighBits=function(){return this.high},p.getHighBitsUnsigned=function(){return this.high>>>0},p.getLowBits=function(){return this.low},p.getLowBitsUnsigned=function(){return this.low>>>0},p.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var m=this.high!=0?this.high:this.low,V=31;V>0&&!(m&1<<V);V--);return this.high!=0?V+33:V+1},p.isZero=function(){return this.high===0&&this.low===0},p.eqz=p.isZero,p.isNegative=function(){return!this.unsigned&&this.high<0},p.isPositive=function(){return this.unsigned||this.high>=0},p.isOdd=function(){return(this.low&1)===1},p.isEven=function(){return(this.low&1)===0},p.equals=function(m){return r(m)||(m=f(m)),this.unsigned!==m.unsigned&&this.high>>>31===1&&m.high>>>31===1?!1:this.high===m.high&&this.low===m.low},p.eq=p.equals,p.notEquals=function(m){return!this.eq(m)},p.neq=p.notEquals,p.ne=p.notEquals,p.lessThan=function(m){return this.comp(m)<0},p.lt=p.lessThan,p.lessThanOrEqual=function(m){return this.comp(m)<=0},p.lte=p.lessThanOrEqual,p.le=p.lessThanOrEqual,p.greaterThan=function(m){return this.comp(m)>0},p.gt=p.greaterThan,p.greaterThanOrEqual=function(m){return this.comp(m)>=0},p.gte=p.greaterThanOrEqual,p.ge=p.greaterThanOrEqual,p.compare=function(m){if(r(m)||(m=f(m)),this.eq(m))return 0;var V=this.isNegative(),me=m.isNegative();return V&&!me?-1:!V&&me?1:this.unsigned?m.high>>>0>this.high>>>0||m.high===this.high&&m.low>>>0>this.low>>>0?-1:1:this.sub(m).isNegative()?-1:1},p.comp=p.compare,p.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(W)},p.neg=p.negate,p.add=function(m){r(m)||(m=f(m));var V=this.high>>>16,me=this.high&65535,ke=this.low>>>16,Te=this.low&65535,je=m.high>>>16,Ie=m.high&65535,It=m.low>>>16,He=m.low&65535,Be=0,gt=0,Ke=0,At=0;return At+=Te+He,Ke+=At>>>16,At&=65535,Ke+=ke+It,gt+=Ke>>>16,Ke&=65535,gt+=me+Ie,Be+=gt>>>16,gt&=65535,Be+=V+je,Be&=65535,c(Ke<<16|At,Be<<16|gt,this.unsigned)},p.subtract=function(m){return r(m)||(m=f(m)),this.add(m.neg())},p.sub=p.subtract,p.multiply=function(m){if(this.isZero())return this;if(r(m)||(m=f(m)),e){var V=e.mul(this.low,this.high,m.low,m.high);return c(V,e.get_high(),this.unsigned)}if(m.isZero())return this.unsigned?N:P;if(this.eq(S))return m.isOdd()?S:P;if(m.eq(S))return this.isOdd()?S:P;if(this.isNegative())return m.isNegative()?this.neg().mul(m.neg()):this.neg().mul(m).neg();if(m.isNegative())return this.mul(m.neg()).neg();if(this.lt(T)&&m.lt(T))return l(this.toNumber()*m.toNumber(),this.unsigned);var me=this.high>>>16,ke=this.high&65535,Te=this.low>>>16,je=this.low&65535,Ie=m.high>>>16,It=m.high&65535,He=m.low>>>16,Be=m.low&65535,gt=0,Ke=0,At=0,ws=0;return ws+=je*Be,At+=ws>>>16,ws&=65535,At+=Te*Be,Ke+=At>>>16,At&=65535,At+=je*He,Ke+=At>>>16,At&=65535,Ke+=ke*Be,gt+=Ke>>>16,Ke&=65535,Ke+=Te*He,gt+=Ke>>>16,Ke&=65535,Ke+=je*It,gt+=Ke>>>16,Ke&=65535,gt+=me*Be+ke*He+Te*It+je*Ie,gt&=65535,c(At<<16|ws,gt<<16|Ke,this.unsigned)},p.mul=p.multiply,p.divide=function(m){if(r(m)||(m=f(m)),m.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&m.low===-1&&m.high===-1)return this;var V=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,m.low,m.high);return c(V,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?N:P;var me,ke,Te;if(this.unsigned){if(m.unsigned||(m=m.toUnsigned()),m.gt(this))return N;if(m.gt(this.shru(1)))return X;Te=N}else{if(this.eq(S)){if(m.eq(W)||m.eq(C))return S;if(m.eq(S))return W;var je=this.shr(1);return me=je.div(m).shl(1),me.eq(P)?m.isNegative()?W:C:(ke=this.sub(m.mul(me)),Te=me.add(ke.div(m)),Te)}else if(m.eq(S))return this.unsigned?N:P;if(this.isNegative())return m.isNegative()?this.neg().div(m.neg()):this.neg().div(m).neg();if(m.isNegative())return this.div(m.neg()).neg();Te=P}for(ke=this;ke.gte(m);){me=Math.max(1,Math.floor(ke.toNumber()/m.toNumber()));for(var Ie=Math.ceil(Math.log(me)/Math.LN2),It=Ie<=48?1:u(2,Ie-48),He=l(me),Be=He.mul(m);Be.isNegative()||Be.gt(ke);)me-=It,He=l(me,this.unsigned),Be=He.mul(m);He.isZero()&&(He=W),Te=Te.add(He),ke=ke.sub(Be)}return Te},p.div=p.divide,p.modulo=function(m){if(r(m)||(m=f(m)),e){var V=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,m.low,m.high);return c(V,e.get_high(),this.unsigned)}return this.sub(this.div(m).mul(m))},p.mod=p.modulo,p.rem=p.modulo,p.not=function(){return c(~this.low,~this.high,this.unsigned)},p.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},p.clz=p.countLeadingZeros,p.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},p.ctz=p.countTrailingZeros,p.and=function(m){return r(m)||(m=f(m)),c(this.low&m.low,this.high&m.high,this.unsigned)},p.or=function(m){return r(m)||(m=f(m)),c(this.low|m.low,this.high|m.high,this.unsigned)},p.xor=function(m){return r(m)||(m=f(m)),c(this.low^m.low,this.high^m.high,this.unsigned)},p.shiftLeft=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low<<m,this.high<<m|this.low>>>32-m,this.unsigned):c(0,this.low<<m-32,this.unsigned)},p.shl=p.shiftLeft,p.shiftRight=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>m,this.unsigned):c(this.high>>m-32,this.high>=0?0:-1,this.unsigned)},p.shr=p.shiftRight,p.shiftRightUnsigned=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>>m,this.unsigned):m===32?c(this.high,0,this.unsigned):c(this.high>>>m-32,0,this.unsigned)},p.shru=p.shiftRightUnsigned,p.shr_u=p.shiftRightUnsigned,p.rotateLeft=function(m){var V;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(V=32-m,c(this.low<<m|this.high>>>V,this.high<<m|this.low>>>V,this.unsigned)):(m-=32,V=32-m,c(this.high<<m|this.low>>>V,this.low<<m|this.high>>>V,this.unsigned))},p.rotl=p.rotateLeft,p.rotateRight=function(m){var V;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(V=32-m,c(this.high<<V|this.low>>>m,this.low<<V|this.high>>>m,this.unsigned)):(m-=32,V=32-m,c(this.low<<V|this.high>>>m,this.high<<V|this.low>>>m,this.unsigned))},p.rotr=p.rotateRight,p.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},p.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},p.toBytes=function(m){return m?this.toBytesLE():this.toBytesBE()},p.toBytesLE=function(){var m=this.high,V=this.low;return[V&255,V>>>8&255,V>>>16&255,V>>>24,m&255,m>>>8&255,m>>>16&255,m>>>24]},p.toBytesBE=function(){var m=this.high,V=this.low;return[m>>>24,m>>>16&255,m>>>8&255,m&255,V>>>24,V>>>16&255,V>>>8&255,V&255]},t.fromBytes=function(m,V,me){return me?t.fromBytesLE(m,V):t.fromBytesBE(m,V)},t.fromBytesLE=function(m,V){return new t(m[0]|m[1]<<8|m[2]<<16|m[3]<<24,m[4]|m[5]<<8|m[6]<<16|m[7]<<24,V)},t.fromBytesBE=function(m,V){return new t(m[4]<<24|m[5]<<16|m[6]<<8|m[7],m[0]<<24|m[1]<<16|m[2]<<8|m[3],V)};var _=t;return n.default=_,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return vT}):typeof Og=="object"&&typeof ST=="object"&&(Og.exports=vT)});var Pg=I(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.loadFileDescriptorSetFromObject=st.loadFileDescriptorSetFromBuffer=st.fromJSON=st.loadSync=st.load=st.IdempotencyLevel=st.isAnyExtension=st.Long=void 0;var bL=aw(),ir=ed(),xg=uT(),kg=yT(),wL=CT();st.Long=wL;function EL(n){return"@type"in n&&typeof n["@type"]=="string"}st.isAnyExtension=EL;var wT;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(wT=st.IdempotencyLevel||(st.IdempotencyLevel={}));var ET={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function TL(n,e){return n===""?e:n+"."+e}function IL(n){return n instanceof ir.Service||n instanceof ir.Type||n instanceof ir.Enum}function AL(n){return n instanceof ir.Namespace||n instanceof ir.Root}function TT(n,e){let t=TL(e,n.name);return IL(n)?[[t,n]]:AL(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>TT(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function _T(n,e){return function(r){return n.toObject(n.decode(r),e)}}function bT(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function RL(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:wT.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function DL(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:bT(i),requestDeserialize:_T(i,t),responseSerialize:bT(s),responseDeserialize:_T(s,t),originalName:bL(n.name),requestType:Mg(i,r),responseType:Mg(s,r),options:RL(n.parsedOptions)}}function OL(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=DL(s,e,t,r);return i}function Mg(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,ET),fileDescriptorProtos:e}}function ML(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,ET),fileDescriptorProtos:e}}function xL(n,e,t,r){if(n instanceof ir.Service)return OL(n,e,t,r);if(n instanceof ir.Type)return Mg(n,r);if(n instanceof ir.Enum)return ML(n,r);throw new Error("Type mismatch in reflection object handling")}function rd(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(xg.FileDescriptorProto.encode(s).finish()));for(let[s,o]of TT(n,""))t[s]=xL(o,s,e,i);return t}function IT(n,e){e=e||{};let t=ir.Root.fromDescriptor(n);return t.resolveAll(),rd(t,e)}function kL(n,e){return(0,kg.loadProtosWithOptions)(n,e).then(t=>rd(t,e))}st.load=kL;function PL(n,e){let t=(0,kg.loadProtosWithOptionsSync)(n,e);return rd(t,e)}st.loadSync=PL;function NL(n,e){e=e||{};let t=ir.Root.fromJSON(n);return t.resolveAll(),rd(t,e)}st.fromJSON=NL;function FL(n,e){let t=xg.FileDescriptorSet.decode(n);return IT(t,e)}st.loadFileDescriptorSetFromBuffer=FL;function LL(n,e){let t=xg.FileDescriptorSet.fromObject(n);return IT(t,e)}st.loadFileDescriptorSetFromObject=LL;(0,kg.addCommonProtos)()});var ns=I(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.setup=Pe.getChannelzServiceDefinition=Pe.getChannelzHandlers=Pe.unregisterChannelzRef=Pe.registerChannelzSocket=Pe.registerChannelzServer=Pe.registerChannelzSubchannel=Pe.registerChannelzChannel=Pe.ChannelzCallTracker=Pe.ChannelzChildrenTracker=Pe.ChannelzTrace=void 0;var AT=be("net"),Cl=an(),bl=Se(),VL=Qn(),BL=Eu(),UL=Mm();function Ng(n){return{channel_id:n.id,name:n.name}}function Bg(n){return{subchannel_id:n.id,name:n.name}}function qL(n){return{server_id:n.id}}function sd(n){return{socket_id:n.id,name:n.name}}var RT=32,Fg=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=RT*2&&(this.events=this.events.slice(RT)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:kr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:kr(e.timestamp),channel_ref:e.childChannel?Ng(e.childChannel):null,subchannel_ref:e.childSubchannel?Bg(e.childSubchannel):null}))}}};Pe.ChannelzTrace=Fg;var Lg=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Pe.ChannelzChildrenTracker=Lg;var Vg=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Pe.ChannelzCallTracker=Vg;var zL=1;function od(){return zL++}var _l=[],Ug=[],Ei=[],qg=[];function jL(n,e,t){let r=od(),i={id:r,name:n,kind:"channel"};return t&&(_l[r]={ref:i,getInfo:e}),i}Pe.registerChannelzChannel=jL;function $L(n,e,t){let r=od(),i={id:r,name:n,kind:"subchannel"};return t&&(Ug[r]={ref:i,getInfo:e}),i}Pe.registerChannelzSubchannel=$L;function GL(n,e){let t=od(),r={id:t,kind:"server"};return e&&(Ei[t]={ref:r,getInfo:n}),r}Pe.registerChannelzServer=GL;function WL(n,e,t){let r=od(),i={id:r,name:n,kind:"socket"};return t&&(qg[r]={ref:i,getInfo:e}),i}Pe.registerChannelzSocket=WL;function HL(n){switch(n.kind){case"channel":delete _l[n.id];return;case"subchannel":delete Ug[n.id];return;case"server":delete Ei[n.id];return;case"socket":delete qg[n.id];return}}Pe.unregisterChannelzRef=HL;function KL(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function DT(n){if(n==="")return[];let e=n.split(":").map(r=>KL(r));return[].concat(...e)}function QL(n){if((0,AT.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,AT.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(DT(e)),s=Buffer.from(DT(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function MT(n){switch(n){case Cl.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Cl.ConnectivityState.IDLE:return{state:"IDLE"};case Cl.ConnectivityState.READY:return{state:"READY"};case Cl.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Cl.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function kr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function xT(n){let e=n.getInfo();return{ref:Ng(n.ref),data:{target:e.target,state:MT(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:kr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Ng(t)),subchannel_ref:e.children.subchannels.map(t=>Bg(t))}}function YL(n,e){let t=Number.parseInt(n.request.channel_id),r=_l[t];if(r===void 0){e({code:bl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:xT(r)})}function XL(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<_l.length;i++){let s=_l[i];if(s!==void 0&&(r.push(xT(s)),r.length>=t))break}e(null,{channel:r,end:i>=Ei.length})}function kT(n){let e=n.getInfo();return{ref:qL(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:kr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>sd(t))}}function JL(n,e){let t=Number.parseInt(n.request.server_id),r=Ei[t];if(r===void 0){e({code:bl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:kT(r)})}function ZL(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<Ei.length;i++){let s=Ei[i];if(s!==void 0&&(r.push(kT(s)),r.length>=t))break}e(null,{server:r,end:i>=Ei.length})}function e2(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Ug[t];if(r===void 0){e({code:bl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Bg(r.ref),data:{target:i.target,state:MT(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:kr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>sd(o))};e(null,{subchannel:s})}function OT(n){var e;return(0,VL.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=QL(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function t2(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=qg[a];if(l===void 0){e({code:bl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,h={ref:sd(l.ref),local:c.localAddress?OT(c.localAddress):null,remote:c.remoteAddress?OT(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:kr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:kr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:kr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:kr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:h})}function n2(n,e){let t=Number.parseInt(n.request.server_id),r=Ei[t];if(r===void 0){e({code:bl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,h)=>u.id-h.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(sd(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function PT(){return{GetChannel:YL,GetTopChannels:XL,GetServer:JL,GetServers:ZL,GetSubchannel:e2,GetSocket:t2,GetServerSockets:n2}}Pe.getChannelzHandlers=PT;var id=null;function NT(){if(id)return id;let n=Pg().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return id=(0,UL.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,id}Pe.getChannelzServiceDefinition=NT;function r2(){(0,BL.registerAdminService)(NT,PT)}Pe.setup=r2});var FT=I(ld=>{"use strict";Object.defineProperty(ld,"__esModule",{value:!0});ld.Subchannel=void 0;var Me=an(),i2=tl(),zg=qe(),ad=Se(),s2=Gt(),o2=Qn(),To=ns(),a2="subchannel",l2=~(1<<31),jg=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Me.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new To.ChannelzCallTracker,this.childrenTracker=new To.ChannelzChildrenTracker,this.streamTracker=new To.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i2.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,o2.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new To.ChannelzTrace,this.channelzRef=(0,To.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){zg.trace(ad.LogVerbosity.DEBUG,a2,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){zg.trace(ad.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Me.ConnectivityState.TRANSIENT_FAILURE],Me.ConnectivityState.CONNECTING):this.transitionToState([Me.ConnectivityState.TRANSIENT_FAILURE],Me.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,l2);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Me.ConnectivityState.CONNECTING],Me.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Me.ConnectivityState.READY],Me.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,zg.log(ad.LogVerbosity.ERROR,`Connection to ${(0,s2.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Me.ConnectivityState.CONNECTING],Me.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Me.ConnectivityState[this.connectivityState]+" -> "+Me.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Me.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Me.ConnectivityState.READY:this.stopBackoff();break;case Me.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Me.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Me.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,To.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Me.ConnectivityState.CONNECTING,Me.ConnectivityState.READY],Me.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===ad.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Me.ConnectivityState.IDLE],Me.ConnectivityState.CONNECTING)||this.connectivityState===Me.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Me.ConnectivityState.TRANSIENT_FAILURE],Me.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};ld.Subchannel=jg});var Hg=I(Ai=>{"use strict";Object.defineProperty(Ai,"__esModule",{value:!0});Ai.setup=Ai.DEFAULT_PORT=void 0;var LT=Hn(),BT=be("dns"),UT=be("util"),c2=im(),$g=Se(),Gg=Ft(),u2=qe(),d2=Se(),Ti=Gt(),VT=be("net"),h2=tl(),f2="dns_resolver";function Ii(n){u2.trace(d2.LogVerbosity.DEBUG,f2,n)}Ai.DEFAULT_PORT=443;var p2=3e4,m2=UT.promisify(BT.resolveTxt),g2=UT.promisify(BT.lookup);function y2(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Wg=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Ii("Resolver constructed for target "+(0,Ti.uriToString)(e));let a=(0,Ti.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,VT.isIPv4)(a.host)||(0,VT.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Ai.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Ai.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:$g.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Ti.uriToString)(this.target)}`,metadata:new Gg.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new h2.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:p2,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Ii("Returning IP address for target "+(0,Ti.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Ii("Failed to parse DNS address "+(0,Ti.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:$g.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Ti.uriToString)(this.target)}`,metadata:new Gg.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Ii("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=g2(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=y2(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(Ii("Resolved addresses for target "+(0,Ti.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Ii("Resolution error for target "+(0,Ti.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=m2(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,c2.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:$g.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Gg.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Ii('resolution update delayed by "min time between resolutions" rate limit'):Ii("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function v2(){(0,LT.registerResolver)("dns",Wg),(0,LT.registerDefaultScheme)("dns")}Ai.setup=v2});var Kg=I(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.getProxiedConnection=Ro.mapProxyName=void 0;var wl=qe(),Io=Se(),S2=Hn(),C2=be("http"),_2=be("tls"),b2=qe(),qT=Qn(),Ao=Gt(),w2=be("url"),E2=Hg(),T2="proxy";function Ri(n){b2.trace(Io.LogVerbosity.DEBUG,T2,n)}function I2(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new w2.URL(n)}catch{return(0,wl.log)(Io.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,wl.log)(Io.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,wl.log)(Io.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),Ri("Proxy server "+o.address+" set by environment variable "+e),o}function A2(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Ri("No proxy server list set by environment variable "+e),n.split(",")):[]}function R2(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=I2();if(!i.address)return r;let s=(0,Ao.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of A2())if(l===o)return Ri("Not using proxy for target in no_proxy list: "+(0,Ao.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,Ao.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Ro.mapProxyName=R2;function D2(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,Ao.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,Ao.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:E2.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,qT.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,qT.subchannelAddressToString)(n);return Ri("Using proxy "+u+" to connect to "+l.path),new Promise((h,f)=>{let v=C2.request(l);v.once("connect",(b,E,w)=>{var M;if(v.removeAllListeners(),E.removeAllListeners(),b.statusCode===200)if(Ri("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let T=(0,S2.getDefaultAuthority)(s),P=(0,Ao.splitHostPort)(T),N=(M=P?.host)!==null&&M!==void 0?M:T,W=_2.connect(Object.assign({host:N,servername:N,socket:E},t),()=>{Ri("Successfully established a TLS connection to "+l.path+" through proxy "+u),h({socket:W,realTarget:s})});W.on("error",X=>{Ri("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+X.message),f()})}else Ri("Successfully established a plaintext connection to "+l.path+" through proxy "+u),h({socket:E,realTarget:s});else(0,wl.log)(Io.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+b.statusCode),f()}),v.once("error",b=>{v.removeAllListeners(),(0,wl.log)(Io.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+b.message),f()}),v.end()})}Ro.getProxiedConnection=D2});var Yg=I(cd=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});cd.StreamDecoder=void 0;var Pr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Pr||{}),Qg=class{constructor(e){this.maxReadMessageLength=e,this.readState=Pr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case Pr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Pr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Pr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Pr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Pr.NO_DATA,i.push(s)}}break;case Pr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=Pr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};cd.StreamDecoder=Qg});var zT=I(ud=>{"use strict";Object.defineProperty(ud,"__esModule",{value:!0});ud.Http2SubchannelCall=void 0;var Nr=be("http2"),O2=be("os"),we=Se(),Di=Ft(),M2=Yg(),x2=qe(),k2=Se(),P2="subchannel_call";function N2(n){for(let[e,t]of Object.entries(O2.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Xg=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=we.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:we.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new M2.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let h of Object.keys(l))u+="		"+h+": "+l[h]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=we.Status.INTERNAL;break;case 401:this.mappedStatusCode=we.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=we.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=we.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=we.Status.UNAVAILABLE;break;default:this.mappedStatusCode=we.Status.UNKNOWN}if(c&Nr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let h;try{h=Di.Metadata.fromHttp2Headers(l)}catch(f){this.endCall({code:we.Status.UNKNOWN,details:f.message,metadata:new Di.Metadata});return}this.listener.onReceiveMetadata(h)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(we.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===we.Status.OK)return;let c,u="";switch(e.rstCode){case Nr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=we.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case Nr.constants.NGHTTP2_REFUSED_STREAM:c=we.Status.UNAVAILABLE,u="Stream refused by server";break;case Nr.constants.NGHTTP2_CANCEL:c=we.Status.CANCELLED,u="Call cancelled";break;case Nr.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=we.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case Nr.constants.NGHTTP2_INADEQUATE_SECURITY:c=we.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case Nr.constants.NGHTTP2_INTERNAL_ERROR:c=we.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=we.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=we.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Di.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+N2(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:we.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Di.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){x2.trace(k2.LogVerbosity.DEBUG,P2,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===we.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==we.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Di.Metadata.fromHttp2Headers(e)}catch{r=new Di.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===we.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in we.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===we.Status.OK?t=Nr.constants.NGHTTP2_NO_ERROR:t=Nr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Di.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==we.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=we.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=we.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:we.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Di.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};ud.Http2SubchannelCall=Xg});var Jg=I(dd=>{"use strict";Object.defineProperty(dd,"__esModule",{value:!0});dd.getNextCallNumber=void 0;var F2=0;function L2(){return F2++}dd.getNextCallNumber=L2});var GT=I(fd=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});fd.Http2SubchannelConnector=void 0;var ry=be("http2"),jT=be("tls"),Zg=ns(),El=Se(),V2=Kg(),Oo=qe(),$T=Hn(),hd=Qn(),Do=Gt(),B2=be("net"),U2=zT(),q2=Jg(),ey="transport",z2="transport_flowctrl",j2=Up().version,{HTTP2_HEADER_AUTHORITY:$2,HTTP2_HEADER_CONTENT_TYPE:G2,HTTP2_HEADER_METHOD:W2,HTTP2_HEADER_PATH:H2,HTTP2_HEADER_TE:K2,HTTP2_HEADER_USER_AGENT:Q2}=ry.constants,Y2=2e4,X2=Buffer.from("too_many_pings","ascii"),ty=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=Y2,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Zg.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,hd.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Zg.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${j2}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===ry.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(X2)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Oo.isTracerEnabled(ey)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,hd.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,hd.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),h=c.getCertificate(),f=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:h&&"raw"in h?h.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Oo.trace(El.LogVerbosity.DEBUG,ey,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Oo.trace(El.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Oo.trace(El.LogVerbosity.DEBUG,z2,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Oo.trace(El.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[$2]=t,o[Q2]=this.userAgent,o[G2]="application/grpc",o[W2]="POST",o[H2]=r,o[K2]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}},c=new U2.Http2SubchannelCall(a,l,i,this,(0,q2.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,Zg.unregisterChannelzRef)(this.channelzRef)}},ny=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Oo.trace(El.LogVerbosity.DEBUG,ey,(0,Do.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Do.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Do.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,hd.subchannelAddressToString)(e)));let h=(0,$T.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in f){if(v="https://",r["grpc.ssl_target_name_override"]){let w=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(M,T)=>(0,jT.checkServerIdentity)(w,T),f.servername=w}else{let w=(c=(l=(0,Do.splitHostPort)(h))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=w}i.socket&&(f.createConnection=(w,M)=>i.socket)}else f.createConnection=(w,M)=>i.socket?i.socket:B2.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let b=ry.connect(v+h,f);this.session=b;let E="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),s(new ty(b,e,r,u)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${E} (${new Date().toISOString()})`)})}),b.once("error",w=>{E=w.message,this.trace("connection failed with error "+E)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,jT.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,$T.getDefaultAuthority)((i=(0,Do.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Do.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,V2.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};fd.Http2SubchannelConnector=ny});var WT=I(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.getSubchannelPool=Mo.SubchannelPool=void 0;var J2=Db(),Z2=FT(),eV=Qn(),tV=Gt(),nV=GT(),rV=1e4,Tl=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},rV),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,tV.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,eV.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,J2.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new Z2.Subchannel(e,t,r,i,new nV.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Mo.SubchannelPool=Tl;var iV=new Tl;function sV(n){return n?iV:new Tl}Mo.getSubchannelPool=sV});var sy=I(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.FilterStackFactory=xo.FilterStack=void 0;var pd=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};xo.FilterStack=pd;var iy=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new pd(this.factories.map(e=>e.createFilter()))}};xo.FilterStackFactory=iy});var oy=I(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.CompressionAlgorithms=void 0;var HT=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(HT||(md.CompressionAlgorithms=HT={}))});var ly=I(gd=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});gd.BaseFilter=void 0;var ay=class{sendMetadata(e){return A(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return A(this,null,function*(){return e})}receiveMessage(e){return A(this,null,function*(){return e})}receiveTrailers(e){return e}};gd.BaseFilter=ay});var YT=I(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.CompressionFilterFactory=Po.CompressionFilter=void 0;var yd=be("zlib"),QT=oy(),vd=Se(),oV=ly(),aV=qe(),lV=n=>typeof n=="number"&&typeof QT.CompressionAlgorithms[n]=="string",ko=class{writeMessage(e,t){return A(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return A(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},rs=class extends ko{compressMessage(e){return A(this,null,function*(){return e})}writeMessage(e,t){return A(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},cy=class extends ko{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{yd.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=yd.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:vd.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},uy=class extends ko{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{yd.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=yd.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:vd.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},dy=class extends ko{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function KT(n,e){switch(n){case"identity":return new rs;case"deflate":return new cy(e);case"gzip":return new uy(e);default:return new dy(n)}}var Sd=class extends oV.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new rs,this.receiveCompression=new rs,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:vd.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(lV(s)){let o=QT.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=KT(this.currentCompressionAlgorithm,-1))}else aV.log(vd.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return A(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=KT(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new rs,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return A(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof rs?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return A(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Po.CompressionFilter=Sd;var hy=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Sd(this.options,this.sharedFilterConfig)}};Po.CompressionFilterFactory=hy});var Cd=I(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.deadlineToString=sr.getRelativeTimeout=sr.getDeadlineTimeoutString=sr.minDeadline=void 0;function cV(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}sr.minDeadline=cV;var uV=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function dV(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of uV){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}sr.getDeadlineTimeoutString=dV;var hV=2147483647;function fV(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>hV?1/0:r}sr.getRelativeTimeout=fV;function pV(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}sr.deadlineToString=pV});var bd=I(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.restrictControlPlaneStatusCode=void 0;var or=Se(),mV=[or.Status.OK,or.Status.INVALID_ARGUMENT,or.Status.NOT_FOUND,or.Status.ALREADY_EXISTS,or.Status.FAILED_PRECONDITION,or.Status.ABORTED,or.Status.OUT_OF_RANGE,or.Status.DATA_LOSS];function gV(n,e){return mV.includes(n)?{code:or.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${or.Status[n]} ${e}`}:{code:n,details:e}}_d.restrictControlPlaneStatusCode=gV});var JT=I(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});Td.LoadBalancingCall=void 0;var XT=an(),wd=Se(),yV=Cd(),Ed=Ft(),Il=fi(),vV=Gt(),SV=qe(),fy=bd(),CV=be("http2"),_V="load_balancing_call",py=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),h="";u.length>=2&&(h=u[1]);let f=(c=(l=(0,vV.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${h}`}trace(e){SV.trace(wd.LogVerbosity.DEBUG,_V,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Il.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Il.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let h=this.metadata.clone();if(h.merge(a),h.get("authorization").length>1&&this.outputStatus({code:wd.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Ed.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==XT.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+XT.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&h.set("grpc-timeout",(0,yV.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(h,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===CV.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:wd.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new Ed.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,fy.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:wd.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new Ed.Metadata},"PROCESSED")});break;case Il.PickResultType.DROP:let{code:s,details:o}=(0,fy.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Il.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,fy.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Il.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Ed.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Td.LoadBalancingCall=py});var eI=I(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.ResolvingCall=void 0;var No=Se(),Id=Cd(),ZT=Ft(),bV=qe(),wV=bd(),EV="resolving_call",my=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&No.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(No.Status.CANCELLED,"Cancelled by parent call")}),r.flags&No.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Id.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){bV.trace(No.LogVerbosity.DEBUG,EV,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Id.deadlineToString)(this.deadline));let e=(0,Id.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(No.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==No.Status.OK){let{code:r,details:i}=(0,wV.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new ZT.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Id.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ZT.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Ad.ResolvingCall=my});var tI=I(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.RetryingCall=Oi.MessageBufferTracker=Oi.RetryThrottler=void 0;var Rd=Se(),TV=Ft(),IV=qe(),AV="retrying_call",yy=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Oi.RetryThrottler=yy;var vy=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Oi.MessageBufferTracker=vy;var gy="grpc-previous-rpc-attempts",Sy=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){IV.trace(Rd.LogVerbosity.DEBUG,AV,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new TV.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Rd.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===Rd.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Rd.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(gy,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(gy,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(gy,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Oi.RetryingCall=Sy});var Od=I(Dd=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});Dd.BaseSubchannelWrapper=void 0;var Cy=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Dd.BaseSubchannelWrapper=Cy});var iI=I(kd=>{"use strict";Object.defineProperty(kd,"__esModule",{value:!0});kd.InternalChannel=void 0;var RV=mu(),DV=Rb(),OV=WT(),nI=fi(),Al=Se(),MV=sy(),xV=YT(),rI=Hn(),_y=qe(),kV=Kg(),Md=Gt(),ar=an(),Rl=ns(),PV=JT(),NV=Cd(),FV=eI(),by=Jg(),LV=bd(),wy=tI(),VV=Od(),BV=2147483647,UV=1e3,qV=30*60*1e3,xd=new Map,zV=1<<24,jV=1<<20,Ey=class extends VV.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Ty=class{constructor(e,t,r){var i,s,o,a,l,c,u,h;if(this.credentials=t,this.options=r,this.connectivityState=ar.ConnectivityState.IDLE,this.currentPicker=new nI.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Rl.ChannelzCallTracker,this.childrenTracker=new Rl.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof RV.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,Md.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let v=(0,rI.mapUriDefaultScheme)(f);if(v===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},BV),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Rl.ChannelzTrace,this.channelzRef=(0,Rl.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,rI.getDefaultAuthority)(v);let b=(0,kV.mapProxyName)(v,r);this.target=b.target,this.options=Object.assign({},this.options,b.extraOptions),this.subchannelPool=(0,OV.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new wy.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:zV,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:jV),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:qV,UV);let E={createSubchannel:(M,T)=>{let P=this.subchannelPool.getOrCreateSubchannel(this.target,M,Object.assign({},this.options,T),this.credentials);P.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",P.getChannelzRef());let N=new Ey(P,this);return this.wrappedSubchannels.add(N),N},updateState:(M,T)=>{this.currentPicker=T;let P=this.pickQueue.slice();this.pickQueue=[],P.length>0&&this.callRefTimerUnref();for(let N of P)N.doPick();this.updateState(M)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.refChild(M)},removeChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.unrefChild(M)}};this.resolvingLoadBalancer=new DV.ResolvingLoadBalancer(this.target,E,r,(M,T)=>{M.retryThrottling?xd.set(this.getTarget(),new wy.RetryThrottler(M.retryThrottling.maxTokens,M.retryThrottling.tokenRatio,xd.get(this.getTarget()))):xd.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=T,this.currentResolutionError=null,process.nextTick(()=>{let P=this.configSelectionQueue;this.configSelectionQueue=[],P.length>0&&this.callRefTimerUnref();for(let N of P)N.getConfig()})},M=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+M.code+' and details "'+M.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,LV.restrictControlPlaneStatusCode)(M.code,M.details)),{metadata:M.metadata}));let T=this.configSelectionQueue;this.configSelectionQueue=[],T.length>0&&this.callRefTimerUnref();for(let P of T)P.reportResolverError(M)}),this.filterStackFactory=new MV.FilterStackFactory([new xV.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let w=new Error;(0,_y.trace)(Al.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((h=w.stack)===null||h===void 0?void 0:h.substring(w.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,_y.trace)(t??Al.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Md.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,_y.trace)(Al.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Md.uriToString)(this.target)+" "+ar.ConnectivityState[this.connectivityState]+" -> "+ar.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ar.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==ar.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(ar.ConnectivityState.IDLE),this.currentPicker=new nI.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==ar.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Al.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,by.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new PV.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,by.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new wy.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,xd.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,by.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,NV.deadlineToString)(t));let a={deadline:t,flags:s??Al.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new FV.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(ar.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Rl.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Md.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===ar.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===ar.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};kd.InternalChannel=Ty});var Dm=I(Pd=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});Pd.ChannelImplementation=void 0;var $V=mu(),GV=iI(),Iy=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof $V.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new GV.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Pd.ChannelImplementation=Iy});var fI=I(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.Http2ServerCallStream=gn.ServerDuplexStreamImpl=gn.ServerWritableStreamImpl=gn.ServerReadableStreamImpl=gn.ServerUnaryCallImpl=void 0;var uI=be("events"),Fo=be("http2"),Dy=be("stream"),sI=be("zlib"),xe=Se(),Oy=Ft(),WV=Yg(),dI=qe(),Ol=cu(),hI="server_call";function Dl(n){dI.trace(xe.LogVerbosity.DEBUG,hI,n)}var HV="grpc-accept-encoding",KV="grpc-encoding",oI="grpc-message",aI="grpc-status",lI="grpc-timeout",QV=/(\d{1,8})\s*([HMSmun])/,YV={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},XV={[HV]:"identity,deflate,gzip",[KV]:"identity"},cI={[Fo.constants.HTTP2_HEADER_STATUS]:Fo.constants.HTTP_STATUS_OK,[Fo.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},JV={waitForTrailers:!0},Ay=class extends uI.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};gn.ServerUnaryCallImpl=Ay;var Nd=class extends Dy.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};gn.ServerReadableStreamImpl=Nd;var Ml=class extends Dy.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Oy.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Ol.getErrorMessage)(i),code:xe.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:xe.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};gn.ServerWritableStreamImpl=Ml;var Lo=class extends Dy.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Oy.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};gn.ServerDuplexStreamImpl=Lo;Lo.prototype._read=Nd.prototype._read;Lo.prototype._write=Ml.prototype._write;Lo.prototype._final=Ml.prototype._final;var Ry=class extends uI.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=xe.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=xe.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Dl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:xe.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=sI.createInflate():i=sI.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:xe.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:xe.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},cI),XV),t);this.stream.respond(r,JV)}receiveMetadata(e){let t=Oy.Metadata.fromHttp2Headers(e);dI.isTracerEnabled(hI)&&Dl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(lI);if(r.length>0){let i=r[0].toString().match(QV);if(i===null){let a=new Error("Invalid deadline");return a.code=xe.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*YV[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(ZV,s,this),t.remove(lI)}return t.remove(Fo.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Fo.constants.HTTP2_HEADER_TE),t.remove(Fo.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(h){if(s+=h.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:xe.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(h)}function u(h){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),h!==void 0){r({code:xe.Status.INTERNAL,details:h.message});return}if(s===0){r({code:xe.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let f=Buffer.concat(a,s),b=f.readUInt8(0)===1?e:"identity",E=o.getDecompressedMessage(f,b);if(Buffer.isBuffer(E)){t(o.deserializeMessageWithInternalError(E));return}E.then(w=>t(o.deserializeMessageWithInternalError(w)),w=>r(w.code?w:{code:xe.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return A(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Ol.getErrorMessage)(t),code:xe.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return A(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:xe.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Ol.getErrorMessage)(s),code:xe.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===xe.Status.OK),!this.checkCancelled())if(Dl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+xe.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[aI]:e.code,[oI]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[aI]:e.code,[oI]:encodeURI(e.details)},cI),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:xe.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:xe.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new WV.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>A(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>A(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:xe.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",v;try{v=yield this.getDecompressedMessage(u,f)}catch(b){this.sendError(b);return}if(!v)return;yield this.pushOrBufferMessage(e,v)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>A(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return A(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return A(this,null,function*(){if(t===null){Dl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Dl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Ol.getErrorCode)(r);(i===null||i<xe.Status.OK||i>xe.Status.UNAUTHENTICATED)&&(i=xe.Status.INTERNAL),e.emit("error",{details:(0,Ol.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};gn.Http2ServerCallStream=Ry;function ZV(n){let e=new Error("Deadline exceeded");e.code=xe.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var ky=I(Fd=>{"use strict";Object.defineProperty(Fd,"__esModule",{value:!0});Fd.ServerCredentials=void 0;var pI=Zp(),xl=class{static createInsecure(){return new My}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new xy({ca:e||(0,pI.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:pI.CIPHER_SUITES})}};Fd.ServerCredentials=xl;var My=class extends xl{_isSecure(){return!1}_getSettings(){return null}},xy=class extends xl{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var yI=I(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});Bd.Server=void 0;var Mi=be("http2"),Fr=Se(),is=fI(),eB=ky(),mI=Hn(),Ld=qe(),Dn=Qn(),tB=Gt(),Bt=ns(),Vd=~(1<<31),nB=~(1<<31),rB=2e4,{HTTP2_HEADER_PATH:gI}=Mi.constants,iB="server";function sB(){}function Py(n){return{code:Fr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function oB(n,e){let t=Py(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Ny=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Bt.ChannelzTrace,this.callTracker=new Bt.ChannelzCallTracker,this.listenerChildrenTracker=new Bt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Bt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Bt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Vd,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:Vd,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:nB,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:rB,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Dn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Dn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let h=o,f=h.getCipher(),v=h.getCertificate(),b=h.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:v&&"raw"in v?v.raw:null,remoteCertificate:b&&"raw"in b?b.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Ld.trace(Fr.LogVerbosity.DEBUG,iB,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=oB(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof eB.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,tB.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,mI.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(v,b)=>{process.nextTick(()=>r(v,b))},l=()=>{let v;if(t._isSecure()){let b=Object.assign(o,t._getSettings());b.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,v=Mi.createSecureServer(b),v.on("secureConnection",E=>{E.on("error",w=>{this.trace("An incoming TLS connection closed with error: "+w.message)})})}else v=Mi.createServer(o);return v.setTimeout(0,sB),this._setupHandlers(v),v},c=(v,b,E)=>v.length===0?Promise.resolve({port:b,count:E}):Promise.all(v.map(w=>{this.trace("Attempting to bind "+(0,Dn.subchannelAddressToString)(w));let M;(0,Dn.isTcpSubchannelAddress)(w)?M={host:w.host,port:b}:M=w;let T=l();return new Promise((P,N)=>{let W=X=>{this.trace("Failed to bind "+(0,Dn.subchannelAddressToString)(w)+" with error "+X.message),P(X)};T.once("error",W),T.listen(M,()=>{if(this.shutdown){T.close(),P(new Error("bindAsync failed because server is shutdown"));return}let X=T.address(),C;typeof X=="string"?C={path:X}:C={host:X.address,port:X.port};let g=(0,Bt.registerChannelzSocket)((0,Dn.subchannelAddressToString)(C),()=>({localAddress:C,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:T,channelzRef:g}),this.trace("Successfully bound "+(0,Dn.subchannelAddressToString)(C)),P("port"in C?C.port:b),T.removeListener("error",W)})})})).then(w=>{let M=0;for(let T of w)if(typeof T=="number"&&(M+=1,T!==b))throw new Error("Invalid state: multiple port numbers added from single address");return{port:b,count:M+E}}),u=v=>{if(v.length===0)return Promise.resolve({port:0,count:0});let b=v[0],E=l();return new Promise((w,M)=>{let T=P=>{this.trace("Failed to bind "+(0,Dn.subchannelAddressToString)(b)+" with error "+P.message),w(u(v.slice(1)))};E.once("error",T),E.listen(b,()=>{if(this.shutdown){E.close(),w({port:0,count:0});return}let P=E.address(),N={host:P.address,port:P.port},W=(0,Bt.registerChannelzSocket)((0,Dn.subchannelAddressToString)(N),()=>({localAddress:N,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(W),this.http2ServerList.push({server:E,channelzRef:W}),this.trace("Successfully bound "+(0,Dn.subchannelAddressToString)(N)),w(c(v.slice(1),P.port,1)),E.removeListener("error",T)})})},h={onSuccessfulResolution:(v,b,E)=>{if(h.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),v.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let w;(0,Dn.isTcpSubchannelAddress)(v[0])?v[0].port===0?w=u(v):w=c(v,v[0].port,0):w=c(v,1,0),w.then(M=>{if(M.count===0){let T=`No address added out of total ${v.length} resolved`;Ld.log(Fr.LogVerbosity.ERROR,T),a(new Error(T),0)}else M.count<v.length&&Ld.log(Fr.LogVerbosity.INFO,`WARNING Only ${M.count} addresses added out of total ${v.length} resolved`),a(null,M.port)},M=>{let T=`No address added out of total ${v.length} resolved`;Ld.log(Fr.LogVerbosity.ERROR,T),a(new Error(T),0)})},onError:v=>{a(new Error(v.details),0)}};(0,mI.createResolver)(s,h,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Bt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Mi.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Bt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Bt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Bt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Mi.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Mi.constants.HTTP2_HEADER_STATUS]:Mi.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new is.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Fr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[gI],s=this._retrieveHandler(i);if(!s){this._respondWithError(Py(i),e,r);return}let o=new is.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Fr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Fr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[gI],i=this._retrieveHandler(r);if(!i){this._respondWithError(Py(r),e,null);return}let s=new is.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Fr.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")aB(e,t,s,o);else if(a==="clientStream")lB(e,t,s,o);else if(a==="serverStream")cB(e,t,s,o);else if(a==="bidi")uB(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let h=(0,Bt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:h,streamTracker:new Bt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let v=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+v),this.sessionChildrenTracker.refChild(h));let b=null,E=null,w=!1;if(this.maxConnectionAgeMs!==Vd){let T=this.maxConnectionAgeMs/10,P=Math.random()*T*2-T;b=(l=(a=setTimeout(()=>{var N,W;w=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+v);try{s.goaway(Mi.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Vd&&(E=(W=(N=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||W===void 0?void 0:W.call(N))},this.maxConnectionAgeMs+P)).unref)===null||l===void 0?void 0:l.call(a)}let M=(u=(c=setInterval(()=>{var T,P;let N=(P=(T=setTimeout(()=>{w=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+v),s.close()},this.keepaliveTimeoutMs)).unref)===null||P===void 0?void 0:P.call(T);try{s.ping((W,X,C)=>{clearTimeout(N)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(w||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+v),this.sessionChildrenTracker.unrefChild(h),(0,Bt.unregisterChannelzRef)(h)),b&&clearTimeout(b),E&&clearTimeout(E),M&&clearTimeout(M),this.sessions.delete(s)})})}};Bd.Server=Ny;function aB(n,e,t,r){return A(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new is.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function lB(n,e,t,r){let i=new is.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function cB(n,e,t,r){return A(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new is.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function uB(n,e,t,r){let i=new is.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var vI=I(Ud=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});Ud.StatusBuilder=void 0;var Fy=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Ud.StatusBuilder=Fy});var Ly=I(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.isDuration=xi.durationToMs=xi.msToDuration=void 0;function dB(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}xi.msToDuration=dB;function hB(n){return n.seconds*1e3+n.nanos/1e6|0}xi.durationToMs=hB;function fB(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}xi.isDuration=fB});var Gy=I(ki=>{"use strict";var Vy;Object.defineProperty(ki,"__esModule",{value:!0});ki.setup=ki.OutlierDetectionLoadBalancer=ki.OutlierDetectionLoadBalancingConfig=void 0;var zd=an(),CI=Se(),ss=Ly(),_I=Wy(),bI=ci(),pB=bu(),mB=fi(),SI=Qn(),gB=Od(),yB=qe(),vB="outlier_detection";function ft(n){yB.trace(CI.LogVerbosity.DEBUG,vB,n)}var $y="outlier_detection",SB=((Vy=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Vy!==void 0?Vy:"true")==="true",CB={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},_B={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Vo(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function By(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,ss.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function qd(n,e,t){let r=t?`${t}.${e}`:e;if(Vo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var kl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},CB),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},_B),o):null}getLoadBalancerName(){return $y}toJsonObject(){return{interval:(0,ss.msToDuration)(this.intervalMs),base_ejection_time:(0,ss.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ss.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(By(e,"interval"),By(e,"base_ejection_time"),By(e,"max_ejection_time"),qd(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Vo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),qd(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Vo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Vo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");qd(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),qd(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Vo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Vo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,ss.durationToMs)(e.interval):null,e.base_ejection_time?(0,ss.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ss.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(bI.validateLoadBalancingConfig))}};ki.OutlierDetectionLoadBalancingConfig=kl;var qy=class extends gB.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?zd.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,zd.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,zd.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Uy(){return{success:0,failure:0}}var zy=class{constructor(){this.activeBucket=Uy(),this.inactiveBucket=Uy()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Uy()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},jy=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===mB.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===CI.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},jd=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new pB.ChildLoadBalancerHandler((0,_I.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,SI.subchannelAddressToString)(t)),o=new qy(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===zd.ConnectivityState.READY?e.updateState(t,new jy(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;ft("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[h,f]of this.addressMap){let v=f.counter.getLastSuccesses(),b=f.counter.getLastFailures();ft("Stats for "+h+": successes="+v+" failures="+b+" targetRequestVolume="+r),v+b>=r&&(i+=1,s.push(v/(v+b)))}if(ft("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((h,f)=>h+f)/s.length,a=0;for(let h of s){let f=h-o;a+=f*f}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);ft("stdev="+c+" ejectionThreshold="+u);for(let[h,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let v=f.counter.getLastSuccesses(),b=f.counter.getLastFailures();if(v+b<r)continue;let E=v/(v+b);if(ft("Checking candidate "+h+" successRate="+E),E<u){let w=Math.random()*100;ft("Candidate "+h+" randomNumber="+w+" enforcement_percentage="+t.enforcement_percentage),w<t.enforcement_percentage&&(ft("Ejecting candidate "+h),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;ft("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(ft("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;ft("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(ft("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(ft("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(ft("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof kl))return;let i=new Set;for(let o of e)i.add((0,SI.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(ft("Adding map entry for "+o),this.addressMap.set(o,{counter:new zy,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(ft("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,bI.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){ft("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else ft("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{ft("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return $y}};ki.OutlierDetectionLoadBalancer=jd;function bB(){SB&&(0,_I.registerLoadBalancerType)($y,jd,kl)}ki.setup=bB});var Wy=I(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.OutlierDetectionLoadBalancingConfig=te.BaseSubchannelWrapper=te.registerAdminService=te.FilterStackFactory=te.BaseFilter=te.PickResultType=te.QueuePicker=te.UnavailablePicker=te.ChildLoadBalancerHandler=te.subchannelAddressToString=te.validateLoadBalancingConfig=te.getFirstUsableConfig=te.registerLoadBalancerType=te.createChildChannelControlHelper=te.BackoffTimeout=te.durationToMs=te.uriToString=te.createResolver=te.registerResolver=te.log=te.trace=void 0;var wI=qe();Object.defineProperty(te,"trace",{enumerable:!0,get:function(){return wI.trace}});Object.defineProperty(te,"log",{enumerable:!0,get:function(){return wI.log}});var EI=Hn();Object.defineProperty(te,"registerResolver",{enumerable:!0,get:function(){return EI.registerResolver}});Object.defineProperty(te,"createResolver",{enumerable:!0,get:function(){return EI.createResolver}});var wB=Gt();Object.defineProperty(te,"uriToString",{enumerable:!0,get:function(){return wB.uriToString}});var EB=Ly();Object.defineProperty(te,"durationToMs",{enumerable:!0,get:function(){return EB.durationToMs}});var TB=tl();Object.defineProperty(te,"BackoffTimeout",{enumerable:!0,get:function(){return TB.BackoffTimeout}});var $d=ci();Object.defineProperty(te,"createChildChannelControlHelper",{enumerable:!0,get:function(){return $d.createChildChannelControlHelper}});Object.defineProperty(te,"registerLoadBalancerType",{enumerable:!0,get:function(){return $d.registerLoadBalancerType}});Object.defineProperty(te,"getFirstUsableConfig",{enumerable:!0,get:function(){return $d.getFirstUsableConfig}});Object.defineProperty(te,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return $d.validateLoadBalancingConfig}});var IB=Qn();Object.defineProperty(te,"subchannelAddressToString",{enumerable:!0,get:function(){return IB.subchannelAddressToString}});var AB=bu();Object.defineProperty(te,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return AB.ChildLoadBalancerHandler}});var Hy=fi();Object.defineProperty(te,"UnavailablePicker",{enumerable:!0,get:function(){return Hy.UnavailablePicker}});Object.defineProperty(te,"QueuePicker",{enumerable:!0,get:function(){return Hy.QueuePicker}});Object.defineProperty(te,"PickResultType",{enumerable:!0,get:function(){return Hy.PickResultType}});var RB=ly();Object.defineProperty(te,"BaseFilter",{enumerable:!0,get:function(){return RB.BaseFilter}});var DB=sy();Object.defineProperty(te,"FilterStackFactory",{enumerable:!0,get:function(){return DB.FilterStackFactory}});var OB=Eu();Object.defineProperty(te,"registerAdminService",{enumerable:!0,get:function(){return OB.registerAdminService}});var MB=Od();Object.defineProperty(te,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return MB.BaseSubchannelWrapper}});var xB=Gy();Object.defineProperty(te,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return xB.OutlierDetectionLoadBalancingConfig}})});var TI=I(Gd=>{"use strict";Object.defineProperty(Gd,"__esModule",{value:!0});Gd.setup=void 0;var kB=Hn(),Ky=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function PB(){(0,kB.registerResolver)("unix",Ky)}Gd.setup=PB});var OI=I(Kd=>{"use strict";Object.defineProperty(Kd,"__esModule",{value:!0});Kd.setup=void 0;var II=be("net"),Wd=Se(),Qy=Ft(),AI=Hn(),RI=Gt(),NB=qe(),FB="ip_resolver";function DI(n){NB.trace(Wd.LogVerbosity.DEBUG,FB,n)}var Yy="ipv4",Xy="ipv6",LB=443,Hd=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,DI("Resolver constructed for target "+(0,RI.uriToString)(e));let s=[];if(!(e.scheme===Yy||e.scheme===Xy)){this.error={code:Wd.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Qy.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,RI.splitHostPort)(a);if(l===null){this.error={code:Wd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Qy.Metadata};return}if(e.scheme===Yy&&!(0,II.isIPv4)(l.host)||e.scheme===Xy&&!(0,II.isIPv6)(l.host)){this.error={code:Wd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Qy.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:LB})}this.addresses=s,DI("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function VB(){(0,AI.registerResolver)(Yy,Hd),(0,AI.registerResolver)(Xy,Hd)}Kd.setup=VB});var kI=I(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.setup=lr.PickFirstLoadBalancer=lr.shuffled=lr.PickFirstLoadBalancingConfig=void 0;var MI=ci(),bt=an(),Qd=fi(),BB=qe(),UB=Se(),qB="pick_first";function Jy(n){BB.trace(UB.LogVerbosity.DEBUG,qB,n)}var Pl="pick_first",zB=250,Nl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Pl}toJsonObject(){return{[Pl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};lr.PickFirstLoadBalancingConfig=Nl;var Zy=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Qd.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function xI(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}lr.shuffled=xI;var Yd=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=bt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(bt.ConnectivityState.READY,new Zy(this.currentPick)):this.children.length===0?this.updateState(bt.ConnectivityState.IDLE,new Qd.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(bt.ConnectivityState.TRANSIENT_FAILURE,new Qd.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(bt.ConnectivityState.CONNECTING,new Qd.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==bt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===bt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===bt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===bt.ConnectivityState.IDLE||i===bt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===bt.ConnectivityState.IDLE&&(Jy("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},zB)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Jy("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Jy(bt.ConnectivityState[this.currentState]+" -> "+bt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===bt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===bt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Nl&&(t.getShuffleAddressList()&&(e=xI(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===bt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Pl}};lr.PickFirstLoadBalancer=Yd;function jB(){(0,MI.registerLoadBalancerType)(Pl,Yd,Nl),(0,MI.registerDefaultLoadBalancerType)(Pl)}lr.setup=jB});var NI=I(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.setup=Bo.RoundRobinLoadBalancer=void 0;var $B=ci(),wt=an(),Xd=fi(),GB=Qn(),WB=qe(),HB=Se(),KB="round_robin";function PI(n){WB.trace(HB.LogVerbosity.DEBUG,KB,n)}var Jd="round_robin",ev=class n{getLoadBalancerName(){return Jd}constructor(){}toJsonObject(){return{[Jd]:{}}}static createFromJson(e){return new n}},tv=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Xd.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Zd=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=wt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===wt.ConnectivityState.TRANSIENT_FAILURE||i===wt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(wt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===wt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(wt.ConnectivityState.READY,new tv(e,t))}else this.countSubchannelsWithState(wt.ConnectivityState.CONNECTING)>0?this.updateState(wt.ConnectivityState.CONNECTING,new Xd.QueuePicker(this)):this.countSubchannelsWithState(wt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(wt.ConnectivityState.TRANSIENT_FAILURE,new Xd.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(wt.ConnectivityState.IDLE,new Xd.QueuePicker(this))}updateState(e,t){PI(wt.ConnectivityState[this.currentState]+" -> "+wt.ConnectivityState[e]),e===wt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),PI("Connect to address list "+e.map(r=>(0,GB.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===wt.ConnectivityState.IDLE||i===wt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Jd}};Bo.RoundRobinLoadBalancer=Zd;function QB(){(0,$B.registerLoadBalancerType)(Jd,Zd,ev)}Bo.setup=QB});var BI=I(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.experimental=z.addAdminServicesToServer=z.getChannelzHandlers=z.getChannelzServiceDefinition=z.InterceptorConfigurationError=z.InterceptingCall=z.RequesterBuilder=z.ListenerBuilder=z.StatusBuilder=z.getClientChannel=z.ServerCredentials=z.Server=z.setLogVerbosity=z.setLogger=z.load=z.loadObject=z.CallCredentials=z.ChannelCredentials=z.waitForClientReady=z.closeClient=z.Channel=z.makeGenericClientConstructor=z.makeClientConstructor=z.loadPackageDefinition=z.Client=z.compressionAlgorithms=z.propagate=z.connectivityState=z.status=z.logVerbosity=z.Metadata=z.credentials=void 0;var eh=Xp();Object.defineProperty(z,"CallCredentials",{enumerable:!0,get:function(){return eh.CallCredentials}});var YB=Dm();Object.defineProperty(z,"Channel",{enumerable:!0,get:function(){return YB.ChannelImplementation}});var XB=oy();Object.defineProperty(z,"compressionAlgorithms",{enumerable:!0,get:function(){return XB.CompressionAlgorithms}});var JB=an();Object.defineProperty(z,"connectivityState",{enumerable:!0,get:function(){return JB.ConnectivityState}});var th=mu();Object.defineProperty(z,"ChannelCredentials",{enumerable:!0,get:function(){return th.ChannelCredentials}});var FI=Rm();Object.defineProperty(z,"Client",{enumerable:!0,get:function(){return FI.Client}});var nv=Se();Object.defineProperty(z,"logVerbosity",{enumerable:!0,get:function(){return nv.LogVerbosity}});Object.defineProperty(z,"status",{enumerable:!0,get:function(){return nv.Status}});Object.defineProperty(z,"propagate",{enumerable:!0,get:function(){return nv.Propagate}});var LI=qe(),rv=Mm();Object.defineProperty(z,"loadPackageDefinition",{enumerable:!0,get:function(){return rv.loadPackageDefinition}});Object.defineProperty(z,"makeClientConstructor",{enumerable:!0,get:function(){return rv.makeClientConstructor}});Object.defineProperty(z,"makeGenericClientConstructor",{enumerable:!0,get:function(){return rv.makeClientConstructor}});var ZB=Ft();Object.defineProperty(z,"Metadata",{enumerable:!0,get:function(){return ZB.Metadata}});var eU=yI();Object.defineProperty(z,"Server",{enumerable:!0,get:function(){return eU.Server}});var tU=ky();Object.defineProperty(z,"ServerCredentials",{enumerable:!0,get:function(){return tU.ServerCredentials}});var nU=vI();Object.defineProperty(z,"StatusBuilder",{enumerable:!0,get:function(){return nU.StatusBuilder}});z.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:th.ChannelCredentials.createInsecure,createSsl:th.ChannelCredentials.createSsl,createFromSecureContext:th.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:eh.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:eh.CallCredentials.createFromGoogleCredential,createEmpty:eh.CallCredentials.createEmpty};var rU=n=>n.close();z.closeClient=rU;var iU=(n,e,t)=>n.waitForReady(e,t);z.waitForClientReady=iU;var sU=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};z.loadObject=sU;var oU=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};z.load=oU;var aU=n=>{LI.setLogger(n)};z.setLogger=aU;var lU=n=>{LI.setLoggerVerbosity(n)};z.setLogVerbosity=lU;var cU=n=>FI.Client.prototype.getChannel.call(n);z.getClientChannel=cU;var nh=Tm();Object.defineProperty(z,"ListenerBuilder",{enumerable:!0,get:function(){return nh.ListenerBuilder}});Object.defineProperty(z,"RequesterBuilder",{enumerable:!0,get:function(){return nh.RequesterBuilder}});Object.defineProperty(z,"InterceptingCall",{enumerable:!0,get:function(){return nh.InterceptingCall}});Object.defineProperty(z,"InterceptorConfigurationError",{enumerable:!0,get:function(){return nh.InterceptorConfigurationError}});var VI=ns();Object.defineProperty(z,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return VI.getChannelzServiceDefinition}});Object.defineProperty(z,"getChannelzHandlers",{enumerable:!0,get:function(){return VI.getChannelzHandlers}});var uU=Eu();Object.defineProperty(z,"addAdminServicesToServer",{enumerable:!0,get:function(){return uU.addAdminServicesToServer}});var dU=Wy();z.experimental=dU;var hU=Hg(),fU=TI(),pU=OI(),mU=kI(),gU=NI(),yU=Gy(),vU=ns();hU.setup(),fU.setup(),pU.setup(),mU.setup(),gU.setup(),yU.setup(),vU.setup()});var oe="primary",ka=Symbol("RouteTitle"),xf=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Ls(n){return new xf(n)}function TD(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o[0]===":")i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function ID(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!qn(n[t],e[t]))return!1;return!0}function qn(n,e){let t=n?kf(n):void 0,r=e?kf(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!xC(n[i],e[i]))return!1;return!0}function kf(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function xC(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function kC(n){return n.length>0?n[n.length-1]:null}function Xr(n){return DS(n)?n:gc(n)?nt(Promise.resolve(n)):J(n)}var AD={exact:NC,subset:FC},PC={exact:RD,subset:DD,ignored:()=>!0};function bC(n,e,t){return AD[t.paths](n.root,e.root,t.matrixParams)&&PC[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function RD(n,e){return qn(n,e)}function NC(n,e,t){if(!ji(n.segments,e.segments)||!wc(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!NC(n.children[r],e.children[r],t))return!1;return!0}function DD(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>xC(n[t],e[t]))}function FC(n,e,t){return LC(n,e,e.segments,t)}function LC(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!ji(i,t)||e.hasChildren()||!wc(i,t,r))}else if(n.segments.length===t.length){if(!ji(n.segments,t)||!wc(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!FC(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!ji(n.segments,i)||!wc(n.segments,i,r)||!n.children[oe]?!1:LC(n.children[oe],e,s,r)}}function wc(n,e,t){return e.every((r,i)=>PC[t](n[i].parameters,r.parameters))}var Er=class{constructor(e=new _e([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Ls(this.queryParams),this._queryParamMap}toString(){return xD.serialize(this)}},_e=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ec(this)}},zi=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Ls(this.parameters),this._parameterMap}toString(){return BC(this)}};function OD(n,e){return ji(n,e)&&n.every((t,r)=>qn(t.parameters,e[r].parameters))}function ji(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function MD(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===oe&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==oe&&(t=t.concat(e(i,r)))}),t}var Pa=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:()=>new Vs,providedIn:"root"})}}return n})(),Vs=class{parse(e){let t=new Nf(e);return new Er(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Sa(e.root,!0)}`,r=ND(e.queryParams),i=typeof e.fragment=="string"?`#${kD(e.fragment)}`:"";return`${t}${r}${i}`}},xD=new Vs;function Ec(n){return n.segments.map(e=>BC(e)).join("/")}function Sa(n,e){if(!n.hasChildren())return Ec(n);if(e){let t=n.children[oe]?Sa(n.children[oe],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==oe&&r.push(`${i}:${Sa(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=MD(n,(r,i)=>i===oe?[Sa(n.children[oe],!1)]:[`${i}:${Sa(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[oe]!=null?`${Ec(n)}/${t[0]}`:`${Ec(n)}/(${t.join("//")})`}}function VC(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function _c(n){return VC(n).replace(/%3B/gi,";")}function kD(n){return encodeURI(n)}function Pf(n){return VC(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Tc(n){return decodeURIComponent(n)}function wC(n){return Tc(n.replace(/\+/g,"%20"))}function BC(n){return`${Pf(n.path)}${PD(n.parameters)}`}function PD(n){return Object.entries(n).map(([e,t])=>`;${Pf(e)}=${Pf(t)}`).join("")}function ND(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${_c(t)}=${_c(i)}`).join("&"):`${_c(t)}=${_c(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var FD=/^[^\/()?;#]+/;function Rf(n){let e=n.match(FD);return e?e[0]:""}var LD=/^[^\/()?;=#]+/;function VD(n){let e=n.match(LD);return e?e[0]:""}var BD=/^[^=?&#]+/;function UD(n){let e=n.match(BD);return e?e[0]:""}var qD=/^[^&#]+/;function zD(n){let e=n.match(qD);return e?e[0]:""}var Nf=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new _e([],{}):new _e([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[oe]=new _e(e,t)),r}parseSegment(){let e=Rf(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new rt(4009,!1);return this.capture(e),new zi(Tc(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=VD(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=Rf(this.remaining);i&&(r=i,this.capture(r))}e[Tc(t)]=Tc(r)}parseQueryParam(e){let t=UD(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=zD(this.remaining);o&&(r=o,this.capture(r))}let i=wC(t),s=wC(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=Rf(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new rt(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=oe);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[oe]:new _e([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new rt(4011,!1)}};function UC(n){return n.segments.length>0?new _e([],{[oe]:n}):n}function qC(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=qC(i);if(r===oe&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new _e(n.segments,e);return jD(t)}function jD(n){if(n.numberOfChildren===1&&n.children[oe]){let e=n.children[oe];return new _e(n.segments.concat(e.segments),e.children)}return n}function $i(n){return n instanceof Er}function $D(n,e,t=null,r=null){let i=zC(n);return jC(i,e,t,r)}function zC(n){let e;function t(s){let o={};for(let l of s.children){let c=t(l);o[l.outlet]=c}let a=new _e(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=UC(r);return e??i}function jC(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Df(i,i,i,t,r);let s=GD(e);if(s.toRoot())return Df(i,i,new _e([],{}),t,r);let o=WD(s,i,n),a=o.processChildren?ba(o.segmentGroup,o.index,s.commands):GC(o.segmentGroup,o.index,s.commands);return Df(i,o.segmentGroup,a,t,r)}function Ic(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Ta(n){return typeof n=="object"&&n!=null&&n.outlets}function Df(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([l,c])=>{s[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let o;n===e?o=t:o=$C(n,e,t);let a=UC(qC(o));return new Er(a,s,i)}function $C(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=$C(s,e,t)}),new _e(n.segments,r)}var Ac=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Ic(r[0]))throw new rt(4003,!1);let i=r.find(Ta);if(i&&i!==kC(r))throw new rt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function GD(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Ac(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new Ac(t,e,r)}var Ps=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function WD(n,e,t){if(n.isAbsolute)return new Ps(e,!0,0);if(!t)return new Ps(e,!1,NaN);if(t.parent===null)return new Ps(t,!0,0);let r=Ic(n.commands[0])?0:1,i=t.segments.length-1+r;return HD(t,i,n.numberOfDoubleDots)}function HD(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new rt(4005,!1);i=r.segments.length}return new Ps(r,!1,i-s)}function KD(n){return Ta(n[0])?n[0].outlets:{[oe]:n}}function GC(n,e,t){if(n??=new _e([],{}),n.segments.length===0&&n.hasChildren())return ba(n,e,t);let r=QD(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new _e(n.segments.slice(0,r.pathIndex),{});return s.children[oe]=new _e(n.segments.slice(r.pathIndex),n.children),ba(s,0,i)}else return r.match&&i.length===0?new _e(n.segments,{}):r.match&&!n.hasChildren()?Ff(n,e,t):r.match?ba(n,0,i):Ff(n,e,t)}function ba(n,e,t){if(t.length===0)return new _e(n.segments,{});{let r=KD(t),i={};if(Object.keys(r).some(s=>s!==oe)&&n.children[oe]&&n.numberOfChildren===1&&n.children[oe].segments.length===0){let s=ba(n.children[oe],e,t);return new _e(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=GC(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new _e(n.segments,i)}}function QD(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Ta(a))break;let l=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!TC(l,c,o))return s;r+=2}else{if(!TC(l,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function Ff(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Ta(s)){let l=YD(s.outlets);return new _e(r,l)}if(i===0&&Ic(t[0])){let l=n.segments[e];r.push(new zi(l.path,EC(t[0]))),i++;continue}let o=Ta(s)?s.outlets[oe]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Ic(a)?(r.push(new zi(o,EC(a))),i+=2):(r.push(new zi(o,{})),i++)}return new _e(r,{})}function YD(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=Ff(new _e([],{}),0,r))}),e}function EC(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function TC(n,e,t){return n==t.path&&qn(e,t.parameters)}var wa="imperative",ct=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(ct||{}),rn=class{constructor(e,t){this.id=e,this.url=t}},Bs=class extends rn{constructor(e,t,r="imperative",i=null){super(e,t),this.type=ct.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},zn=class extends rn{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=ct.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},$t=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}($t||{}),Rc=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Rc||{}),wr=class extends rn{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=ct.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Yr=class extends rn{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=ct.NavigationSkipped}},Ia=class extends rn{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=ct.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Dc=class extends rn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ct.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Lf=class extends rn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ct.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Vf=class extends rn{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=ct.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Bf=class extends rn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ct.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Uf=class extends rn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ct.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},qf=class{constructor(e){this.route=e,this.type=ct.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},zf=class{constructor(e){this.route=e,this.type=ct.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},jf=class{constructor(e){this.snapshot=e,this.type=ct.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},$f=class{constructor(e){this.snapshot=e,this.type=ct.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Gf=class{constructor(e){this.snapshot=e,this.type=ct.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Wf=class{constructor(e){this.snapshot=e,this.type=ct.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Oc=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=ct.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Aa=class{},Us=class{constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function XD(n,e){return n.providers&&!n._injector&&(n._injector=vf(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Sn(n){return n.outlet||oe}function JD(n,e){let t=n.filter(r=>Sn(r)===e);return t.push(...n.filter(r=>Sn(r)!==e)),t}function Na(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Hf=class{get injector(){return Na(this.route?.snapshot)??this.rootInjector}set injector(e){}constructor(e){this.rootInjector=e,this.outlet=null,this.route=null,this.children=new Fa(this.rootInjector),this.attachRef=null}},Fa=(()=>{class n{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,r){let i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){let r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new Hf(this.rootInjector),this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(r){return new(r||n)(ae(ca))}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Mc=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Kf(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=Kf(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Qf(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Qf(e,this._root).map(t=>t.value)}};function Kf(n,e){if(n===e.value)return e;for(let t of e.children){let r=Kf(n,t);if(r)return r}return null}function Qf(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Qf(n,t);if(r.length)return r.unshift(e),r}return[]}var jt=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function ks(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var xc=class extends Mc{constructor(e,t){super(e),this.snapshot=t,ip(this,e)}toString(){return this.snapshot.toString()}};function WC(n){let e=ZD(n),t=new Rt([new zi("",{})]),r=new Rt({}),i=new Rt({}),s=new Rt({}),o=new Rt(""),a=new jn(t,r,s,o,i,oe,n,e.root);return a.snapshot=e.root,new xc(new jt(a,[]),e)}function ZD(n){let e={},t={},r={},i="",s=new Ns([],e,r,i,t,oe,n,null,{});return new Pc("",new jt(s,[]))}var jn=class{constructor(e,t,r,i,s,o,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(le(c=>c[ka]))??J(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(le(e=>Ls(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(le(e=>Ls(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function kc(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:q(q({},e.params),n.params),data:q(q({},e.data),n.data),resolve:q(q(q(q({},n.data),e.data),i?.data),n._resolvedData)}:r={params:q({},n.params),data:q({},n.data),resolve:q(q({},n.data),n._resolvedData??{})},i&&KC(i)&&(r.resolve[ka]=i.title),r}var Ns=class{get title(){return this.data?.[ka]}constructor(e,t,r,i,s,o,a,l,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ls(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ls(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Pc=class extends Mc{constructor(e,t){super(t),this.url=e,ip(this,t)}toString(){return HC(this._root)}};function ip(n,e){e.value._routerState=n,e.children.forEach(t=>ip(n,t))}function HC(n){let e=n.children.length>0?` { ${n.children.map(HC).join(", ")} } `:"";return`${n.value}${e}`}function Of(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,qn(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),qn(e.params,t.params)||n.paramsSubject.next(t.params),ID(e.url,t.url)||n.urlSubject.next(t.url),qn(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Yf(n,e){let t=qn(n.params,e.params)&&OD(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Yf(n.parent,e.parent))}function KC(n){return typeof n.title=="string"||n.title===null}var sp=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=oe,this.activateEvents=new Ye,this.deactivateEvents=new Ye,this.attachEvents=new Ye,this.detachEvents=new Ye,this.parentContexts=ee(Fa),this.location=ee(jS),this.changeDetector=ee(fa),this.inputBinder=ee(Vc,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){let{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new rt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new rt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new rt(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new rt(4013,!1);this._activatedRoute=t;let i=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new Xf(t,a,i.injector);this.activated=i.createComponent(o,{index:i.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=lt({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Gr]})}}return n})(),Xf=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===jn?this.route:e===Fa?this.childContexts:this.parent.get(e,t)}},Vc=new fe(""),IC=(()=>{class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){let{activatedRoute:r}=t,i=uc([r.queryParams,r.params,r.data]).pipe(ot(([s,o,a],l)=>(a=q(q(q({},s),o),a),l===0?J(a):Promise.resolve(a)))).subscribe(s=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||r.component===null){this.unsubscribeFromRouteData(t);return}let o=YS(r.component);if(!o){this.unsubscribeFromRouteData(t);return}for(let{templateName:a}of o.inputs)t.activatedComponentRef.setInput(a,s[a])});this.outletDataSubscriptions.set(t,i)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac})}}return n})();function e1(n,e,t){let r=Ra(n,e._root,t?t._root:void 0);return new xc(r,e)}function Ra(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=t1(n,e,t);return new jt(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Ra(n,a)),o}}let r=n1(e.value),i=e.children.map(s=>Ra(n,s));return new jt(r,i)}}function t1(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Ra(n,r,i);return Ra(n,r)})}function n1(n){return new jn(new Rt(n.url),new Rt(n.params),new Rt(n.queryParams),new Rt(n.fragment),new Rt(n.data),n.outlet,n.component,n)}var Da=class{constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},QC="ngNavigationCancelingError";function Nc(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=$i(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=YC(!1,$t.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function YC(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[QC]=!0,t.cancellationCode=e,t}function r1(n){return XC(n)&&$i(n.url)}function XC(n){return!!n&&n[QC]}var i1=(n,e,t,r)=>le(i=>(new Jf(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Jf=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Of(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=ks(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ks(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=ks(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=ks(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Wf(s.value.snapshot))}),e.children.length&&this.forwardEvent(new $f(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Of(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Of(a.route.value),this.activateChildRoutes(e,null,o.children)}else o.attachRef=null,o.route=i,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}else this.activateChildRoutes(e,null,r)}},Fc=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Fs=class{constructor(e,t){this.component=e,this.route=t}};function s1(n,e,t){let r=n._root,i=e?e._root:null;return Ca(r,i,t,[r.value])}function o1(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function js(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!LS(n)?n:e.get(n):r}function Ca(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=ks(e);return n.children.forEach(o=>{a1(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Ea(a,t.getContext(o),i)),i}function a1(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let l=l1(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new Fc(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Ca(n,e,a?a.children:null,r,i):Ca(n,e,t,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Fs(a.outlet.component,o))}else o&&Ea(e,a,i),i.canActivateChecks.push(new Fc(r)),s.component?Ca(n,null,a?a.children:null,r,i):Ca(n,null,t,r,i);return i}function l1(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!ji(n.url,e.url);case"pathParamsOrQueryParamsChange":return!ji(n.url,e.url)||!qn(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Yf(n,e)||!qn(n.queryParams,e.queryParams);case"paramsChange":default:return!Yf(n,e)}}function Ea(n,e,t){let r=ks(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?Ea(o,e.children.getContext(s),t):Ea(o,null,t):Ea(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Fs(e.outlet.component,i)):t.canDeactivateChecks.push(new Fs(null,i)):t.canDeactivateChecks.push(new Fs(null,i))}function La(n){return typeof n=="function"}function c1(n){return typeof n=="boolean"}function u1(n){return n&&La(n.canLoad)}function d1(n){return n&&La(n.canActivate)}function h1(n){return n&&La(n.canActivateChild)}function f1(n){return n&&La(n.canDeactivate)}function p1(n){return n&&La(n.canMatch)}function JC(n){return n instanceof OS||n?.name==="EmptyError"}var bc=Symbol("INITIAL_VALUE");function qs(){return ot(n=>uc(n.map(e=>e.pipe(Is(1),mf(bc)))).pipe(le(e=>{for(let t of e)if(t!==!0){if(t===bc)return bc;if(t===!1||m1(t))return t}return!0}),Nn(e=>e!==bc),Is(1)))}function m1(n){return $i(n)||n instanceof Da}function g1(n,e){return qt(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?J(Ae(q({},t),{guardsResult:!0})):y1(o,r,i,n).pipe(qt(a=>a&&c1(a)?v1(r,s,n,e):J(a)),le(a=>Ae(q({},t),{guardsResult:a})))})}function y1(n,e,t,r){return nt(n).pipe(qt(i=>w1(i.component,i.route,t,e,r)),Fn(i=>i!==!0,!0))}function v1(n,e,t,r){return nt(e).pipe(Ts(i=>MS(C1(i.route.parent,r),S1(i.route,r),b1(n,i.path,t),_1(n,i.route,t))),Fn(i=>i!==!0,!0))}function S1(n,e){return n!==null&&e&&e(new Gf(n)),J(!0)}function C1(n,e){return n!==null&&e&&e(new jf(n)),J(!0)}function _1(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return J(!0);let i=r.map(s=>uf(()=>{let o=Na(e)??t,a=js(s,o),l=d1(a)?a.canActivate(e,n):Bn(o,()=>a(e,n));return Xr(l).pipe(Fn())}));return J(i).pipe(qs())}function b1(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>o1(o)).filter(o=>o!==null).map(o=>uf(()=>{let a=o.guards.map(l=>{let c=Na(o.node)??t,u=js(l,c),h=h1(u)?u.canActivateChild(r,n):Bn(c,()=>u(r,n));return Xr(h).pipe(Fn())});return J(a).pipe(qs())}));return J(s).pipe(qs())}function w1(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return J(!0);let o=s.map(a=>{let l=Na(e)??i,c=js(a,l),u=f1(c)?c.canDeactivate(n,e,t,r):Bn(l,()=>c(n,e,t,r));return Xr(u).pipe(Fn())});return J(o).pipe(qs())}function E1(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return J(!0);let s=i.map(o=>{let a=js(o,n),l=u1(a)?a.canLoad(e,t):Bn(n,()=>a(e,t));return Xr(l)});return J(s).pipe(qs(),ZC(r))}function ZC(n){return of(at(e=>{if(typeof e!="boolean")throw Nc(n,e)}),le(e=>e===!0))}function T1(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return J(!0);let s=i.map(o=>{let a=js(o,n),l=p1(a)?a.canMatch(e,t):Bn(n,()=>a(e,t));return Xr(l)});return J(s).pipe(qs(),ZC(r))}var Oa=class{constructor(e){this.segmentGroup=e||null}},Ma=class extends Error{constructor(e){super(),this.urlTree=e}};function xs(n){return aa(new Oa(n))}function I1(n){return aa(new rt(4e3,!1))}function A1(n){return aa(YC(!1,$t.GuardRejected))}var Zf=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return J(r);if(i.numberOfChildren>1||!i.children[oe])return I1(`${e.redirectTo}`);i=i.children[oe]}}applyRedirectCommands(e,t,r,i,s){if(typeof t!="string"){let a=t,{queryParams:l,fragment:c,routeConfig:u,url:h,outlet:f,params:v,data:b,title:E}=i,w=Bn(s,()=>a({params:v,data:b,queryParams:l,fragment:c,routeConfig:u,url:h,outlet:f,title:E}));if(w instanceof Er)throw new Ma(w);t=w}let o=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t[0]==="/")throw new Ma(o);return o}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new Er(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(e,l,r,i)}),new _e(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path[0]===":"?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new rt(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},ep={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function R1(n,e,t,r,i){let s=e_(n,e,t);return s.matched?(r=XD(e,r),T1(r,e,t,i).pipe(le(o=>o===!0?s:q({},ep)))):J(s)}function e_(n,e,t){if(e.path==="**")return D1(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?q({},ep):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||TD)(t,n,e);if(!i)return q({},ep);let s={};Object.entries(i.posParams??{}).forEach(([a,l])=>{s[a]=l.path});let o=i.consumed.length>0?q(q({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function D1(n){return{matched:!0,parameters:n.length>0?kC(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function AC(n,e,t,r){return t.length>0&&x1(n,t,r)?{segmentGroup:new _e(e,M1(r,new _e(t,n.children))),slicedSegments:[]}:t.length===0&&k1(n,t,r)?{segmentGroup:new _e(n.segments,O1(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new _e(n.segments,n.children),slicedSegments:t}}function O1(n,e,t,r){let i={};for(let s of t)if(Bc(n,e,s)&&!r[Sn(s)]){let o=new _e([],{});i[Sn(s)]=o}return q(q({},r),i)}function M1(n,e){let t={};t[oe]=e;for(let r of n)if(r.path===""&&Sn(r)!==oe){let i=new _e([],{});t[Sn(r)]=i}return t}function x1(n,e,t){return t.some(r=>Bc(n,e,r)&&Sn(r)!==oe)}function k1(n,e,t){return t.some(r=>Bc(n,e,r))}function Bc(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function P1(n,e,t){return e.length===0&&!n.children[t]}var tp=class{};function N1(n,e,t,r,i,s,o="emptyOnly"){return new np(n,e,t,r,i,o,s).recognize()}var F1=31,np=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Zf(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new rt(4002,`'${e.segmentGroup}'`)}recognize(){let e=AC(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(le(({children:t,rootSnapshot:r})=>{let i=new jt(r,t),s=new Pc("",i),o=$D(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}))}match(e){let t=new Ns([],Object.freeze({}),Object.freeze(q({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),oe,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,oe,t).pipe(le(r=>({children:r,rootSnapshot:t})),Es(r=>{if(r instanceof Ma)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Oa?this.noMatchError(r):r}))}processSegmentGroup(e,t,r,i,s){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r,s):this.processSegment(e,t,r,r.segments,i,!0,s).pipe(le(o=>o instanceof jt?[o]:[]))}processChildren(e,t,r,i){let s=[];for(let o of Object.keys(r.children))o==="primary"?s.unshift(o):s.push(o);return nt(s).pipe(Ts(o=>{let a=r.children[o],l=JD(t,o);return this.processSegmentGroup(e,l,a,o,i)}),ff((o,a)=>(o.push(...a),o)),df(null),NS(),qt(o=>{if(o===null)return xs(r);let a=t_(o);return L1(a),J(a)}))}processSegment(e,t,r,i,s,o,a){return nt(t).pipe(Ts(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,r,i,s,o,a).pipe(Es(c=>{if(c instanceof Oa)return J(null);throw c}))),Fn(l=>!!l),Es(l=>{if(JC(l))return P1(r,i,s)?J(new tp):xs(r);throw l}))}processSegmentAgainstRoute(e,t,r,i,s,o,a,l){return Sn(r)!==o&&(o===oe||!Bc(i,s,r))?xs(i):r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o,l):xs(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:h,remainingSegments:f}=e_(t,i,s);if(!l)return xs(t);typeof i.redirectTo=="string"&&i.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>F1&&(this.allowRedirects=!1));let v=new Ns(s,c,Object.freeze(q({},this.urlTree.queryParams)),this.urlTree.fragment,RC(i),Sn(i),i.component??i._loadedComponent??null,i,DC(i)),b=kc(v,a,this.paramsInheritanceStrategy);v.params=Object.freeze(b.params),v.data=Object.freeze(b.data);let E=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,h,v,e);return this.applyRedirects.lineralizeSegments(i,E).pipe(qt(w=>this.processSegment(e,r,t,w.concat(f),o,!1,a)))}matchSegmentAgainstRoute(e,t,r,i,s,o){let a=R1(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),a.pipe(ot(l=>l.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(ot(({routes:c})=>{let u=r._loadedInjector??e,{parameters:h,consumedSegments:f,remainingSegments:v}=l,b=new Ns(f,h,Object.freeze(q({},this.urlTree.queryParams)),this.urlTree.fragment,RC(r),Sn(r),r.component??r._loadedComponent??null,r,DC(r)),E=kc(b,o,this.paramsInheritanceStrategy);b.params=Object.freeze(E.params),b.data=Object.freeze(E.data);let{segmentGroup:w,slicedSegments:M}=AC(t,f,v,c);if(M.length===0&&w.hasChildren())return this.processChildren(u,c,w,b).pipe(le(P=>new jt(b,P)));if(c.length===0&&M.length===0)return J(new jt(b,[]));let T=Sn(r)===s;return this.processSegment(u,c,w,M,T?oe:s,!0,b).pipe(le(P=>new jt(b,P instanceof jt?[P]:[])))}))):xs(t)))}getChildConfig(e,t,r){return t.children?J({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?J({routes:t._loadedRoutes,injector:t._loadedInjector}):E1(e,t,r,this.urlSerializer).pipe(qt(i=>i?this.configLoader.loadChildren(e,t).pipe(at(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):A1(t))):J({routes:[],injector:e})}};function L1(n){n.sort((e,t)=>e.value.outlet===oe?-1:t.value.outlet===oe?1:e.value.outlet.localeCompare(t.value.outlet))}function V1(n){let e=n.value.routeConfig;return e&&e.path===""}function t_(n){let e=[],t=new Set;for(let r of n){if(!V1(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=t_(r.children);e.push(new jt(r.value,i))}return e.filter(r=>!t.has(r))}function RC(n){return n.data||{}}function DC(n){return n.resolve||{}}function B1(n,e,t,r,i,s){return qt(o=>N1(n,e,t,r,o.extractedUrl,i,s).pipe(le(({state:a,tree:l})=>Ae(q({},o),{targetSnapshot:a,urlAfterRedirects:l}))))}function U1(n,e){return qt(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return J(t);let s=new Set(i.map(l=>l.route)),o=new Set;for(let l of s)if(!o.has(l))for(let c of n_(l))o.add(c);let a=0;return nt(o).pipe(Ts(l=>s.has(l)?q1(l,r,n,e):(l.data=kc(l,l.parent,n).resolve,J(void 0))),at(()=>a++),hf(1),qt(l=>a===o.size?J(t):jr))})}function n_(n){let e=n.children.map(t=>n_(t)).flat();return[n,...e]}function q1(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!KC(i)&&(s[ka]=i.title),z1(s,n,e,r).pipe(le(o=>(n._resolvedData=o,n.data=kc(n,n.parent,t).resolve,null)))}function z1(n,e,t,r){let i=kf(n);if(i.length===0)return J({});let s={};return nt(i).pipe(qt(o=>j1(n[o],e,t,r).pipe(Fn(),at(a=>{if(a instanceof Da)throw Nc(new Vs,a);s[o]=a}))),hf(1),PS(s),Es(o=>JC(o)?jr:aa(o)))}function j1(n,e,t,r){let i=Na(e)??r,s=js(n,i),o=s.resolve?s.resolve(e,t):Bn(i,()=>s(e,t));return Xr(o)}function Mf(n){return ot(e=>{let t=n(e);return t?nt(t).pipe(le(()=>e)):J(e)})}var r_=(()=>{class n{buildTitle(t){let r,i=t.root;for(;i!==void 0;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===oe);return r}getResolvedTitleForRoute(t){return t.data[ka]}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:()=>ee($1),providedIn:"root"})}}return n})(),$1=(()=>{class n extends r_{constructor(t){super(),this.title=t}updateTitle(t){let r=this.buildTitle(t);r!==void 0&&this.title.setTitle(r)}static{this.\u0275fac=function(r){return new(r||n)(ae(dC))}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Va=new fe("",{providedIn:"root",factory:()=>({})}),G1=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=Qe({type:n,selectors:[["ng-component"]],standalone:!0,features:[Je],decls:1,vars:0,template:function(r,i){r&1&&ue(0,"router-outlet")},dependencies:[sp],encapsulation:2})}}return n})();function op(n){let e=n.children&&n.children.map(op),t=e?Ae(q({},n),{children:e}):q({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==oe&&(t.component=G1),t}var xa=new fe(""),ap=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ee(yc)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return J(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let r=Xr(t.loadComponent()).pipe(le(i_),at(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),dc(()=>{this.componentLoaders.delete(t)})),i=new lf(r,()=>new Yt).pipe(af());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return J({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let s=W1(r,this.compiler,t,this.onLoadEndListener).pipe(dc(()=>{this.childrenLoaders.delete(r)})),o=new lf(s,()=>new Yt).pipe(af());return this.childrenLoaders.set(r,o),o}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function W1(n,e,t,r){return Xr(n.loadChildren()).pipe(le(i_),qt(i=>i instanceof GS||Array.isArray(i)?J(i):nt(e.compileModuleAsync(i))),le(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(xa,[],{optional:!0,self:!0}).flat()),{routes:o.map(op),injector:s}}))}function H1(n){return n&&typeof n=="object"&&"default"in n}function i_(n){return H1(n)?n.default:n}var lp=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:()=>ee(K1),providedIn:"root"})}}return n})(),K1=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),s_=new fe(""),o_=new fe("");function Q1(n,e,t){let r=n.get(o_),i=n.get(JS);return n.get(zt).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(c=>setTimeout(c));let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),Y1(n))),{onViewTransitionCreated:l}=r;return l&&Bn(n,()=>l({transition:a,from:e,to:t})),o})}function Y1(n){return new Promise(e=>{WS({read:()=>setTimeout(e)},{injector:n})})}var X1=new fe(""),cp=(()=>{class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Yt,this.transitionAbortSubject=new Yt,this.configLoader=ee(ap),this.environmentInjector=ee(ca),this.urlSerializer=ee(Pa),this.rootContexts=ee(Fa),this.location=ee(ma),this.inputBindingEnabled=ee(Vc,{optional:!0})!==null,this.titleStrategy=ee(r_),this.options=ee(Va,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ee(lp),this.createViewTransition=ee(s_,{optional:!0}),this.navigationErrorHandler=ee(X1,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>J(void 0),this.rootComponentType=null;let t=i=>this.events.next(new qf(i)),r=i=>this.events.next(new zf(i));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=t}complete(){this.transitions?.complete()}handleNavigationRequest(t){let r=++this.navigationId;this.transitions?.next(Ae(q(q({},this.transitions.value),t),{id:r}))}setupNavigations(t,r,i){return this.transitions=new Rt({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:wa,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Nn(s=>s.id!==0),le(s=>Ae(q({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),ot(s=>{let o=!1,a=!1;return J(s).pipe(ot(l=>{if(this.navigationId>s.id)return this.cancelNavigationTransition(s,"",$t.SupersededByNewNavigation),jr;this.currentTransition=s,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?Ae(q({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!c&&u!=="reload"){let h="";return this.events.next(new Yr(l.id,this.urlSerializer.serialize(l.rawUrl),h,Rc.IgnoredSameUrlNavigation)),l.resolve(!1),jr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return J(l).pipe(ot(h=>{let f=this.transitions?.getValue();return this.events.next(new Bs(h.id,this.urlSerializer.serialize(h.extractedUrl),h.source,h.restoredState)),f!==this.transitions?.getValue()?jr:Promise.resolve(h)}),B1(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),at(h=>{s.targetSnapshot=h.targetSnapshot,s.urlAfterRedirects=h.urlAfterRedirects,this.currentNavigation=Ae(q({},this.currentNavigation),{finalUrl:h.urlAfterRedirects});let f=new Dc(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:h,extractedUrl:f,source:v,restoredState:b,extras:E}=l,w=new Bs(h,this.urlSerializer.serialize(f),v,b);this.events.next(w);let M=WC(this.rootComponentType).snapshot;return this.currentTransition=s=Ae(q({},l),{targetSnapshot:M,urlAfterRedirects:f,extras:Ae(q({},E),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,J(s)}else{let h="";return this.events.next(new Yr(l.id,this.urlSerializer.serialize(l.extractedUrl),h,Rc.IgnoredByUrlHandlingStrategy)),l.resolve(!1),jr}}),at(l=>{let c=new Lf(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),le(l=>(this.currentTransition=s=Ae(q({},l),{guards:s1(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),s)),g1(this.environmentInjector,l=>this.events.next(l)),at(l=>{if(s.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw Nc(this.urlSerializer,l.guardsResult);let c=new Vf(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),Nn(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",$t.GuardRejected),!1)),Mf(l=>{if(l.guards.canActivateChecks.length)return J(l).pipe(at(c=>{let u=new Bf(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),ot(c=>{let u=!1;return J(c).pipe(U1(this.paramsInheritanceStrategy,this.environmentInjector),at({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",$t.NoDataFromResolver)}}))}),at(c=>{let u=new Uf(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),Mf(l=>{let c=u=>{let h=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&h.push(this.configLoader.loadComponent(u.routeConfig).pipe(at(f=>{u.component=f}),le(()=>{})));for(let f of u.children)h.push(...c(f));return h};return uc(c(l.targetSnapshot.root)).pipe(df(null),Is(1))}),Mf(()=>this.afterPreactivation()),ot(()=>{let{currentSnapshot:l,targetSnapshot:c}=s,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?nt(u).pipe(le(()=>s)):J(s)}),le(l=>{let c=e1(t.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=s=Ae(q({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,s}),at(()=>{this.events.next(new Aa)}),i1(this.rootContexts,t.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),Is(1),at({next:l=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new zn(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{o=!0}}),FS(this.transitionAbortSubject.pipe(at(l=>{throw l}))),dc(()=>{!o&&!a&&this.cancelNavigationTransition(s,"",$t.SupersededByNewNavigation),this.currentTransition?.id===s.id&&(this.currentNavigation=null,this.currentTransition=null)}),Es(l=>{if(a=!0,XC(l))this.events.next(new wr(s.id,this.urlSerializer.serialize(s.extractedUrl),l.message,l.cancellationCode)),r1(l)?this.events.next(new Us(l.url,l.navigationBehaviorOptions)):s.resolve(!1);else{let c=new Ia(s.id,this.urlSerializer.serialize(s.extractedUrl),l,s.targetSnapshot??void 0);try{let u=Bn(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(u instanceof Da){let{message:h,cancellationCode:f}=Nc(this.urlSerializer,u);this.events.next(new wr(s.id,this.urlSerializer.serialize(s.extractedUrl),h,f)),this.events.next(new Us(u.redirectTo,u.navigationBehaviorOptions))}else{this.events.next(c);let h=t.errorHandler(l);s.resolve(!!h)}}catch(u){this.options.resolveNavigationPromiseOnError?s.resolve(!1):s.reject(u)}}return jr}))}))}cancelNavigationTransition(t,r,i){let s=new wr(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(s),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function J1(n){return n!==wa}var Z1=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:()=>ee(eO),providedIn:"root"})}}return n})(),rp=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},eO=(()=>{class n extends rp{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Wr(n)))(i||n)}})()}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),a_=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:()=>ee(tO),providedIn:"root"})}}return n})(),tO=(()=>{class n extends a_{constructor(){super(...arguments),this.location=ee(ma),this.urlSerializer=ee(Pa),this.options=ee(Va,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ee(lp),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Er,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=WC(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{r.type==="popstate"&&t(r.url,r.state)})}handleRouterEvent(t,r){if(t instanceof Bs)this.stateMemento=this.createStateMemento();else if(t instanceof Yr)this.rawUrlTree=r.initialUrl;else if(t instanceof Dc){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??i,r)}}else t instanceof Aa?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):t instanceof wr&&(t.code===$t.GuardRejected||t.code===$t.NoDataFromResolver)?this.restoreHistory(r):t instanceof Ia?this.restoreHistory(r,!0):t instanceof zn&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,r){let i=t instanceof Er?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){let s=this.browserPageId,o=q(q({},r.extras.state),this.generateNgRouterState(r.id,s));this.location.replaceState(i,"",o)}else{let s=q(q({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(i,"",s)}}restoreHistory(t,r=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,s=this.currentPageId-i;s!==0?this.location.historyGo(s):this.currentUrlTree===t.finalUrl&&s===0&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Wr(n)))(i||n)}})()}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),_a=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(_a||{});function l_(n,e){n.events.pipe(Nn(t=>t instanceof zn||t instanceof wr||t instanceof Ia||t instanceof Yr),le(t=>t instanceof zn||t instanceof Yr?_a.COMPLETE:(t instanceof wr?t.code===$t.Redirect||t.code===$t.SupersededByNewNavigation:!1)?_a.REDIRECTING:_a.FAILED),Nn(t=>t!==_a.REDIRECTING),Is(1)).subscribe(()=>{e()})}function nO(n){throw n}var rO={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},iO={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Le=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=ee(KS),this.stateManager=ee(a_),this.options=ee(Va,{optional:!0})||{},this.pendingTasks=ee(US),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ee(cp),this.urlSerializer=ee(Pa),this.location=ee(ma),this.urlHandlingStrategy=ee(lp),this._events=new Yt,this.errorHandler=this.options.errorHandler||nO,this.navigated=!1,this.routeReuseStrategy=ee(Z1),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ee(xa,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ee(Vc,{optional:!0}),this.eventsSubscription=new IS,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(r=>{try{let i=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(i!==null&&s!==null){if(this.stateManager.handleRouterEvent(r,s),r instanceof wr&&r.code!==$t.Redirect&&r.code!==$t.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof zn)this.navigated=!0;else if(r instanceof Us){let o=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),l=q({browserUrl:i.extras.browserUrl,info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:i.extras.replaceUrl||this.urlUpdateStrategy==="eager"||J1(i.source)},o);this.scheduleNavigation(a,wa,null,l,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}oO(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),wa,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",r)},0)})}navigateToSyncWithBrowser(t,r,i){let s={replaceUrl:!0},o=i?.navigationId?i:null;if(i){let l=q({},i);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(s.state=l)}let a=this.parseUrl(t);this.scheduleNavigation(a,r,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(op),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){let{relativeTo:i,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:o,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=q(q({},this.currentUrlTree.queryParams),s);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}u!==null&&(u=this.removeEmptyProps(u));let h;try{let f=i?i.snapshot:this.routerState.snapshot.root;h=zC(f)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),h=this.currentUrlTree.root}return jC(h,t,u,c??null)}navigateByUrl(t,r={skipLocationChange:!1}){let i=$i(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,wa,null,r)}navigate(t,r={skipLocationChange:!1}){return sO(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let i;if(r===!0?i=q({},rO):r===!1?i=q({},iO):i=r,$i(t))return bC(this.currentUrlTree,t,i);let s=this.parseUrl(t);return bC(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.entries(t).reduce((r,[i,s])=>(s!=null&&(r[i]=s),r),{})}scheduleNavigation(t,r,i,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,c;o?(a=o.resolve,l=o.reject,c=o.promise):c=new Promise((h,f)=>{a=h,l=f});let u=this.pendingTasks.add();return l_(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(h=>Promise.reject(h))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function sO(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new rt(4008,!1)}function oO(n){return!(n instanceof Aa)&&!(n instanceof Us)}var Jr=(()=>{class n{constructor(t,r,i,s,o,a){this.router=t,this.route=r,this.tabIndexAttribute=i,this.renderer=s,this.el=o,this.locationStrategy=a,this.href=null,this.onChanges=new Yt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;let l=o.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=t.events.subscribe(c=>{c instanceof zn&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):($i(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,r,i,s,o){let a=this.urlTree;if(a===null||this.isAnchorElement&&(t!==0||r||i||s||o||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.href=t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t)):null;let r=this.href===null?null:qS(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(t,r){let i=this.renderer,s=this.el.nativeElement;r!==null?i.setAttribute(s,t,r):i.removeAttribute(s,t)}get urlTree(){return this.routerLinkInput===null?null:$i(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(r){return new(r||n)(G(Le),G(jn),BS("tabindex"),G(da),G(ua),G(pa))}}static{this.\u0275dir=lt({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,i){r&1&&Ce("click",function(o){return i.onClick(o.button,o.ctrlKey,o.shiftKey,o.altKey,o.metaKey)}),r&2&&ha("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Qr],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Qr],replaceUrl:[2,"replaceUrl","replaceUrl",Qr],routerLink:"routerLink"},standalone:!0,features:[$S,Gr]})}}return n})();var Lc=class{};var aO=(()=>{class n{constructor(t,r,i,s,o){this.router=t,this.injector=i,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(Nn(t=>t instanceof zn),Ts(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){let i=[];for(let s of r){s.providers&&!s._injector&&(s._injector=vf(s.providers,t,`Route: ${s.path}`));let o=s._injector??t,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&s.canLoad===void 0||s.loadComponent&&!s._loadedComponent)&&i.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&i.push(this.processRoutes(a,s.children??s._loadedRoutes))}return nt(i).pipe(cf())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let i;r.loadChildren&&r.canLoad===void 0?i=this.loader.loadChildren(t,r):i=J(null);let s=i.pipe(qt(o=>o===null?J(void 0):(r._loadedRoutes=o.routes,r._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));if(r.loadComponent&&!r._loadedComponent){let o=this.loader.loadComponent(r);return nt([s,o]).pipe(cf())}else return s})}static{this.\u0275fac=function(r){return new(r||n)(ae(Le),ae(yc),ae(ca),ae(Lc),ae(ap))}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),c_=new fe(""),lO=(()=>{class n{constructor(t,r,i,s,o={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=i,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration||="disabled",o.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Bs?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof zn?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Yr&&t.code===Rc.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Oc&&(t.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(t.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Oc(t,this.lastSource==="popstate"?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(r){zS()}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac})}}return n})();function u_(n,...e){return As([{provide:xa,multi:!0,useValue:n},[],{provide:jn,useFactory:d_,deps:[Le]},{provide:_f,multi:!0,useFactory:h_},e.map(t=>t.\u0275providers)])}function d_(n){return n.routerState.root}function Ba(n,e){return{\u0275kind:n,\u0275providers:e}}function h_(){let n=ee(Hr);return e=>{let t=n.get(QS);if(e!==t.components[0])return;let r=n.get(Le),i=n.get(f_);n.get(up)===1&&r.initialNavigation(),n.get(p_,null,yf.Optional)?.setUpPreloading(),n.get(c_,null,yf.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var f_=new fe("",{factory:()=>new Yt}),up=new fe("",{providedIn:"root",factory:()=>1});function cO(){return Ba(2,[{provide:up,useValue:0},{provide:Cf,multi:!0,deps:[Hr],useFactory:e=>{let t=e.get(ZS,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(Le),s=e.get(f_);l_(i,()=>{r(!0)}),e.get(cp).afterPreactivation=()=>(r(!0),s.closed?J(void 0):s),i.initialNavigation()}))}}])}function uO(){return Ba(3,[{provide:Cf,multi:!0,useFactory:()=>{let e=ee(Le);return()=>{e.setUpLocationChangeListener()}}},{provide:up,useValue:2}])}var p_=new fe("");function dO(n){return Ba(0,[{provide:p_,useExisting:aO},{provide:Lc,useExisting:n}])}function hO(){return Ba(8,[IC,{provide:Vc,useExisting:IC}])}function fO(n){let e=[{provide:s_,useValue:Q1},{provide:o_,useValue:q({skipNextTransition:!!n?.skipInitialTransition},n)}];return Ba(9,e)}var OC=new fe("ROUTER_FORROOT_GUARD"),pO=[ma,{provide:Pa,useClass:Vs},Le,Fa,{provide:jn,useFactory:d_,deps:[Le]},ap,[]],$n=(()=>{class n{constructor(t){}static forRoot(t,r){return{ngModule:n,providers:[pO,[],{provide:xa,multi:!0,useValue:t},{provide:OC,useFactory:vO,deps:[[Le,new Xt,new VS]]},{provide:Va,useValue:r||{}},r?.useHash?gO():yO(),mO(),r?.preloadingStrategy?dO(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?SO(r):[],r?.bindToComponentInputs?hO().\u0275providers:[],r?.enableViewTransitions?fO().\u0275providers:[],CO()]}}static forChild(t){return{ngModule:n,providers:[{provide:xa,multi:!0,useValue:t}]}}static{this.\u0275fac=function(r){return new(r||n)(ae(OC,8))}}static{this.\u0275mod=Vn({type:n})}static{this.\u0275inj=Ln({})}}return n})();function mO(){return{provide:c_,useFactory:()=>{let n=ee(sC),e=ee(zt),t=ee(Va),r=ee(cp),i=ee(Pa);return t.scrollOffset&&n.setOffset(t.scrollOffset),new lO(i,r,n,e,t)}}}function gO(){return{provide:pa,useClass:tC}}function yO(){return{provide:pa,useClass:eC}}function vO(n){return"guarded"}function SO(n){return[n.initialNavigation==="disabled"?uO().\u0275providers:[],n.initialNavigation==="enabledBlocking"?cO().\u0275providers:[]]}var MC=new fe("");function CO(){return[{provide:MC,useFactory:h_},{provide:_f,multi:!0,useExisting:MC}]}var Uc=class n{title="e-commerce";static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Qe({type:n,selectors:[["app-root"]],standalone:!0,features:[Je],decls:1,vars:0,template:function(t,r){t&1&&ue(0,"router-outlet")},dependencies:[sp,cC]})};var _O="firebase",bO="10.14.1";Ot(_O,bO,"app");var Cn=new pc("ANGULARFIRE2_VERSION");function hp(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Ua=(n,e)=>{let t=e?[e]:Cc(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},ei=class{constructor(){return Ua(wO)}},wO="app-check";function $s(){}var qc=class{zone;delegate;constructor(e,t=RS){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},dp=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",$s,{},$s,$s)),t.pipe(at({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Wi=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new qc(Zone.current)),this.insideAngular=t.run(()=>new qc(Zone.current,AS)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ae(zt))};static \u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function zc(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function EO(n){return zc().ngZone.runOutsideAngular(()=>n())}function Gi(n){return zc().ngZone.run(()=>n())}function fp(n){return TO(zc())(n)}function TO(n){return function(t){return t=t.lift(new dp(n.ngZone)),t.pipe(Ui(n.outsideAngular),$r(n.insideAngular))}}var IO=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Gi(()=>n.apply(void 0,r))},sn=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=Gi(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",$s,{},$s,$s))),r[s]=IO(r[s],t));let i=EO(()=>n.apply(this,r));if(!e)if(i instanceof zr){let s=zc();return i.pipe(Ui(s.outsideAngular),$r(s.insideAngular))}else return Gi(()=>i);return i instanceof zr?i.pipe(fp):i instanceof Promise?Gi(()=>new Promise((s,o)=>i.then(a=>Gi(()=>s(a)),a=>Gi(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Gi(()=>i)};var RO="firebase",DO="10.14.1";vn.registerVersion(RO,DO,"app-compat");var OO=["ngOnDestroy"],g_=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(OO.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let h=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var jc=class{constructor(e){return e}},$c=new fe("angularfire2.app.options"),Gc=new fe("angularfire2.app.name");function pp(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=vn.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>vn.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;MO("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new jc(o)}var MO=(n,...e)=>{wf()&&typeof console<"u"&&console[n](...e)},xO={provide:jc,useFactory:pp,deps:[$c,zt,[new Xt,Gc]]},y_=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:$c,useValue:t},{provide:Gc,useValue:r}]}}constructor(t){vn.registerVersion("angularfire",Cn.full,"core"),vn.registerVersion("angularfire",Cn.full,"app-compat"),vn.registerVersion("angular",mc.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ae(Rs))};static \u0275mod=Vn({type:n});static \u0275inj=Ln({providers:[xO]})}return n})();function v_(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return kO(i,o)||(m_("error",`${e} was already initialized on the ${t} Firebase App with different settings.${PO?" You may need to reload as Firebase is not HMR aware.":""}`),m_("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function kO(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var PO=typeof module<"u"&&!!module.hot,m_=(n,...e)=>{wf()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Ir=class{constructor(e){return e}},qa=class{constructor(){return Cc()}};function NO(n){return n&&n.length===1?n[0]:new Ir(va())}var mp=new fe("angularfire2._apps"),FO={provide:Ir,useFactory:NO,deps:[[new Xt,mp]]},LO={provide:qa,deps:[[new Xt,mp]]};function VO(n){return(e,t)=>{let r=t.get(Rs);Ot("angularfire",Cn.full,"core"),Ot("angularfire",Cn.full,"app"),Ot("angular",mc.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new Ir(i)}}function gp(n,...e){return As([FO,LO,{provide:mp,useFactory:VO(n),multi:!0,deps:[zt,Hr,Wi,...e]}])}var BO=new Map,UO={activated:!1,tokenObservers:[]},qO={initialized:!1,enabled:!1};function _n(n){return BO.get(n)||Object.assign({},UO)}function w_(){return qO}var zO="https://content-firebaseappcheck.googleapis.com/v1";var jO="exchangeDebugToken",S_={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},O$=24*60*60*1e3;var vp=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return A(this,null,function*(){this.stop();try{this.pending=new Tf,this.pending.promise.catch(t=>{}),yield $O(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Tf,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function $O(n){return new Promise(e=>{setTimeout(e,n)})}var GO={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ti=new CC("appCheck","AppCheck",GO);function E_(n){if(!_n(n).activated)throw ti.create("use-before-activation",{appName:n.name})}function T_(r,i){return A(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let v=yield o.getHeartbeatsHeader();v&&(s["X-Firebase-Client"]=v)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(v){throw ti.create("fetch-network-error",{originalErrorMessage:v?.message})}if(l.status!==200)throw ti.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(v){throw ti.create("fetch-parse-error",{originalErrorMessage:v?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw ti.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(u[1])*1e3,f=Date.now();return{token:c.token,expireTimeMillis:f+h,issuedAtTimeMillis:f}})}function I_(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${zO}/projects/${t}/apps/${r}:${jO}?key=${i}`,body:{debug_token:e}}}var WO="firebase-app-check-database",HO=1,Sp="firebase-app-check-store";var Wc=null;function KO(){return Wc||(Wc=new Promise((n,e)=>{try{let t=indexedDB.open(WO,HO);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(ti.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Sp,{keyPath:"compositeKey"})}}}catch(t){e(ti.create("storage-open",{originalErrorMessage:t?.message}))}}),Wc)}function QO(n,e){return YO(XO(n),e)}function YO(n,e){return A(this,null,function*(){let r=(yield KO()).transaction(Sp,"readwrite"),s=r.objectStore(Sp).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(ti.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function XO(n){return`${n.options.appId}-${n.name}`}var Cp=new vc("@firebase/app-check");function yp(n,e){return If()?QO(n,e).catch(t=>{Cp.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function A_(){return w_().enabled}function R_(){return A(this,null,function*(){let n=w_();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var JO={error:"UNKNOWN_ERROR"};function ZO(n){return pC.encodeString(JSON.stringify(n),!1)}function _p(n,e=!1){return A(this,null,function*(){let t=n.app;E_(t);let r=_n(t),i=r.token,s;if(i&&!za(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(za(l)?i=l:yield yp(t,void 0))}if(!e&&i&&za(i))return{token:i.token};let o=!1;if(A_()){r.exchangeTokenPromise||(r.exchangeTokenPromise=T_(I_(t,yield R_()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield yp(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield _n(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Cp.warn(l.message):Cp.error(l),s=l}let a;return i?s?za(i)?a={token:i.token,internalError:s}:a=__(s):(a={token:i.token},r.token=i,yield yp(t,i)):a=__(s),o&&rM(t,a),a})}function eM(n){return A(this,null,function*(){let e=n.app;E_(e);let{provider:t}=_n(e);if(A_()){let r=yield R_(),{token:i}=yield T_(I_(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function tM(n,e,t,r){let{app:i}=n,s=_n(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&za(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),C_(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>C_(n))}function D_(n,e){let t=_n(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function C_(n){let{app:e}=n,t=_n(e),r=t.tokenRefresher;r||(r=nM(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function nM(n){let{app:e}=n;return new vp(()=>A(this,null,function*(){let t=_n(e),r;if(t.token?r=yield _p(n,!0):r=yield _p(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=_n(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},S_.RETRIAL_MIN_WAIT,S_.RETRIAL_MAX_WAIT)}function rM(n,e){let t=_n(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function za(n){return n.expireTimeMillis-Date.now()>0}function __(n){return{token:ZO(JO),error:n}}var bp=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=_n(this.app);for(let t of e)D_(this.app,t.next);return Promise.resolve()}};function iM(n,e){return new bp(n,e)}function sM(n){return{getToken:e=>_p(n,e),getLimitedUseToken:()=>eM(n),addTokenListener:e=>tM(n,"INTERNAL",e),removeTokenListener:e=>D_(n.app,e)}}var oM="@firebase/app-check",aM="0.8.8";var lM="app-check",b_="app-check-internal";function cM(){ya(new ga(lM,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return iM(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(b_).initialize()})),ya(new ga(b_,n=>{let e=n.getProvider("app-check").getImmediate();return sM(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ot(oM,aM)}cM();var uM=["localhost","0.0.0.0","127.0.0.1"],z$=typeof window<"u"&&uM.includes(window.location.hostname);var hM=new fe("angularfire2.auth.use-emulator"),fM=new fe("angularfire2.auth.settings"),pM=new fe("angularfire2.auth.tenant-id"),mM=new fe("angularfire2.auth.langugage-code"),gM=new fe("angularfire2.auth.use-device-language"),yM=new fe("angularfire.auth.persistence"),vM=(n,e,t,r,i,s,o,a)=>v_(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),ja=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,h,f,v){let b=new Yt,E=J(void 0).pipe($r(o.outsideAngular),ot(()=>s.runOutsideAngular(()=>import("./chunk-B7XJRL7T.mjs"))),le(()=>pp(t,s,r)),le(w=>vM(w,s,a,c,u,h,l,f)),pf({bufferSize:1,refCount:!1}));if(iC(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=J(null);else{E.pipe(Fn()).subscribe();let w=E.pipe(ot(P=>P.getRedirectResult().then(N=>N,()=>null)),fp,pf({bufferSize:1,refCount:!1})),M=E.pipe(ot(P=>new zr(N=>({unsubscribe:s.runOutsideAngular(()=>P.onAuthStateChanged(W=>N.next(W),W=>N.error(W),()=>N.complete()))})))),T=E.pipe(ot(P=>new zr(N=>({unsubscribe:s.runOutsideAngular(()=>P.onIdTokenChanged(W=>N.next(W),W=>N.error(W),()=>N.complete()))}))));this.authState=w.pipe(gf(M),Ui(o.outsideAngular),$r(o.insideAngular)),this.user=w.pipe(gf(T),Ui(o.outsideAngular),$r(o.insideAngular)),this.idToken=this.user.pipe(ot(P=>P?nt(P.getIdToken()):J(null))),this.idTokenResult=this.user.pipe(ot(P=>P?nt(P.getIdTokenResult()):J(null))),this.credential=kS(w,b,this.authState.pipe(Nn(P=>!P))).pipe(le(P=>P?.user?P:null),Ui(o.outsideAngular),$r(o.insideAngular))}return g_(this,E,s,{spy:{apply:(w,M,T)=>{(w.startsWith("signIn")||w.startsWith("createUser"))&&T.then(P=>b.next(P))}}})}static \u0275fac=function(r){return new(r||n)(ae($c),ae(Gc,8),ae(Rs),ae(zt),ae(Wi),ae(hM,8),ae(fM,8),ae(pM,8),ae(mM,8),ae(gM,8),ae(yM,8),ae(ei,8))};static \u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),O_=(()=>{class n{constructor(){vn.registerVersion("angularfire",Cn.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Vn({type:n});static \u0275inj=Ln({providers:[ja]})}return n})();var Gn=class n{constructor(e){this.http=e}getProducts(){return this.http.get("https://dummyjson.com/products")}getProductCategory(){return this.http.get("https://dummyjson.com/products/category-list")}getProductByCategory(e){return console.log("selected category",e),this.http.get(`https://dummyjson.com/products/category/${e}`)}getProductBykey(e){return this.http.get(`https://dummyjson.com/products/search?q=${e}`)}getProductDetailsById(e){return this.http.get(`https://dummyjson.com/products/${e}`)}static \u0275fac=function(t){return new(t||n)(ae(oC))};static \u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})};var CM=n=>["/produits",n];function _M(n,e){if(n&1&&(D(0,"span",10),U(1),O()),n&2){let t=$e();B(),Xe(" ",t.getState()," ")}}function bM(n,e){if(n&1&&(D(0,"span",11),U(1),O()),n&2){let t=$e();B(),Dt(t.getState())}}var Kc=class n{constructor(e,t){this.productService=e;this.router=t}produit;selectedProduct=new Ye;selectedDetailsProduct=new Ye;addToPanier(){this.selectedProduct.emit(this.produit)}getState(){return this.produit.stock>0?"En stock":"En rupture de stock"}getColor(){return this.produit.stock>0?"green":"red"}static \u0275fac=function(t){return new(t||n)(G(Gn),G(Le))};static \u0275cmp=Qe({type:n,selectors:[["app-product-item"]],inputs:{produit:"produit"},outputs:{selectedProduct:"selectedProduct",selectedDetailsProduct:"selectedDetailsProduct"},standalone:!0,features:[Je],decls:20,vars:10,consts:[["outOfStock",""],[1,"product","text-center"],[3,"routerLink"],["alt","palette",1,"img-fluid","mb-3",3,"src"],[1,"star"],[1,"fas","fa-star"],[1,"p-name"],[1,"p-price"],[1,"buy-btn","text-light",3,"click","disabled"],["style","color: green;",4,"ngIf","ngIfElse"],[2,"color","green"],[2,"color","red"]],template:function(t,r){if(t&1){let i=St();D(0,"div",1)(1,"a",2),ue(2,"img",3),O(),D(3,"div",4),ue(4,"i",5)(5,"i",5)(6,"i",5)(7,"i",5)(8,"i",5),O(),D(9,"h5",6),U(10),O(),D(11,"h4",7),U(12),O(),D(13,"div")(14,"button",8),Ce("click",function(){return Re(i),De(r.addToPanier())}),U(15),O(),ue(16,"br"),Ue(17,_M,2,1,"span",9)(18,bM,2,1,"ng-template",null,0,fc),O()()}if(t&2){let i=Zt(19);B(),re("routerLink",hc(8,CM,r.produit.id)),B(),re("src",r.produit.thumbnail,mr),B(8),Dt(r.produit.title),B(2),Xe(" $",r.produit.price,""),B(2),re("disabled",r.getState()==="En rupture de stock"),B(),Xe(" ",r.getState()==="En stock"?"Buy Now":"Out of Stock"," "),B(2),re("ngIf",r.getState()==="En stock")("ngIfElse",i)}},dependencies:[en,$n,Jr],styles:[".product[_ngcontent-%COMP%]{cursor:pointer;margin-bottom:2rem}.product[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transition:.3s all}.product[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{opacity:.7;transition:.3s all}.buy-btn[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.526);padding:0 10px;background:#fb774b;transform:translateY(20px);opacity:0;transition:.3s all}.product[_ngcontent-%COMP%]:hover   .buy-btn[_ngcontent-%COMP%]{transform:translateY(0);opacity:1}hr[_ngcontent-%COMP%]{width:80px;height:2px;background-color:#fb774b}.star[_ngcontent-%COMP%]{padding:10px 0}.star[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.8rem;color:#daa520}"]})};var B_=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(G(da),G(ua))}}static{this.\u0275dir=lt({type:n})}}return n})(),wM=(()=>{class n extends B_{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Wr(n)))(i||n)}})()}static{this.\u0275dir=lt({type:n,features:[Jt]})}}return n})(),Rp=new fe("");var EM={provide:Rp,useExisting:pr(()=>Wn),multi:!0};function TM(){let n=Ef()?Ef().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var IM=new fe(""),Wn=(()=>{class n extends B_{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!TM())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(G(da),G(ua),G(IM,8))}}static{this.\u0275dir=lt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&Ce("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[Sr([EM]),Jt]})}}return n})();function ni(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function U_(n){return n!=null&&typeof n.length=="number"}var Ki=new fe(""),iu=new fe(""),AM=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ya=class{static min(e){return RM(e)}static max(e){return DM(e)}static required(e){return q_(e)}static requiredTrue(e){return OM(e)}static email(e){return z_(e)}static minLength(e){return j_(e)}static maxLength(e){return MM(e)}static pattern(e){return xM(e)}static nullValidator(e){return Yc(e)}static compose(e){return Q_(e)}static composeAsync(e){return Y_(e)}};function RM(n){return e=>{if(ni(e.value)||ni(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function DM(n){return e=>{if(ni(e.value)||ni(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function q_(n){return ni(n.value)?{required:!0}:null}function OM(n){return n.value===!0?null:{required:!0}}function z_(n){return ni(n.value)||AM.test(n.value)?null:{email:!0}}function j_(n){return e=>ni(e.value)||!U_(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function MM(n){return e=>U_(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function xM(n){if(!n)return Yc;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(ni(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function Yc(n){return null}function $_(n){return n!=null}function G_(n){return gc(n)?nt(n):n}function W_(n){let e={};return n.forEach(t=>{e=t!=null?q(q({},e),t):e}),Object.keys(e).length===0?null:e}function H_(n,e){return e.map(t=>t(n))}function kM(n){return!n.validate}function K_(n){return n.map(e=>kM(e)?e:t=>e.validate(t))}function Q_(n){if(!n)return null;let e=n.filter($_);return e.length==0?null:function(t){return W_(H_(t,e))}}function Dp(n){return n!=null?Q_(K_(n)):null}function Y_(n){if(!n)return null;let e=n.filter($_);return e.length==0?null:function(t){let r=H_(t,e).map(G_);return xS(r).pipe(le(W_))}}function Op(n){return n!=null?Y_(K_(n)):null}function M_(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function X_(n){return n._rawValidators}function J_(n){return n._rawAsyncValidators}function wp(n){return n?Array.isArray(n)?n:[n]:[]}function Xc(n,e){return Array.isArray(n)?n.includes(e):n===e}function x_(n,e){let t=wp(e);return wp(n).forEach(i=>{Xc(t,i)||t.push(i)}),t}function k_(n,e){return wp(e).filter(t=>!Xc(n,t))}var Jc=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Dp(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Op(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Ar=class extends Jc{get formDirective(){return null}get path(){return null}},Hi=class extends Jc{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Zc=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},PM={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},DG=Ae(q({},PM),{"[class.ng-submitted]":"isSubmitted"}),ii=(()=>{class n extends Zc{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(G(Hi,2))}}static{this.\u0275dir=lt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Sf("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Jt]})}}return n})(),Qs=(()=>{class n extends Zc{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(G(Ar,10))}}static{this.\u0275dir=lt({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&Sf("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[Jt]})}}return n})();var $a="VALID",Qc="INVALID",Gs="PENDING",Ga="DISABLED",ri=class{},eu=class extends ri{constructor(e,t){super(),this.value=e,this.source=t}},Ha=class extends ri{constructor(e,t){super(),this.pristine=e,this.source=t}},Ka=class extends ri{constructor(e,t){super(),this.touched=e,this.source=t}},Ws=class extends ri{constructor(e,t){super(),this.status=e,this.source=t}},Ep=class extends ri{constructor(e){super(),this.source=e}},Tp=class extends ri{constructor(e){super(),this.source=e}};function Mp(n){return(su(n)?n.validators:n)||null}function NM(n){return Array.isArray(n)?Dp(n):n||null}function xp(n,e){return(su(e)?e.asyncValidators:n)||null}function FM(n){return Array.isArray(n)?Op(n):n||null}function su(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function Z_(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new rt(1e3,"");if(!r[t])throw new rt(1001,"")}function eb(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new rt(1002,"")})}var Hs=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Os(()=>this.statusReactive()),this.statusReactive=Ds(void 0),this._pristine=Os(()=>this.pristineReactive()),this.pristineReactive=Ds(!0),this._touched=Os(()=>this.touchedReactive()),this.touchedReactive=Ds(!1),this._events=new Yt,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return _r(this.statusReactive)}set status(e){_r(()=>this.statusReactive.set(e))}get valid(){return this.status===$a}get invalid(){return this.status===Qc}get pending(){return this.status==Gs}get disabled(){return this.status===Ga}get enabled(){return this.status!==Ga}get pristine(){return _r(this.pristineReactive)}set pristine(e){_r(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return _r(this.touchedReactive)}set touched(e){_r(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(x_(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(x_(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(k_(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(k_(e,this._rawAsyncValidators))}hasValidator(e){return Xc(this._rawValidators,e)}hasAsyncValidator(e){return Xc(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Ae(q({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Ka(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new Ka(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Ae(q({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Ha(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new Ha(!0,r))}markAsPending(e={}){this.status=Gs;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ws(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Ae(q({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ga,this.errors=null,this._forEachChild(i=>{i.disable(Ae(q({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new eu(this.value,r)),this._events.next(new Ws(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ae(q({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=$a,this._forEachChild(r=>{r.enable(Ae(q({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Ae(q({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===$a||this.status===Gs)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new eu(this.value,t)),this._events.next(new Ws(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Ae(q({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ga:$a}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Gs,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=G_(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new Ws(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new Ye,this.statusChanges=new Ye}_calculateStatus(){return this._allControlsDisabled()?Ga:this.errors?Qc:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Gs)?Gs:this._anyControlsHaveStatus(Qc)?Qc:$a}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new Ha(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Ka(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){su(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=NM(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=FM(this._rawAsyncValidators)}},Ks=class extends Hs{constructor(e,t,r){super(Mp(t),xp(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){eb(this,!0,e),Object.keys(e).forEach(r=>{Z_(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Ip=class extends Ks{};var Xa=new fe("CallSetDisabledState",{providedIn:"root",factory:()=>ou}),ou="always";function tb(n,e){return[...e.path,n]}function tu(n,e,t=ou){kp(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),VM(n,e),UM(n,e),BM(n,e),LM(n,e)}function P_(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),ru(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function nu(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function LM(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function kp(n,e){let t=X_(n);e.validator!==null?n.setValidators(M_(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=J_(n);e.asyncValidator!==null?n.setAsyncValidators(M_(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();nu(e._rawValidators,i),nu(e._rawAsyncValidators,i)}function ru(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=X_(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=J_(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return nu(e._rawValidators,r),nu(e._rawAsyncValidators,r),t}function VM(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&nb(n,e)})}function BM(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&nb(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function nb(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function UM(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function rb(n,e){n==null,kp(n,e)}function qM(n,e){return ru(n,e)}function ib(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function zM(n){return Object.getPrototypeOf(n.constructor)===wM}function sb(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function ob(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Wn?t=s:zM(s)?r=s:i=s}),i||r||t||null}function jM(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var $M={provide:Ar,useExisting:pr(()=>Ja)},Wa=Promise.resolve(),Ja=(()=>{class n extends Ar{get submitted(){return _r(this.submittedReactive)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=Os(()=>this.submittedReactive()),this.submittedReactive=Ds(!1),this._directives=new Set,this.ngSubmit=new Ye,this.form=new Ks({},Dp(t),Op(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Wa.then(()=>{let r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),tu(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Wa.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Wa.then(()=>{let r=this._findContainer(t.path),i=new Ks({});rb(i,t),r.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Wa.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){Wa.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),sb(this.form,this._directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(r){return new(r||n)(G(Ki,10),G(iu,10),G(Xa,8))}}static{this.\u0275dir=lt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,i){r&1&&Ce("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Sr([$M]),Jt]})}}return n})();function N_(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function F_(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Qa=class extends Hs{constructor(e=null,t,r){super(Mp(t),xp(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),su(t)&&(t.nonNullable||t.initialValueIsDefault)&&(F_(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){N_(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){N_(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){F_(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var GM=n=>n instanceof Qa;var WM={provide:Hi,useExisting:pr(()=>Qi)},L_=Promise.resolve(),Qi=(()=>{class n extends Hi{constructor(t,r,i,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new Qa,this._registered=!1,this.name="",this.update=new Ye,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=ob(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),ib(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){tu(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){L_.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Qr(r);L_.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?tb(t,this._parent):[t]}static{this.\u0275fac=function(r){return new(r||n)(G(Ar,9),G(Ki,10),G(iu,10),G(Rp,10),G(fa,8),G(Xa,8))}}static{this.\u0275dir=lt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Sr([WM]),Jt,Gr]})}}return n})(),Ys=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=lt({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var ab=new fe("");var HM={provide:Ar,useExisting:pr(()=>Pp)},Pp=(()=>{class n extends Ar{get submitted(){return _r(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=Os(()=>this._submittedReactive()),this._submittedReactive=Ds(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Ye,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ru(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let r=this.form.get(t.path);return tu(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){P_(t.control||null,t,!1),jM(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this._submittedReactive.set(!0),sb(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new Ep(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this._submittedReactive.set(!1),this.form._events.next(new Tp(this.form))}_updateDomValue(){this.directives.forEach(t=>{let r=t.control,i=this.form.get(t.path);r!==i&&(P_(r||null,t),GM(i)&&(tu(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let r=this.form.get(t.path);rb(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let r=this.form.get(t.path);r&&qM(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){kp(this.form,this),this._oldForm&&ru(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(r){return new(r||n)(G(Ki,10),G(iu,10),G(Xa,8))}}static{this.\u0275dir=lt({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,i){r&1&&Ce("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Sr([HM]),Jt,Gr]})}}return n})();var KM={provide:Hi,useExisting:pr(()=>Np)},Np=(()=>{class n extends Hi{set isDisabled(t){}static{this._ngModelWarningSentOnce=!1}constructor(t,r,i,s,o){super(),this._ngModelWarningConfig=o,this._added=!1,this.name=null,this.update=new Ye,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=ob(this,s)}ngOnChanges(t){this._added||this._setUpControl(),ib(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return tb(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(r){return new(r||n)(G(Ar,13),G(Ki,10),G(iu,10),G(Rp,10),G(ab,8))}}static{this.\u0275dir=lt({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[Sr([KM]),Jt,Gr]})}}return n})();function QM(n){return typeof n=="number"?n:parseInt(n,10)}var Fp=(()=>{class n{constructor(){this._validator=Yc}ngOnChanges(t){if(this.inputName in t){let r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):Yc,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=lt({type:n,features:[Gr]})}}return n})();var YM={provide:Ki,useExisting:pr(()=>Za),multi:!0};var Za=(()=>{class n extends Fp{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Qr,this.createValidator=t=>q_}enabled(t){return t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Wr(n)))(i||n)}})()}static{this.\u0275dir=lt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,i){r&2&&ha("required",i._enabled?"":null)},inputs:{required:"required"},features:[Sr([YM]),Jt]})}}return n})();var XM={provide:Ki,useExisting:pr(()=>Lp),multi:!0},Lp=(()=>{class n extends Fp{constructor(){super(...arguments),this.inputName="email",this.normalizeInput=Qr,this.createValidator=t=>z_}enabled(t){return t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Wr(n)))(i||n)}})()}static{this.\u0275dir=lt({type:n,selectors:[["","email","","formControlName",""],["","email","","formControl",""],["","email","","ngModel",""]],inputs:{email:"email"},features:[Sr([XM]),Jt]})}}return n})(),JM={provide:Ki,useExisting:pr(()=>Vp),multi:!0},Vp=(()=>{class n extends Fp{constructor(){super(...arguments),this.inputName="minlength",this.normalizeInput=t=>QM(t),this.createValidator=t=>j_(t)}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Wr(n)))(i||n)}})()}static{this.\u0275dir=lt({type:n,selectors:[["","minlength","","formControlName",""],["","minlength","","formControl",""],["","minlength","","ngModel",""]],hostVars:1,hostBindings:function(r,i){r&2&&ha("minlength",i._enabled?i.minlength:null)},inputs:{minlength:"minlength"},features:[Sr([JM]),Jt]})}}return n})();var lb=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Vn({type:n})}static{this.\u0275inj=Ln({})}}return n})(),Ap=class extends Hs{constructor(e,t,r){super(Mp(t),xp(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){eb(this,!1,e),e.forEach((r,i)=>{Z_(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function V_(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var cb=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){let t=new n;return t.useNonNullable=!0,t}group(t,r=null){let i=this._reduceControls(t),s={};return V_(r)?s=r:r!==null&&(s.validators=r.validator,s.asyncValidators=r.asyncValidator),new Ks(i,s)}record(t,r=null){let i=this._reduceControls(t);return new Ip(i,r)}control(t,r,i){let s={};return this.useNonNullable?(V_(r)?s=r:(s.validators=r,s.asyncValidators=i),new Qa(t,Ae(q({},s),{nonNullable:!0}))):new Qa(t,r,i)}array(t,r,i){let s=t.map(o=>this._createControl(o));return new Ap(s,r,i)}_reduceControls(t){let r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){if(t instanceof Qa)return t;if(t instanceof Hs)return t;if(Array.isArray(t)){let r=t[0],i=t.length>1?t[1]:null,s=t.length>2?t[2]:null;return this.control(r,i,s)}else return this.control(t)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Xs=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Xa,useValue:t.callSetDisabledState??ou}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Vn({type:n})}static{this.\u0275inj=Ln({imports:[lb]})}}return n})(),ub=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:ab,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Xa,useValue:t.callSetDisabledState??ou}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Vn({type:n})}static{this.\u0275inj=Ln({imports:[lb]})}}return n})();var ut=class n{constructor(e,t){this.afAuth=e;this.router=t;if(typeof window<"u"&&window.sessionStorage){let r=sessionStorage.getItem("isLoggedIn")==="true";this.isLoggedInSubject=new Rt(r),this.isLoggedIn$=this.isLoggedInSubject.asObservable()}}getToken;isLoggedInSubject=new Rt(!1);isLoggedIn$=this.isLoggedInSubject.asObservable();saveLoginState(e){sessionStorage.setItem("isLoggedIn",JSON.stringify(e)),this.isLoggedInSubject.next(e)}SignUp(e,t,r){this.afAuth.createUserWithEmailAndPassword(e,r).then(i=>{i.user?.sendEmailVerification().then(()=>alert("Verification email sent. Please check your email."))}).catch(i=>{console.error("Error signing up:",i)})}login(e,t){this.afAuth.signInWithEmailAndPassword(e,t).then(()=>{this.saveLoginState(!0)}).catch(r=>{console.log("An error occurred during login:",r)})}logout(){this.afAuth.signOut().then(()=>{this.saveLoginState(!1)}).catch(e=>{console.log("An error occurred during logout:",e)})}getUsername(){return A(this,null,function*(){let e=yield this.afAuth.currentUser;return e?e.displayName:null})}getUserId(){return A(this,null,function*(){let e=yield this.afAuth.currentUser;return e?e.uid:null})}isAuthenticated(){return this.isLoggedInSubject.getValue()}static \u0275fac=function(t){return new(t||n)(ae(ja),ae(Le))};static \u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})};var ZM=n=>({active:n}),ex=()=>["/orders"],tx=()=>["/panier"];function nx(n,e){if(n&1){let t=St();D(0,"div",20)(1,"ul",21)(2,"li")(3,"a",22),Ce("click",function(){let i=Re(t).$implicit,s=$e();return De(s.onCategoryClick(i))}),U(4),O()()()()}if(n&2){let t=e.$implicit;B(4),Dt(t)}}function rx(n,e){if(n&1){let t=St();D(0,"button",23),Ce("click",function(){Re(t);let i=$e();return De(i.signIn())}),U(1," Sign In "),O()}}function ix(n,e){if(n&1){let t=St();D(0,"div",24)(1,"div",25)(2,"button",26),ue(3,"i",27),O(),D(4,"span",28),U(5),O(),D(6,"div",29)(7,"a",30),Ce("click",function(){Re(t);let i=$e();return De(i.signOut())}),U(8,"Logout"),O()()()()}if(n&2){let t=$e();B(5),Xe(" Bienvenue,",t.username," ")}}var Nt=class n{constructor(e,t,r){this.productService=e;this.authService=t;this.router=r}isSearchActive=!1;currentPanier=[];displayedPanier=new Ye;categories=[];searchKey;searchedText=new Ye;selectedCategory=new Ye;isAuthenticated=!1;username=null;resetProducts=new Ye;ngOnInit(){this.authService.isLoggedIn$.subscribe(e=>{this.isAuthenticated=e,e?this.authService.getUsername().then(t=>{this.username=t}):this.username=null}),this.productService.getProductCategory().subscribe(e=>{this.categories=e},e=>{console.error("Error fetching products",e)})}showPanier(){this.displayedPanier.emit(!0)}toggleSearch(){this.isSearchActive=!this.isSearchActive}onSearchByKey(){console.log(this.searchKey),this.searchedText.emit(this.searchKey)}onCategoryClick(e){this.selectedCategory.emit(e)}signIn(){this.router.navigate(["/auth"])}signOut(){this.authService.logout()}onHomeClick(){this.resetProducts.emit()}static \u0275fac=function(t){return new(t||n)(G(Gn),G(ut),G(Le))};static \u0275cmp=Qe({type:n,selectors:[["app-navbar"]],outputs:{currentPanier:"currentPanier",displayedPanier:"displayedPanier",searchedText:"searchedText",selectedCategory:"selectedCategory",resetProducts:"resetProducts"},standalone:!0,features:[Je],decls:28,vars:11,consts:[[1,"navbar","navbar-expand-lg","navbar-light","bg-light"],[1,"container"],["src","e-commerce.png","alt","logo",1,"navbar-logo","bg-body-tertiary"],[1,"logo-name"],[1,"dropdown","ml-5"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-secondary","dropdown-toggle","custom-dropdown-btn",2,"font-family","Poppins"],[1,"mega","dropdown-menu","custom-dropdown-menu"],[1,"row"],["class","col-12 col-sm-6 col-md-4 col-lg-3",4,"ngFor","ngForOf"],[1,"search-container","ml-5"],["type","text","placeholder","search here...",1,"search-click",3,"ngModelChange","ngModel","ngClass"],[1,"panier","fa-sharp","fa-solid","fa-magnifying-glass",3,"click"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","ml-auto"],[1,"nav-item"],["routerLink","",1,"nav-link",3,"click"],[1,"nav-link",3,"routerLink"],[1,"fa-solid","fa-cart-shopping",3,"routerLink"],["class","btn-signin","type","button",3,"click",4,"ngIf"],["class","user-menu",4,"ngIf"],[1,"col-12","col-sm-6","col-md-4","col-lg-3"],[1,"list-unstyled"],["href","#",1,"dropdown-item","category-item",3,"click"],["type","button",1,"btn-signin",3,"click"],[1,"user-menu"],[1,"dropdown"],["type","button",1,"dropdown-toggle"],[1,"fa-regular","fa-user"],[1,"welcome-text"],[1,"dropdown-menu"],[1,"dropdown-item",3,"click"]],template:function(t,r){t&1&&(D(0,"nav",0)(1,"div",1),ue(2,"img",2),D(3,"span",3),U(4," ShopIT\xA0\xA0\xA0 . "),O(),D(5,"div",4)(6,"button",5),U(7," Our categories "),O(),D(8,"div",6)(9,"div",1)(10,"div",7),Ue(11,nx,5,1,"div",8),O()()()(),D(12,"div",9)(13,"input",10),Ce("ngModelChange",function(){return r.onSearchByKey()}),vr("ngModelChange",function(s){return yr(r.searchKey,s)||(r.searchKey=s),s}),O(),D(14,"i",11),Ce("click",function(){return r.toggleSearch()}),O()(),D(15,"div",12)(16,"ul",13)(17,"li",14)(18,"a",15),Ce("click",function(){return r.onHomeClick()}),U(19,"Home"),O()(),D(20,"li",14)(21,"a",16),U(22,"My orders"),O()(),D(23,"li",14),U(24," My cart "),ue(25,"i",17),O()(),Ue(26,rx,2,0,"button",18)(27,ix,9,1,"div",19),O()()()),t&2&&(B(11),re("ngForOf",r.categories),B(2),gr("ngModel",r.searchKey),re("ngClass",hc(7,ZM,r.isSearchActive)),B(8),re("routerLink",qi(9,ex)),B(4),re("routerLink",qi(10,tx)),B(),re("ngIf",!r.isAuthenticated),B(),re("ngIf",r.isAuthenticated))},dependencies:[tn,nC,Un,en,Xs,Wn,ii,Qi,$n,Jr],styles:['.navbar[_ngcontent-%COMP%]{font-size:16px}.navbar-logo[_ngcontent-%COMP%]{max-height:50px;max-width:40px}.logo-name[_ngcontent-%COMP%]{margin-left:20px;font-family:Poppins;font-weight:700}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{padding:0 20px;color:#000;transition:.3s ease}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover, .navbar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover, .navbar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:active, .navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:coral}.navbar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem;padding:0 7px;cursor:pointer;transition:.3 ease}#bar[_ngcontent-%COMP%]{font-size:1.5rem;padding:7px;cursor:pointer;transition:.3 ease;color:#000}#bar[_ngcontent-%COMP%]:hover, #bar[_ngcontent-%COMP%]:active{color:coral}@media only screen and (max-width: 991px){#navbarSupportedContent[_ngcontent-%COMP%] > ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:nth-child(n) > a[_ngcontent-%COMP%]{padding:10px 0}}.navbar-light[_ngcontent-%COMP%]   .navbar-toggler[_ngcontent-%COMP%]{border:none;outline:none}.search-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.search-click[_ngcontent-%COMP%]{border:none;outline:none;background-size:22px;background-position:13px;border-radius:10px;width:200px;height:50px;padding:25px 10px;transition:all .5s}.search-click[_ngcontent-%COMP%]:focus{width:400px;padding-left:50px}.search-click[_ngcontent-%COMP%]:focus-visible{outline:none}.search-click[_ngcontent-%COMP%]{position:relative;overflow:hidden;height:50px}.search-click[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:transparent;border:1px solid #ccc;outline:none;position:absolute;width:400px;height:50px;left:0%;padding:10px}.custom-dropdown-btn[_ngcontent-%COMP%]{background-color:transparent;border:none;outline:none;color:#000;font-size:16px;padding:0;transition:color .3s}.dropdown-menu[_ngcontent-%COMP%]{margin-top:0}.mega[_ngcontent-%COMP%]{position:absolute;width:850px;height:auto;top:auto;left:0;right:0;line-height:2em;background-color:#fff5f5dd;z-index:100;padding:20px;background-color:#f8f9fa;border:none}li[_ngcontent-%COMP%]{font-family:Poppins}.category-item[_ngcontent-%COMP%]{position:relative;text-decoration:none;cursor:pointer;transition:color .3s ease,border-color .3s ease}.category-item[_ngcontent-%COMP%]:after{content:"";position:absolute;width:0;height:2px;display:block;bottom:-5px;left:0;background:#000;transition:width .3s ease}.category-item[_ngcontent-%COMP%]:hover:after{width:100%}.category-item[_ngcontent-%COMP%]:focus{outline:none}.category-item[_ngcontent-%COMP%]:active{outline:none;background-color:transparent}.category-item[_ngcontent-%COMP%]:hover{color:#fb774b}.custom-dropdown-menu[_ngcontent-%COMP%]{margin-top:10px}.btn-light[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:1px solid #ccc;padding:10px 20px;font-size:16px;border-radius:5px;cursor:pointer;transition:background-color .3s ease,color .3s ease}.btn-light[_ngcontent-%COMP%]:hover{background-color:#f0f0f0;color:#000}.btn-signin[_ngcontent-%COMP%]{background-color:#fb774b;color:#fff;border:none;padding:10px 20px;border-radius:25px;font-family:Poppins;font-size:14px;cursor:pointer;transition:background-color .3s ease}.btn-signin[_ngcontent-%COMP%]:hover{background-color:#e86b3a}.user-menu[_ngcontent-%COMP%]{display:inline-block;position:relative}.welcome-text[_ngcontent-%COMP%]{font-size:16px;font-family:Poppins}.dropdown[_ngcontent-%COMP%]{position:relative}.dropdown-toggle[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.dropdown-menu[_ngcontent-%COMP%]{display:none;position:absolute;top:100%;right:0;background-color:#fff;box-shadow:0 4px 8px #0003;z-index:1000}.dropdown[_ngcontent-%COMP%]:hover   .dropdown-menu[_ngcontent-%COMP%]{display:block}.dropdown-item[_ngcontent-%COMP%]{padding:8px 16px;cursor:pointer;color:#000;text-decoration:none}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}']})};var Js=class n{panier=[];totalprice=0;constructor(){if(typeof window<"u"&&window.sessionStorage){let e=sessionStorage.getItem("panier");e&&(this.panier=JSON.parse(e))}}savePanier(){sessionStorage.setItem("panier",JSON.stringify(this.panier))}ajouterAuPanier(e){let t=this.panier.find(r=>r.produit.id===e.produit.id);t?t.qte++:this.panier.push(e),this.savePanier()}getPanier(){return this.panier}updateTotalPrice(){return this.totalprice=0,this.panier.forEach(e=>this.totalprice+=e.produit.price*e.qte),console.log(this.totalprice),this.totalprice}viderPanier(){this.panier=[]}increaseQuantity(e){e.qte++,this.savePanier()}remove(e){let t=this.panier.find(r=>r.produit.id===e.produit.id);if(t){let r=this.panier.indexOf(t);r>-1&&this.panier.splice(r,1)}this.savePanier(),console.log(this.panier)}decreaseQuantity(e){e.qte>1?e.qte--:this.remove(e),this.savePanier()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})};function sx(n,e){n&1&&(D(0,"div",6)(1,"h3"),U(2,"Featured Products"),O(),ue(3,"hr",7),D(4,"p"),U(5,"Check out our new Products on ShopIT ."),O()())}function ox(n,e){if(n&1&&(D(0,"div",6)(1,"h3",8),U(2),O(),ue(3,"hr",7),D(4,"p"),U(5,"Check out our Products ."),O()()),n&2){let t=$e();B(2),Xe(" ",t.categorySelected,"")}}function ax(n,e){if(n&1){let t=St();D(0,"app-product-item",9),Ce("selectedProduct",function(i){Re(t);let s=$e();return De(s.addItem(i))}),O()}if(n&2){let t=e.$implicit;re("produit",t)}}var el=class n{constructor(e,t){this.productService=e;this.panierService=t}detailsPanier=[];categoryIschosen=!1;categorySelected;products;ngOnInit(){this.productService.getProducts().subscribe(e=>{this.products=e.products},e=>{console.error("Error fetching products",e)}),this.productService.getProductCategory()}addItem(e){let t={produit:e,qte:1};this.panierService.ajouterAuPanier(t),console.log("Produit ajout\xE9 au panier:",this.panierService.getPanier())}onSearchByKey(e){this.productService.getProductBykey(e).subscribe(t=>{this.products=t.products},t=>{console.error("Error fetching products",t)})}displayCategoryProducts(e){this.categorySelected=e,this.categoryIschosen=!0,this.productService.getProductByCategory(e).subscribe(t=>{this.products=t.products},t=>{console.error("Error fetching products Category",t)})}resetCategory(){this.categoryIschosen=!1,this.productService.getProducts().subscribe(e=>{this.products=e.products},e=>{console.error("Error fetching products",e)})}static \u0275fac=function(t){return new(t||n)(G(Gn),G(Js))};static \u0275cmp=Qe({type:n,selectors:[["app-list-products"]],standalone:!0,features:[Je],decls:7,vars:3,consts:[["categoryChosen",""],[3,"resetProducts","searchedText","selectedCategory"],["id","featured",1,"my-5","pb-5"],["class","container text-center mt-5 py-5",4,"ngIf","ngIfElse"],[1,"row","mx-auto","container-fluid","flex"],["class","col-lg-3 col-md-4 col-12",3,"produit","selectedProduct",4,"ngFor","ngForOf"],[1,"container","text-center","mt-5","py-5"],[1,"mx-auto"],[2,"text-transform","uppercase"],[1,"col-lg-3","col-md-4","col-12",3,"selectedProduct","produit"]],template:function(t,r){if(t&1){let i=St();D(0,"app-navbar",1),Ce("resetProducts",function(){return Re(i),De(r.resetCategory())})("searchedText",function(o){return Re(i),De(r.onSearchByKey(o))})("selectedCategory",function(o){return Re(i),De(r.displayCategoryProducts(o))}),O(),D(1,"section",2),Ue(2,sx,6,0,"div",3)(3,ox,6,1,"ng-template",null,0,fc),D(5,"div",4),Ue(6,ax,1,1,"app-product-item",5),O()()}if(t&2){let i=Zt(4);B(2),re("ngIf",!r.categoryIschosen)("ngIfElse",i),B(4),re("ngForOf",r.products)}},dependencies:[Kc,tn,Un,en,Nt]})};var R9=sf(ED(),1);var lk="auth";var lu=class{constructor(){return Ua(lk)}};import{inspect as SU,TextEncoder as CU,TextDecoder as eH}from"util";import{randomBytes as _U}from"crypto";var hb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fb={};var oi,Bp;(function(){var n;function e(C,g){function y(){}y.prototype=g.prototype,C.D=g.prototype,C.prototype=new y,C.prototype.constructor=C,C.C=function(S,p,_){for(var d=Array(arguments.length-2),m=2;m<arguments.length;m++)d[m-2]=arguments[m];return g.prototype[p].apply(S,d)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(C,g,y){y||(y=0);var S=Array(16);if(typeof g=="string")for(var p=0;16>p;++p)S[p]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(p=0;16>p;++p)S[p]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=C.g[0],y=C.g[1],p=C.g[2];var _=C.g[3],d=g+(_^y&(p^_))+S[0]+3614090360&4294967295;g=y+(d<<7&4294967295|d>>>25),d=_+(p^g&(y^p))+S[1]+3905402710&4294967295,_=g+(d<<12&4294967295|d>>>20),d=p+(y^_&(g^y))+S[2]+606105819&4294967295,p=_+(d<<17&4294967295|d>>>15),d=y+(g^p&(_^g))+S[3]+3250441966&4294967295,y=p+(d<<22&4294967295|d>>>10),d=g+(_^y&(p^_))+S[4]+4118548399&4294967295,g=y+(d<<7&4294967295|d>>>25),d=_+(p^g&(y^p))+S[5]+1200080426&4294967295,_=g+(d<<12&4294967295|d>>>20),d=p+(y^_&(g^y))+S[6]+2821735955&4294967295,p=_+(d<<17&4294967295|d>>>15),d=y+(g^p&(_^g))+S[7]+4249261313&4294967295,y=p+(d<<22&4294967295|d>>>10),d=g+(_^y&(p^_))+S[8]+1770035416&4294967295,g=y+(d<<7&4294967295|d>>>25),d=_+(p^g&(y^p))+S[9]+2336552879&4294967295,_=g+(d<<12&4294967295|d>>>20),d=p+(y^_&(g^y))+S[10]+4294925233&4294967295,p=_+(d<<17&4294967295|d>>>15),d=y+(g^p&(_^g))+S[11]+2304563134&4294967295,y=p+(d<<22&4294967295|d>>>10),d=g+(_^y&(p^_))+S[12]+1804603682&4294967295,g=y+(d<<7&4294967295|d>>>25),d=_+(p^g&(y^p))+S[13]+4254626195&4294967295,_=g+(d<<12&4294967295|d>>>20),d=p+(y^_&(g^y))+S[14]+2792965006&4294967295,p=_+(d<<17&4294967295|d>>>15),d=y+(g^p&(_^g))+S[15]+1236535329&4294967295,y=p+(d<<22&4294967295|d>>>10),d=g+(p^_&(y^p))+S[1]+4129170786&4294967295,g=y+(d<<5&4294967295|d>>>27),d=_+(y^p&(g^y))+S[6]+3225465664&4294967295,_=g+(d<<9&4294967295|d>>>23),d=p+(g^y&(_^g))+S[11]+643717713&4294967295,p=_+(d<<14&4294967295|d>>>18),d=y+(_^g&(p^_))+S[0]+3921069994&4294967295,y=p+(d<<20&4294967295|d>>>12),d=g+(p^_&(y^p))+S[5]+3593408605&4294967295,g=y+(d<<5&4294967295|d>>>27),d=_+(y^p&(g^y))+S[10]+38016083&4294967295,_=g+(d<<9&4294967295|d>>>23),d=p+(g^y&(_^g))+S[15]+3634488961&4294967295,p=_+(d<<14&4294967295|d>>>18),d=y+(_^g&(p^_))+S[4]+3889429448&4294967295,y=p+(d<<20&4294967295|d>>>12),d=g+(p^_&(y^p))+S[9]+568446438&4294967295,g=y+(d<<5&4294967295|d>>>27),d=_+(y^p&(g^y))+S[14]+3275163606&4294967295,_=g+(d<<9&4294967295|d>>>23),d=p+(g^y&(_^g))+S[3]+4107603335&4294967295,p=_+(d<<14&4294967295|d>>>18),d=y+(_^g&(p^_))+S[8]+1163531501&4294967295,y=p+(d<<20&4294967295|d>>>12),d=g+(p^_&(y^p))+S[13]+2850285829&4294967295,g=y+(d<<5&4294967295|d>>>27),d=_+(y^p&(g^y))+S[2]+4243563512&4294967295,_=g+(d<<9&4294967295|d>>>23),d=p+(g^y&(_^g))+S[7]+1735328473&4294967295,p=_+(d<<14&4294967295|d>>>18),d=y+(_^g&(p^_))+S[12]+2368359562&4294967295,y=p+(d<<20&4294967295|d>>>12),d=g+(y^p^_)+S[5]+4294588738&4294967295,g=y+(d<<4&4294967295|d>>>28),d=_+(g^y^p)+S[8]+2272392833&4294967295,_=g+(d<<11&4294967295|d>>>21),d=p+(_^g^y)+S[11]+1839030562&4294967295,p=_+(d<<16&4294967295|d>>>16),d=y+(p^_^g)+S[14]+4259657740&4294967295,y=p+(d<<23&4294967295|d>>>9),d=g+(y^p^_)+S[1]+2763975236&4294967295,g=y+(d<<4&4294967295|d>>>28),d=_+(g^y^p)+S[4]+1272893353&4294967295,_=g+(d<<11&4294967295|d>>>21),d=p+(_^g^y)+S[7]+4139469664&4294967295,p=_+(d<<16&4294967295|d>>>16),d=y+(p^_^g)+S[10]+3200236656&4294967295,y=p+(d<<23&4294967295|d>>>9),d=g+(y^p^_)+S[13]+681279174&4294967295,g=y+(d<<4&4294967295|d>>>28),d=_+(g^y^p)+S[0]+3936430074&4294967295,_=g+(d<<11&4294967295|d>>>21),d=p+(_^g^y)+S[3]+3572445317&4294967295,p=_+(d<<16&4294967295|d>>>16),d=y+(p^_^g)+S[6]+76029189&4294967295,y=p+(d<<23&4294967295|d>>>9),d=g+(y^p^_)+S[9]+3654602809&4294967295,g=y+(d<<4&4294967295|d>>>28),d=_+(g^y^p)+S[12]+3873151461&4294967295,_=g+(d<<11&4294967295|d>>>21),d=p+(_^g^y)+S[15]+530742520&4294967295,p=_+(d<<16&4294967295|d>>>16),d=y+(p^_^g)+S[2]+3299628645&4294967295,y=p+(d<<23&4294967295|d>>>9),d=g+(p^(y|~_))+S[0]+4096336452&4294967295,g=y+(d<<6&4294967295|d>>>26),d=_+(y^(g|~p))+S[7]+1126891415&4294967295,_=g+(d<<10&4294967295|d>>>22),d=p+(g^(_|~y))+S[14]+2878612391&4294967295,p=_+(d<<15&4294967295|d>>>17),d=y+(_^(p|~g))+S[5]+4237533241&4294967295,y=p+(d<<21&4294967295|d>>>11),d=g+(p^(y|~_))+S[12]+1700485571&4294967295,g=y+(d<<6&4294967295|d>>>26),d=_+(y^(g|~p))+S[3]+2399980690&4294967295,_=g+(d<<10&4294967295|d>>>22),d=p+(g^(_|~y))+S[10]+4293915773&4294967295,p=_+(d<<15&4294967295|d>>>17),d=y+(_^(p|~g))+S[1]+2240044497&4294967295,y=p+(d<<21&4294967295|d>>>11),d=g+(p^(y|~_))+S[8]+1873313359&4294967295,g=y+(d<<6&4294967295|d>>>26),d=_+(y^(g|~p))+S[15]+4264355552&4294967295,_=g+(d<<10&4294967295|d>>>22),d=p+(g^(_|~y))+S[6]+2734768916&4294967295,p=_+(d<<15&4294967295|d>>>17),d=y+(_^(p|~g))+S[13]+1309151649&4294967295,y=p+(d<<21&4294967295|d>>>11),d=g+(p^(y|~_))+S[4]+4149444226&4294967295,g=y+(d<<6&4294967295|d>>>26),d=_+(y^(g|~p))+S[11]+3174756917&4294967295,_=g+(d<<10&4294967295|d>>>22),d=p+(g^(_|~y))+S[2]+718787259&4294967295,p=_+(d<<15&4294967295|d>>>17),d=y+(_^(p|~g))+S[9]+3951481745&4294967295,C.g[0]=C.g[0]+g&4294967295,C.g[1]=C.g[1]+(p+(d<<21&4294967295|d>>>11))&4294967295,C.g[2]=C.g[2]+p&4294967295,C.g[3]=C.g[3]+_&4294967295}r.prototype.u=function(C,g){g===void 0&&(g=C.length);for(var y=g-this.blockSize,S=this.B,p=this.h,_=0;_<g;){if(p==0)for(;_<=y;)i(this,C,_),_+=this.blockSize;if(typeof C=="string"){for(;_<g;)if(S[p++]=C.charCodeAt(_++),p==this.blockSize){i(this,S),p=0;break}}else for(;_<g;)if(S[p++]=C[_++],p==this.blockSize){i(this,S),p=0;break}}this.h=p,this.o+=g},r.prototype.v=function(){var C=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);C[0]=128;for(var g=1;g<C.length-8;++g)C[g]=0;var y=8*this.o;for(g=C.length-8;g<C.length;++g)C[g]=y&255,y/=256;for(this.u(C),C=Array(16),g=y=0;4>g;++g)for(var S=0;32>S;S+=8)C[y++]=this.g[g]>>>S&255;return C};function s(C,g){var y=a;return Object.prototype.hasOwnProperty.call(y,C)?y[C]:y[C]=g(C)}function o(C,g){this.h=g;for(var y=[],S=!0,p=C.length-1;0<=p;p--){var _=C[p]|0;S&&_==g||(y[p]=_,S=!1)}this.g=y}var a={};function l(C){return-128<=C&&128>C?s(C,function(g){return new o([g|0],0>g?-1:0)}):new o([C|0],0>C?-1:0)}function c(C){if(isNaN(C)||!isFinite(C))return h;if(0>C)return w(c(-C));for(var g=[],y=1,S=0;C>=y;S++)g[S]=C/y|0,y*=4294967296;return new o(g,0)}function u(C,g){if(C.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(C.charAt(0)=="-")return w(u(C.substring(1),g));if(0<=C.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),S=h,p=0;p<C.length;p+=8){var _=Math.min(8,C.length-p),d=parseInt(C.substring(p,p+_),g);8>_?(_=c(Math.pow(g,_)),S=S.j(_).add(c(d))):(S=S.j(y),S=S.add(c(d)))}return S}var h=l(0),f=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(E(this))return-w(this).m();for(var C=0,g=1,y=0;y<this.g.length;y++){var S=this.i(y);C+=(0<=S?S:4294967296+S)*g,g*=4294967296}return C},n.toString=function(C){if(C=C||10,2>C||36<C)throw Error("radix out of range: "+C);if(b(this))return"0";if(E(this))return"-"+w(this).toString(C);for(var g=c(Math.pow(C,6)),y=this,S="";;){var p=N(y,g).g;y=M(y,p.j(g));var _=((0<y.g.length?y.g[0]:y.h)>>>0).toString(C);if(y=p,b(y))return _+S;for(;6>_.length;)_="0"+_;S=_+S}},n.i=function(C){return 0>C?0:C<this.g.length?this.g[C]:this.h};function b(C){if(C.h!=0)return!1;for(var g=0;g<C.g.length;g++)if(C.g[g]!=0)return!1;return!0}function E(C){return C.h==-1}n.l=function(C){return C=M(this,C),E(C)?-1:b(C)?0:1};function w(C){for(var g=C.g.length,y=[],S=0;S<g;S++)y[S]=~C.g[S];return new o(y,~C.h).add(f)}n.abs=function(){return E(this)?w(this):this},n.add=function(C){for(var g=Math.max(this.g.length,C.g.length),y=[],S=0,p=0;p<=g;p++){var _=S+(this.i(p)&65535)+(C.i(p)&65535),d=(_>>>16)+(this.i(p)>>>16)+(C.i(p)>>>16);S=d>>>16,_&=65535,d&=65535,y[p]=d<<16|_}return new o(y,y[y.length-1]&-2147483648?-1:0)};function M(C,g){return C.add(w(g))}n.j=function(C){if(b(this)||b(C))return h;if(E(this))return E(C)?w(this).j(w(C)):w(w(this).j(C));if(E(C))return w(this.j(w(C)));if(0>this.l(v)&&0>C.l(v))return c(this.m()*C.m());for(var g=this.g.length+C.g.length,y=[],S=0;S<2*g;S++)y[S]=0;for(S=0;S<this.g.length;S++)for(var p=0;p<C.g.length;p++){var _=this.i(S)>>>16,d=this.i(S)&65535,m=C.i(p)>>>16,V=C.i(p)&65535;y[2*S+2*p]+=d*V,T(y,2*S+2*p),y[2*S+2*p+1]+=_*V,T(y,2*S+2*p+1),y[2*S+2*p+1]+=d*m,T(y,2*S+2*p+1),y[2*S+2*p+2]+=_*m,T(y,2*S+2*p+2)}for(S=0;S<g;S++)y[S]=y[2*S+1]<<16|y[2*S];for(S=g;S<2*g;S++)y[S]=0;return new o(y,0)};function T(C,g){for(;(C[g]&65535)!=C[g];)C[g+1]+=C[g]>>>16,C[g]&=65535,g++}function P(C,g){this.g=C,this.h=g}function N(C,g){if(b(g))throw Error("division by zero");if(b(C))return new P(h,h);if(E(C))return g=N(w(C),g),new P(w(g.g),w(g.h));if(E(g))return g=N(C,w(g)),new P(w(g.g),g.h);if(30<C.g.length){if(E(C)||E(g))throw Error("slowDivide_ only works with positive integers.");for(var y=f,S=g;0>=S.l(C);)y=W(y),S=W(S);var p=X(y,1),_=X(S,1);for(S=X(S,2),y=X(y,2);!b(S);){var d=_.add(S);0>=d.l(C)&&(p=p.add(y),_=d),S=X(S,1),y=X(y,1)}return g=M(C,p.j(g)),new P(p,g)}for(p=h;0<=C.l(g);){for(y=Math.max(1,Math.floor(C.m()/g.m())),S=Math.ceil(Math.log(y)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),_=c(y),d=_.j(g);E(d)||0<d.l(C);)y-=S,_=c(y),d=_.j(g);b(_)&&(_=f),p=p.add(_),C=M(C,d)}return new P(p,C)}n.A=function(C){return N(this,C).h},n.and=function(C){for(var g=Math.max(this.g.length,C.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)&C.i(S);return new o(y,this.h&C.h)},n.or=function(C){for(var g=Math.max(this.g.length,C.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)|C.i(S);return new o(y,this.h|C.h)},n.xor=function(C){for(var g=Math.max(this.g.length,C.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)^C.i(S);return new o(y,this.h^C.h)};function W(C){for(var g=C.g.length+1,y=[],S=0;S<g;S++)y[S]=C.i(S)<<1|C.i(S-1)>>>31;return new o(y,C.h)}function X(C,g){var y=g>>5;g%=32;for(var S=C.g.length-y,p=[],_=0;_<S;_++)p[_]=0<g?C.i(_+y)>>>g|C.i(_+y+1)<<32-g:C.i(_+y);return new o(p,C.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Bp=fb.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,oi=fb.Integer=o}).apply(typeof hb<"u"?hb:typeof self<"u"?self:typeof window<"u"?window:{});var ls=sf(BI(),1),wA=sf(Pg(),1);var UI="@firebase/firestore",qI="4.7.3";var mt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};mt.UNAUTHENTICATED=new mt(null);mt.GOOGLE_CREDENTIALS=new mt("google-credentials-uid");mt.FIRST_PARTY=new mt("first-party-uid");mt.MOCK_USER=new mt("mock-user");var bU="10.14.0";var ia=bU;function wU(n){ia=n}function EU(n){return SU(n,{depth:100})}var cs=new vc("@firebase/firestore");function Fl(){return cs.logLevel}function K(n,...e){if(cs.logLevel<=br.DEBUG){let t=e.map(G0);cs.debug(`Firestore (${ia}): ${n}`,...t)}}function xn(n,...e){if(cs.logLevel<=br.ERROR){let t=e.map(G0);cs.error(`Firestore (${ia}): ${n}`,...t)}}function $o(n,...e){if(cs.logLevel<=br.WARN){let t=e.map(G0);cs.warn(`Firestore (${ia}): ${n}`,...t)}}function G0(n){if(typeof n=="string")return n;try{return EU(n)}catch{return n}}function Z(n="Unexpected state"){let e=`FIRESTORE (${ia}) INTERNAL ASSERTION FAILED: `+n;throw xn(e),new Error(e)}function Ee(n,e){n||Z()}function ne(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},j=class extends SC{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var On=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ah=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},dv=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(mt.UNAUTHENTICATED))}shutdown(){}},hv=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},fv=class{constructor(e){this.authProvider=e,this.currentUser=mt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ee(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new On;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new On,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>A(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new On)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ee(typeof r.accessToken=="string"),new ah(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return Ee(e===null||typeof e=="string"),new mt(e)}},pv=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=mt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},mv=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new pv(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(mt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},gv=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},yv=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){Ee(this.tokenListener===void 0);let r=s=>{s.error!=null&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,K("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ee(typeof t.token=="string"),this.latestAppCheckToken=t.token,new gv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function TU(n){if(!n)return new dv;switch(n.type){case"firstParty":return new mv(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new j(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function IU(n){return _U(n)}var lh=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=IU(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ve(n,e){return n<e?-1:n>e?1:0}function us(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}var zI=-62135596800,jI=1e6,yt=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new j(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new j(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<zI)throw new j(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new j(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*jI);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/jI}_compareTo(e){return this.seconds===e.seconds?ve(this.nanoseconds,e.nanoseconds):ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-zI,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var ie=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new yt(0,0))}static max(){return new n(new yt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var $I="__name__",ch=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&Z(),r===void 0?r=e.length-t:r>e.length-t&&Z(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Ve=class n extends ch{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new j(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},AU=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Qt=class n extends ch{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return AU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===$I}static keyField(){return new n([$I])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new j(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new j(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new j(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new j(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var Y=class n{constructor(e){this.path=e}static fromPath(e){return new n(Ve.fromString(e))}static fromName(e){return new n(Ve.fromString(e).popFirst(5))}static empty(){return new n(Ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ve.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new Ve(e.slice()))}};var ql=-1;function RU(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ie.fromTimestamp(r===1e9?new yt(t+1,0):new yt(t,r));return new ds(i,Y.empty(),e)}function DU(n){return new ds(n.readTime,n.key,ql)}var ds=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(ie.min(),Y.empty(),ql)}static max(){return new n(ie.max(),Y.empty(),ql)}};function OU(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=Y.comparator(n.documentKey,e.documentKey),t!==0)?t:ve(n.largestBatchId,e.largestBatchId)}var MU="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",vv=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function rc(n){return A(this,null,function*(){if(n.code===R.FAILED_PRECONDITION&&n.message===MU)K("LocalStore","Unexpectedly lost primary lease");else throw n})}var F=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function xU(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ic(n){return n.name==="IndexedDbTransactionError"}var iH=15*1e3,sH=60*1e3;var EA=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})();var kU="remoteDocuments";var TA="owner";var IA="mutationQueues";var AA="mutations";var RA="documentMutations",PU="remoteDocumentsV14";var DA="remoteDocumentGlobal";var OA="targets";var MA="targetDocuments";var xA="targetGlobal",kA="collectionParents";var PA="clientMetadata";var NA="bundles";var FA="namedQueries";var NU="indexConfiguration";var FU="indexState";var LU="indexEntries";var LA="documentOverlays";var VU="globals";var BU=[IA,AA,RA,kU,OA,TA,xA,MA],UU=BU,qU=[...UU,PA],zU=[...qU,DA],jU=[...zU,kA],$U=[...jU,NA,FA],oH=[...$U,LA],GU=[IA,AA,RA,PU,OA,TA,xA,MA,PA,DA,kA,NA,FA,LA],WU=GU,HU=[...WU,NU,FU,LU];var aH=[...HU,VU];function GI(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Cs(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function VA(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ze=class n{constructor(e,t){this.comparator=e,this.root=t||Vl.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vl.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zo(this.root,e,this.comparator,!1)}getReverseIterator(){return new zo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zo(this.root,e,this.comparator,!0)}},zo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Vl=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Z();let t=this.left.check();if(t!==this.right.check())throw Z();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Sv=class{constructor(){this.size=0}get key(){throw Z()}get value(){throw Z()}get color(){throw Z()}get left(){throw Z()}get right(){throw Z()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Vl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Vl.EMPTY=new Sv;var Et=class n{constructor(e){this.comparator=e,this.data=new ze(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uh(this.data.getIterator())}getIteratorFrom(e){return new uh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},uh=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var yn=class n{constructor(e){this.fields=e,e.sort(Qt.comparator)}static empty(){return new n([])}unionWith(e){let t=new Et(Qt.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return us(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function KU(n){return Buffer.from(n,"base64").toString("binary")}function QU(n){return Buffer.from(n,"binary").toString("base64")}var Tt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=KU(e);return new n(t)}static fromUint8Array(e){let t=YU(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return QU(this.binaryString)}toUint8Array(){return XU(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Tt.EMPTY_BYTE_STRING=new Tt("");function YU(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function XU(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var JU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vr(n){if(Ee(!!n),typeof n=="string"){let e=0,t=JU.exec(n);if(Ee(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ne(n.seconds),t=Ne(n.nanos);return{seconds:e,nanos:t}}}function Ne(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ni(n){return typeof n=="string"?Tt.fromBase64String(n):Tt.fromUint8Array(n)}var BA="server_timestamp",UA="__type__",qA="__previous_value__",zA="__local_write_time__";function W0(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[UA])===null||t===void 0?void 0:t.stringValue)===BA}function ZU(n,e){let t={fields:{[UA]:{stringValue:BA},[zA]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&W0(e)&&(e=H0(e)),e&&(t.fields[qA]=e),{mapValue:t}}function H0(n){let e=n.mapValue.fields[qA];return W0(e)?H0(e):e}function zl(n){let e=Vr(n.mapValue.fields[zA].timestampValue);return new yt(e.seconds,e.nanos)}var Cv=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},_v="(default)",dh=class n{constructor(e,t){this.projectId=e,this.database=t||_v}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===_v}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function eq(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new j(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dh(n.options.projectId,e)}var K0=-1;function Vh(n){return n==null}function jl(n){return n===0&&1/n===-1/0}function tq(n){return typeof n=="number"&&Number.isInteger(n)&&!jl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Q0="__type__",jA="__max__",rh={mapValue:{fields:{__type__:{stringValue:jA}}}},Y0="__vector__",Wo="value";function hs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?W0(n)?4:WA(n)?9007199254740991:GA(n)?10:11:Z()}function Mn(n,e){if(n===e)return!0;let t=hs(n),r=hs(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zl(n).isEqual(zl(e));case 3:return nq(n,e);case 5:return n.stringValue===e.stringValue;case 6:return iq(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return rq(n,e);case 2:return sq(n,e);case 9:return us(n.arrayValue.values||[],e.arrayValue.values||[],Mn);case 10:case 11:return oq(n,e);case 9007199254740991:return!0;default:return Z()}}function nq(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Vr(n.timestampValue),r=Vr(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function rq(n,e){return Ne(n.geoPointValue.latitude)===Ne(e.geoPointValue.latitude)&&Ne(n.geoPointValue.longitude)===Ne(e.geoPointValue.longitude)}function iq(n,e){return Ni(n.bytesValue).isEqual(Ni(e.bytesValue))}function sq(n,e){if("integerValue"in n&&"integerValue"in e)return Ne(n.integerValue)===Ne(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ne(n.doubleValue),r=Ne(e.doubleValue);return t===r?jl(t)===jl(r):isNaN(t)&&isNaN(r)}return!1}function oq(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(GI(t)!==GI(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Mn(t[i],r[i])))return!1;return!0}function $l(n,e){return(n.values||[]).find(t=>Mn(t,e))!==void 0}function Ho(n,e){if(n===e)return 0;let t=hs(n),r=hs(e);if(t!==r)return ve(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ve(n.booleanValue,e.booleanValue);case 2:return aq(n,e);case 3:return WI(n.timestampValue,e.timestampValue);case 4:return WI(zl(n),zl(e));case 5:return ve(n.stringValue,e.stringValue);case 6:return uq(n.bytesValue,e.bytesValue);case 7:return lq(n.referenceValue,e.referenceValue);case 8:return cq(n.geoPointValue,e.geoPointValue);case 9:return $A(n.arrayValue,e.arrayValue);case 10:return dq(n.mapValue,e.mapValue);case 11:return hq(n.mapValue,e.mapValue);default:throw Z()}}function aq(n,e){let t=Ne(n.integerValue||n.doubleValue),r=Ne(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function WI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ve(n,e);let t=Vr(n),r=Vr(e),i=ve(t.seconds,r.seconds);return i!==0?i:ve(t.nanos,r.nanos)}function lq(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ve(t[i],r[i]);if(s!==0)return s}return ve(t.length,r.length)}function cq(n,e){let t=ve(Ne(n.latitude),Ne(e.latitude));return t!==0?t:ve(Ne(n.longitude),Ne(e.longitude))}function uq(n,e){let t=Ni(n),r=Ni(e);return t.compareTo(r)}function $A(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Ho(t[i],r[i]);if(s)return s}return ve(t.length,r.length)}function dq(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Wo])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Wo])===null||r===void 0?void 0:r.arrayValue,u=ve(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:$A(l,c)}function hq(n,e){if(n===rh.mapValue&&e===rh.mapValue)return 0;if(n===rh.mapValue)return 1;if(e===rh.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ve(r[o],s[o]);if(a!==0)return a;let l=Ho(t[r[o]],i[s[o]]);if(l!==0)return l}return ve(r.length,s.length)}function Ko(n){return X0(n)}function X0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?pq(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?fq(n.bytesValue):"referenceValue"in n?gq(n.referenceValue):"geoPointValue"in n?mq(n.geoPointValue):"arrayValue"in n?vq(n.arrayValue):"mapValue"in n?yq(n.mapValue):Z()}function fq(n){return Ni(n).toBase64()}function pq(n){let e=Vr(n);return`time(${e.seconds},${e.nanos})`}function mq(n){return`geo(${n.latitude},${n.longitude})`}function gq(n){return Y.fromName(n).toString()}function yq(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${X0(n.fields[i])}`;return t+"}"}function vq(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=X0(r);return e+"]"}function HI(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function bv(n){return!!n&&"integerValue"in n}function Sq(n){return!!n&&"doubleValue"in n}function Cq(n){return bv(n)||Sq(n)}function J0(n){return!!n&&"arrayValue"in n}function KI(n){return!!n&&"nullValue"in n}function QI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function sh(n){return!!n&&"mapValue"in n}function GA(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Q0])===null||t===void 0?void 0:t.stringValue)===Y0}function Bl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Cs(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Bl(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Bl(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function WA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===jA}var lH={mapValue:{fields:{[Q0]:{stringValue:Y0},[Wo]:{arrayValue:{}}}}};var Kt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!sh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Bl(t)}setAll(e){let t=Qt.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Bl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());sh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!sh(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Cs(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Bl(this.value))}};function HA(n){let e=[];return Cs(n.fields,(t,r)=>{let i=new Qt([t]);if(sh(r)){let o=HA(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new yn(e)}var kn=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,ie.min(),ie.min(),ie.min(),Kt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,ie.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,ie.min(),ie.min(),Kt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,ie.min(),ie.min(),Kt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ie.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function _q(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Ho(r,i):Z()}var Qo=class{constructor(e,t){this.position=e,this.inclusive=t}};function KA(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=Y.comparator(Y.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Ho(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function bq(n,e,t){let r=KA(n,e,t);return n.inclusive?r>=0:r>0}function wq(n,e,t){let r=KA(n,e,t);return n.inclusive?r<=0:r<0}function YI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Mn(r,i))return!1}return!0}var fs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Eq(n){return n.field.canonicalString()+n.dir}function Tq(n){return`${n.field.canonicalString()} (${n.dir})`}function Iq(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var hh=class{},tt=class n extends hh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ev(e,t,r):t==="array-contains"?new Av(e,r):t==="in"?new Rv(e,r):t==="not-in"?new Dv(e,r):t==="array-contains-any"?new Ov(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Tv(e,r):new Iv(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ho(t,this.value)):t!==null&&hs(this.value)===hs(t)&&this.matchesComparison(Ho(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Pn=class n extends hh{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return QA(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function QA(n){return n.op==="and"}function YA(n){return Aq(n)&&QA(n)}function Aq(n){for(let e of n.filters)if(e instanceof Pn)return!1;return!0}function wv(n){if(n instanceof tt)return n.field.canonicalString()+n.op.toString()+Ko(n.value);if(YA(n))return n.filters.map(e=>wv(e)).join(",");{let e=n.filters.map(t=>wv(t)).join(",");return`${n.op}(${e})`}}function XA(n,e){if(n instanceof tt)return Rq(n,e);if(n instanceof Pn)return Dq(n,e);Z()}function Rq(n,e){return e instanceof tt&&n.op===e.op&&n.field.isEqual(e.field)&&Mn(n.value,e.value)}function Dq(n,e){return e instanceof Pn&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&XA(i,e.filters[s]),!0):!1}function JA(n){return n instanceof tt?Mq(n):n instanceof Pn?Oq(n):"Filter"}function Oq(n){return n.op.toString()+" {"+n.getFilters().map(JA).join(" ,")+"}"}function Mq(n){return`${n.field.canonicalString()} ${n.op} ${Ko(n.value)}`}var Ev=class extends tt{constructor(e,t,r){super(e,t,r),this.key=Y.fromName(r.referenceValue)}matches(e){let t=Y.comparator(e.key,this.key);return this.matchesComparison(t)}},Tv=class extends tt{constructor(e,t){super(e,"in",t),this.keys=ZA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Iv=class extends tt{constructor(e,t){super(e,"not-in",t),this.keys=ZA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function ZA(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Y.fromName(r.referenceValue))}var Av=class extends tt{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return J0(t)&&$l(t.arrayValue,this.value)}},Rv=class extends tt{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&$l(this.value.arrayValue,t)}},Dv=class extends tt{constructor(e,t){super(e,"not-in",t)}matches(e){if($l(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!$l(this.value.arrayValue,t)}},Ov=class extends tt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!J0(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>$l(this.value.arrayValue,r))}};var Mv=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function XI(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Mv(n,e,t,r,i,s,o)}function Z0(n){let e=ne(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>wv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>Eq(r)).join(","),Vh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ko(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ko(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function xq(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>JA(t)).join(", ")}]`),Vh(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>Tq(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ko(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ko(t)).join(",")),`Target(${e})`}function eS(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Iq(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!XA(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!YI(n.startAt,e.startAt)?!1:YI(n.endAt,e.endAt)}function xv(n){return Y.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Fi=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function kq(n,e,t,r,i,s,o,a){return new Fi(n,e,t,r,i,s,o,a)}function Bh(n){return new Fi(n)}function Pq(n,e){return new Fi(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function JI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Nq(n){let e=new Et(Qt.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function Fq(n){return Y.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function eR(n){return n.collectionGroup!==null}function Gl(n){let e=ne(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";Nq(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new fs(s,r))}),t.has(Qt.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new fs(Qt.keyField(),r))}return e.memoizedNormalizedOrderBy}function ur(n){let e=ne(n);return e.memoizedTarget||(e.memoizedTarget=Lq(e,Gl(n))),e.memoizedTarget}function Lq(n,e){if(n.limitType==="F")return XI(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new fs(i.field,s)});let t=n.endAt?new Qo(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Qo(n.startAt.position,n.startAt.inclusive):null;return XI(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function tS(n,e){let t=n.filters.concat([e]);return new Fi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Vq(n,e){let t=n.explicitOrderBy.concat([e]);return new Fi(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function kv(n,e,t){return new Fi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Uh(n,e){return eS(ur(n),ur(e))&&n.limitType===e.limitType}function tR(n){return`${Z0(ur(n))}|lt:${n.limitType}`}function Uo(n){return`Query(target=${xq(ur(n))}; limitType=${n.limitType})`}function qh(n,e){return e.isFoundDocument()&&Bq(n,e)&&Uq(n,e)&&qq(n,e)&&zq(n,e)}function Bq(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):Y.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function Uq(n,e){for(let t of Gl(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function qq(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function zq(n,e){return!(n.startAt&&!wq(n.startAt,Gl(n),e)||n.endAt&&!bq(n.endAt,Gl(n),e))}function jq(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function nR(n){return(e,t)=>{let r=!1;for(let i of Gl(n)){let s=$q(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function $q(n,e,t){let r=n.field.isKeyField()?Y.comparator(e.key,t.key):_q(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Z()}}var Li=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Cs(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return VA(this.inner)}size(){return this.innerSize}};var Gq=new ze(Y.comparator);function Br(){return Gq}var rR=new ze(Y.comparator);function Ll(...n){let e=rR;for(let t of n)e=e.insert(t.key,t);return e}function Wq(){return Wl()}function iR(n){let e=rR;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function os(){return Wl()}function sR(){return Wl()}function Wl(){return new Li(n=>n.toString(),(n,e)=>n.isEqual(e))}var Hq=new ze(Y.comparator);function Kq(){return Hq}var Qq=new Et(Y.comparator);function de(...n){let e=Qq;for(let t of n)e=e.add(t);return e}var Yq=new Et(ve);function Xq(){return Yq}function nS(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jl(e)?"-0":e}}function oR(n){return{integerValue:""+n}}function Jq(n,e){return tq(e)?oR(e):nS(n,e)}var Yo=class{constructor(){this._=void 0}};function Zq(n,e,t){return n instanceof Xo?ZU(t,e):n instanceof ps?lR(n,e):n instanceof ms?cR(n,e):n4(n,e)}function e4(n,e,t){return n instanceof ps?lR(n,e):n instanceof ms?cR(n,e):t}function aR(n,e){return n instanceof Jo?Cq(e)?e:{integerValue:0}:null}function t4(n,e){return n instanceof ps&&e instanceof ps||n instanceof ms&&e instanceof ms?us(n.elements,e.elements,Mn):n instanceof Jo&&e instanceof Jo?Mn(n.operand,e.operand):n instanceof Xo&&e instanceof Xo}var Xo=class extends Yo{},ps=class extends Yo{constructor(e){super(),this.elements=e}};function lR(n,e){let t=uR(e);for(let r of n.elements)t.some(i=>Mn(i,r))||t.push(r);return{arrayValue:{values:t}}}var ms=class extends Yo{constructor(e){super(),this.elements=e}};function cR(n,e){let t=uR(e);for(let r of n.elements)t=t.filter(i=>!Mn(i,r));return{arrayValue:{values:t}}}var Jo=class extends Yo{constructor(e,t){super(),this.serializer=e,this.operand=t}};function n4(n,e){let t=aR(n,e),r=ZI(t)+ZI(n.operand);return bv(t)&&bv(n.operand)?oR(r):nS(n.serializer,r)}function ZI(n){return Ne(n.integerValue||n.doubleValue)}function uR(n){return J0(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function r4(n,e){return n.field.isEqual(e.field)&&t4(n.transform,e.transform)}function i4(n,e){return n===void 0&&e===void 0?!0:n&&e?us(n,e,(t,r)=>r4(t,r)):!1}var Pv=class{constructor(e,t){this.version=e,this.transformResults=t}},Lr=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function zh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Zo=class{};function dR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Hl(n.key,Lr.none()):new gs(n.key,n.data,Lr.none());{let t=n.data,r=Kt.empty(),i=new Et(Qt.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new fr(n.key,r,new yn(i.toArray()),Lr.none())}}function s4(n,e,t){n instanceof gs?a4(n,e,t):n instanceof fr?c4(n,e,t):d4(n,e,t)}function Ul(n,e,t,r){return n instanceof gs?l4(n,e,t,r):n instanceof fr?u4(n,e,t,r):h4(n,e,t)}function o4(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=aR(r.transform,i||null);s!=null&&(t===null&&(t=Kt.empty()),t.set(r.field,s))}return t||null}function eA(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!i4(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var gs=class extends Zo{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function a4(n,e,t){let r=n.value.clone(),i=fR(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function l4(n,e,t,r){if(!zh(n.precondition,e))return t;let i=n.value.clone(),s=pR(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var fr=class extends Zo{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function c4(n,e,t){if(!zh(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=fR(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(hR(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function u4(n,e,t,r){if(!zh(n.precondition,e))return t;let i=pR(n.fieldTransforms,r,e),s=e.data;return s.setAll(hR(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function hR(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function fR(n,e,t){let r=new Map;Ee(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,e4(o,a,t[i]))}return r}function pR(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,Zq(s,o,e))}return r}var Hl=class extends Zo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function d4(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function h4(n,e,t){return zh(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Nv=class extends Zo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Fv=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];s4(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ul(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Ul(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=sR();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=dR(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(ie.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),de())}isEqual(e){return this.batchId===e.batchId&&us(this.mutations,e.mutations,(t,r)=>eA(t,r))&&us(this.baseMutations,e.baseMutations,(t,r)=>eA(t,r))}},Lv=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Ee(e.mutations.length===r.length);let i=Kq(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Vv=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Bv=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var pt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(pt||{});function f4(n){switch(n){case R.OK:return Z();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return Z()}}function p4(n){return f4(n)&&n!==R.ABORTED}function oh(n){if(n===void 0)return xn("GRPC error has no .code"),R.UNKNOWN;switch(n){case pt.OK:return R.OK;case pt.CANCELLED:return R.CANCELLED;case pt.UNKNOWN:return R.UNKNOWN;case pt.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case pt.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case pt.INTERNAL:return R.INTERNAL;case pt.UNAVAILABLE:return R.UNAVAILABLE;case pt.UNAUTHENTICATED:return R.UNAUTHENTICATED;case pt.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case pt.NOT_FOUND:return R.NOT_FOUND;case pt.ALREADY_EXISTS:return R.ALREADY_EXISTS;case pt.PERMISSION_DENIED:return R.PERMISSION_DENIED;case pt.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case pt.ABORTED:return R.ABORTED;case pt.OUT_OF_RANGE:return R.OUT_OF_RANGE;case pt.UNIMPLEMENTED:return R.UNIMPLEMENTED;case pt.DATA_LOSS:return R.DATA_LOSS;default:return Z()}}var Uv=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var iv=null;function m4(){return new CU}var g4=new oi([4294967295,4294967295],0);function tA(n){let e=m4().encode(n),t=new Bp;return t.update(e),new Uint8Array(t.digest())}function nA(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new oi([t,r],0),a=new oi([i,s],0);return[o,a]}var qv=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new as(`Invalid padding: ${t}`);if(r<0)throw new as(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new as(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new as(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=oi.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(oi.fromNumber(r)));return i.compare(g4)===1&&(i=new oi([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=tA(e),[r,i]=nA(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=tA(e),[r,i]=nA(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},as=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var fh=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Kl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(ie.min(),i,new ze(ve),Br(),de())}},Kl=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,de(),de(),de())}};var Go=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},ph=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},mh=class{constructor(e,t,r=Tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},gh=class{constructor(){this.pendingResponses=0,this.documentChanges=iA(),this._resumeToken=Tt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=de(),t=de(),r=de();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Z()}}),new Kl(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=iA()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,Ee(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},y4="WatchChangeAggregator",zv=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Br(),this.pendingDocumentTargetMapping=rA(),this.pendingTargetResets=new ze(ve)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:Z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(xv(s))if(r===0){let o=new Y(s.path);this.removeDocumentFromTarget(t,o,kn.newNoDocument(o,ie.min()))}else Ee(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}iv?.notifyOnExistenceFilterMismatch(v4(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ni(r).toUint8Array()}catch(l){if(l instanceof Uv)return $o("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new qv(o,i,s)}catch(l){return l instanceof as?$o("BloomFilter error: ",l):$o("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&xv(a.target)){let l=new Y(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,kn.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=de();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new fh(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Br(),this.pendingDocumentTargetMapping=rA(),this.pendingTargetResets=new ze(ve),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new gh,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Et(ve),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||K(y4,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new gh),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function rA(){return new ze(Y.comparator)}function iA(){return new ze(Y.comparator)}function v4(n,e,t,r,i){var s,o,a,l,c,u;let h={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(h.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=f?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:v=>{var b;return(b=r?.mightContain(v))!==null&&b!==void 0?b:!1}}),h}var S4=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),C4=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),_4=(()=>{let n={};return n.and="AND",n.or="OR",n})();var jv=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function b4(n){let e=n.code===void 0?R.UNKNOWN:oh(n.code);return new j(e,n.message||"")}function $v(n,e){return n.useProto3Json||Vh(e)?e:{value:e}}function w4(n){let e;return typeof n=="object"?e=n.value:e=n,Vh(e)?null:e}function yh(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function E4(n){let e=Vr(n);return new yt(e.seconds,e.nanos)}function mR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function T4(n,e){return n.useProto3Json?(Ee(e===void 0||typeof e=="string"),Tt.fromBase64String(e||"")):(Ee(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Tt.fromUint8Array(e||new Uint8Array))}function I4(n,e){return yh(n,e.toTimestamp())}function dr(n){return Ee(!!n),ie.fromTimestamp(E4(n))}function rS(n,e){return Gv(n,e).canonicalString()}function Gv(n,e){let t=R4(n).child("documents");return e===void 0?t:t.child(e)}function gR(n){let e=Ve.fromString(n);return Ee(_R(e)),e}function Wv(n,e){return rS(n.databaseId,e.path)}function sv(n,e){let t=gR(e);if(t.get(1)!==n.databaseId.projectId)throw new j(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new j(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Y(vR(t))}function yR(n,e){return rS(n.databaseId,e)}function A4(n){let e=gR(n);return e.length===4?Ve.emptyPath():vR(e)}function Hv(n){return new Ve(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function R4(n){return new Ve(["projects",n.projectId,"databases",n.database])}function vR(n){return Ee(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function sA(n,e,t){return{name:Wv(n,e),fields:t.value.mapValue.fields}}function D4(n,e){let t;if("targetChange"in e){e.targetChange;let r=O4(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=T4(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&b4(o);t=new mh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=sv(n,r.document.name),s=dr(r.document.updateTime),o=r.document.createTime?dr(r.document.createTime):ie.min(),a=new Kt({mapValue:{fields:r.document.fields}}),l=kn.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Go(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=sv(n,r.document),s=r.readTime?dr(r.readTime):ie.min(),o=kn.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Go([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=sv(n,r.document),s=r.removedTargetIds||[];t=new Go([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Bv(i,s),a=r.targetId;t=new ph(a,o)}else return Z();return t}function O4(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:Z()}function M4(n){if(!("targetChange"in n))return ie.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?ie.min():dr(e.readTime)}function x4(n,e){let t;if(e instanceof gs)t={update:sA(n,e.key,e.value)};else if(e instanceof Hl)t={delete:Wv(n,e.key)};else if(e instanceof fr)t={update:sA(n,e.key,e.data),updateMask:u3(e.fieldMask)};else if(e instanceof Nv)t={verify:Wv(n,e.key)};else return Z();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>F4(n,r))),e.precondition.isNone||(t.currentDocument=k4(n,e.precondition)),t}function k4(n,e){return e.updateTime!==void 0?{updateTime:I4(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:Z()}function P4(n,e){let t=n.updateTime?dr(n.updateTime):dr(e);return t.isEqual(ie.min())&&(t=dr(e)),new Pv(t,n.transformResults||[])}function N4(n,e){return n&&n.length>0?(Ee(e!==void 0),n.map(t=>P4(t,e))):[]}function F4(n,e){let t=e.transform;if(t instanceof Xo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof ps)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof ms)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Jo)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw Z()}function L4(n,e){return{documents:[yR(n,e.path)]}}function V4(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=yR(n,i);let s=j4(e.filters);s&&(t.structuredQuery.where=s);let o=G4(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=$v(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=H4(e.startAt)),e.endAt&&(t.structuredQuery.endAt=K4(e.endAt)),{queryTarget:t,parent:i}}function B4(n){let e=A4(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Ee(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=$4(t.where));let o=[];t.orderBy&&(o=W4(t.orderBy));let a=null;t.limit&&(a=w4(t.limit));let l=null;t.startAt&&(l=Q4(t.startAt));let c=null;return t.endAt&&(c=Y4(t.endAt)),kq(e,i,o,s,a,"F",l,c)}function U4(n,e){let t=q4(e.purpose);return t==null?null:{"goog-listen-tags":t}}function q4(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Z()}}function z4(n,e){let t,r=e.target;if(xv(r)?t={documents:L4(n,r)}:t={query:V4(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=mR(n,e.resumeToken);let i=$v(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(ie.min())>0){t.readTime=yh(n,e.snapshotVersion.toTimestamp());let i=$v(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function j4(n){if(n.length!==0)return CR(Pn.create(n,"and"))}function $4(n){let e=SR(n);return e instanceof Pn&&YA(e)?e.getFilters():[e]}function SR(n){return n.unaryFilter!==void 0?a3(n):n.fieldFilter!==void 0?l3(n):n.compositeFilter!==void 0?c3(n):Z()}function G4(n){if(n.length!==0)return n.map(e=>r3(e))}function W4(n){return n.map(e=>i3(e))}function H4(n){return{before:n.inclusive,values:n.position}}function K4(n){return{before:!n.inclusive,values:n.position}}function Q4(n){let e=!!n.before,t=n.values||[];return new Qo(t,e)}function Y4(n){let e=!n.before,t=n.values||[];return new Qo(t,e)}function X4(n){return S4[n]}function J4(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function Z4(n){return C4[n]}function e3(n){return _4[n]}function t3(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Z();default:return Z()}}function n3(n){switch(n){case"AND":return"and";case"OR":return"or";default:return Z()}}function qo(n){return{fieldPath:n.canonicalString()}}function jo(n){return Qt.fromServerFormat(n.fieldPath)}function r3(n){return{field:qo(n.field),direction:X4(n.dir)}}function i3(n){return new fs(jo(n.field),J4(n.direction))}function CR(n){return n instanceof tt?o3(n):n instanceof Pn?s3(n):Z()}function s3(n){let e=n.getFilters().map(t=>CR(t));return e.length===1?e[0]:{compositeFilter:{op:e3(n.op),filters:e}}}function o3(n){if(n.op==="=="){if(QI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NAN"}};if(KI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(QI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NOT_NAN"}};if(KI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qo(n.field),op:Z4(n.op),value:n.value}}}function a3(n){switch(n.unaryFilter.op){case"IS_NAN":let e=jo(n.unaryFilter.field);return tt.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=jo(n.unaryFilter.field);return tt.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=jo(n.unaryFilter.field);return tt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=jo(n.unaryFilter.field);return tt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Z();default:return Z()}}function l3(n){return tt.create(jo(n.fieldFilter.field),t3(n.fieldFilter.op),n.fieldFilter.value)}function c3(n){return Pn.create(n.compositeFilter.filters.map(e=>SR(e)),n3(n.compositeFilter.op))}function u3(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _R(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ql=class n{constructor(e,t,r,i,s=ie.min(),o=ie.min(),a=Tt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Kv=class{constructor(e){this.remoteSerializer=e}};function d3(n){let e=B4({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?kv(e,e.limit,"L"):e}function h3(n){return{name:n.name,query:d3(n.bundledQuery),readTime:dr(n.readTime)}}function f3(n){return{id:n.id,version:n.version,createTime:dr(n.createTime)}}var p3=5,m3=10,g3=13,ov=15,y3=20,v3=25,S3=30,C3=37,_3=45,b3=50,w3=53,E3=55,T3=60,I3=2,vh=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,p3);else if("booleanValue"in e)this.writeValueTypeLabel(t,m3),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,ov),t.writeNumber(Ne(e.integerValue));else if("doubleValue"in e){let r=Ne(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,g3):(this.writeValueTypeLabel(t,ov),jl(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,y3),typeof r=="string"&&(r=Vr(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,S3),t.writeBytes(Ni(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,_3),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?WA(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):GA(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):Z()}writeIndexString(e,t){this.writeValueTypeLabel(t,v3),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,E3);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,w3);let o=Wo,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,ov),t.writeNumber(Ne(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,b3);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,C3),Y.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,T3),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(I3)}};vh.INSTANCE=new vh;var Qv=class{constructor(){this.collectionParentIndex=new Yv}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}deleteAllFieldIndexes(e){return F.resolve()}createTargetIndexes(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(ds.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(ds.min())}updateCollectionGroup(e,t,r){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}},Yv=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Et(Ve.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Et(Ve.comparator)).toArray()}};var cH=new Uint8Array(0);var av=2,Yl=class n{constructor(e){this.lastId=e}next(){return this.lastId+=av,this.lastId}static forTargetCache(){return new n(2-av)}static forSyncEngine(){return new n(1-av)}};var bR=-1,wR=40*1024*1024,cr=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};cr.DEFAULT_COLLECTION_PERCENTILE=10;cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;cr.DEFAULT=new cr(wR,cr.DEFAULT_COLLECTION_PERCENTILE,cr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);cr.DISABLED=new cr(bR,0,0);var oA=1*1024*1024,uH=1*60*1e3,dH=5*60*1e3;var Xv=class{constructor(){this.changes=new Li(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,kn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?F.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Jv=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Zv=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ul(r.mutation,i,yn.empty(),yt.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,de()).next(()=>r))}getLocalViewOfDocuments(e,t,r=de()){let i=os();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ll();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=os();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,de()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Br(),o=Wl(),a=Wq();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof fr)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Ul(u.mutation,c,u.mutation.getFieldMask(),yt.now())):o.set(c.key,yn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var h;return a.set(c,new Jv(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Wl(),i=new ze((o,a)=>o-a),s=de();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||yn.empty();u=a.applyToLocalView(c,u),r.set(l,u);let h=(i.get(a.batchId)||de()).add(l);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,h=sR();u.forEach(f=>{if(!s.has(f)){let v=dR(t.get(f),r.get(f));v!==null&&h.set(f,v),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return F.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return Fq(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):eR(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):F.resolve(os()),a=ql,l=s;return o.next(c=>F.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?F.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,de())).next(u=>({batchId:a,changes:iR(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Y(t)).next(r=>{let i=Ll();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ll();return this.indexManager.getCollectionParents(e,s).next(a=>F.forEach(a,l=>{let c=Pq(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,kn.newInvalidDocument(u)))});let a=Ll();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Ul(u.mutation,c,yn.empty(),yt.now()),qh(t,c)&&(a=a.insert(l,c))}),a})}};var e0=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return F.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,f3(t)),F.resolve()}getNamedQuery(e,t){return F.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,h3(t)),F.resolve()}};var t0=class{constructor(){this.overlays=new ze(Y.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){let r=os();return F.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),F.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),F.resolve()}getOverlaysForCollection(e,t,r){let i=os(),s=t.length+1,o=new Y(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return F.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ze((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=os(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let a=os(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,f)=>a.set(h,f)),!(a.size()>=i)););return F.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Vv(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=de(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var n0=class{constructor(){this.sessionToken=Tt.EMPTY_BYTE_STRING}getSessionToken(e){return F.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,F.resolve()}};var Xl=class{constructor(){this.refsByKey=new Et(et.compareByKey),this.refsByTarget=new Et(et.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new et(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new et(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new Y(new Ve([])),r=new et(t,e),i=new et(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new Y(new Ve([])),r=new et(t,e),i=new et(t,e+1),s=de();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new et(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},et=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return Y.comparator(e.key,t.key)||ve(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ve(e.targetOrBatchId,t.targetOrBatchId)||Y.comparator(e.key,t.key)}};var r0=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Et(et.compareByKey)}checkEmpty(e){return F.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Fv(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new et(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return F.resolve(o)}lookupMutationBatch(e,t){return F.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return F.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(this.mutationQueue.length===0?K0:this.nextBatchId-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new et(t,0),i=new et(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),F.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Et(ve);return t.forEach(i=>{let s=new et(i,0),o=new et(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),F.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;Y.isDocumentKey(s)||(s=s.child(""));let o=new et(new Y(s),0),a=new Et(ve);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),F.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");Ee(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return F.forEach(t.mutations,s=>{let o=new et(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new et(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return F.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function A3(){return new ze(Y.comparator)}var i0=class{constructor(e){this.sizer=e,this.docs=A3(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return F.resolve(r?r.document.mutableCopy():kn.newInvalidDocument(t))}getEntries(e,t){let r=Br();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():kn.newInvalidDocument(i))}),F.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Br(),o=t.path,a=new Y(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||OU(DU(u),r)<=0||!i.has(u.key)&&!qh(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return F.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Z()}forEachDocumentKey(e,t){return F.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new s0(this)}getSize(e){return F.resolve(this.size)}};function R3(n){return new i0(n)}var s0=class extends Xv{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),F.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var o0=class{constructor(e){this.persistence=e,this.targets=new Li(t=>Z0(t),eS),this.lastRemoteSnapshotVersion=ie.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Xl,this.targetCount=0,this.targetIdGenerator=Yl.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),F.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Yl(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.saveTargetData(t),F.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,F.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),F.waitFor(s).next(()=>i)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return F.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),F.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),F.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),F.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return F.resolve(r)}containsKey(e,t){return F.resolve(this.references.containsKey(t))}};var D3="MemoryPersistence",a0=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new EA(0),this._started=!1,this._started=!0,this.globalsCache=new n0,this.referenceDelegate=e(this),this.targetCache=new o0(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Qv,this.remoteDocumentCache=R3(r),this.serializer=new Kv(t),this.bundleCache=new e0(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new t0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new r0(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){K(D3,"Starting transaction:",e);let i=new l0(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return F.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},l0=class extends vv{constructor(e){super(),this.currentSequenceNumber=e}},c0=class n{constructor(e){this.persistence=e,this.localViewReferences=new Xl,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Z()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),F.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),F.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.orphanedDocuments,i=>{let s=Y.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,ie.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return F.or([()=>F.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var hH=30*60*1e3;function O3(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var iS="LocalStore",M3=5*60*1e6,u0=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new ze(ve),this.targetIdByTarget=new Li(s=>Z0(s),eS),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Zv(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function x3(n,e,t,r){return new u0(n,e,t,r)}function ER(n,e){return A(this,null,function*(){let t=ne(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=de();for(let u of s){a.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}for(let u of o){l.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function k3(n,e){let t=ne(n),r=yt.now(),i=e.reduce((a,l)=>a.add(l.key),de()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Br(),c=de();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((h,f)=>{f.isValidDocument()||(c=c.add(h))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let h=[];for(let f of e){let v=o4(f,s.get(f.key).overlayedDocument);v!=null&&h.push(new fr(f.key,v,HA(v.value.mapValue),Lr.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,h,e)}).next(u=>{o=u;let h=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,h)})}).then(()=>({batchId:o.batchId,changes:iR(s)}))}function P3(n,e){let t=ne(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return $3(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,N3(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function N3(n){let e=de();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function F3(n,e){let t=ne(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(Ee(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function TR(n){let e=ne(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function L3(n,e){let t=ne(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,h)=>{let f=i.get(h);if(!f)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,h)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?v=v.withResumeToken(Tt.EMPTY_BYTE_STRING,ie.min()).withLastLimboFreeSnapshotVersion(ie.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(h,v),B3(f,v,u)&&a.push(t.targetCache.updateTargetData(s,v))});let l=Br(),c=de();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(V3(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(ie.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(h=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return F.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function V3(n,e,t){let r=de(),i=de();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Br();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(ie.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):K(iS,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function B3(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=M3?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function U3(n,e){return A(this,null,function*(){let t=ne(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>F.forEach(e,i=>F.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>F.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(ic(r))K(iS,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function q3(n,e){let t=ne(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=K0),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function z3(n,e){let t=ne(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,F.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new Ql(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function j3(n,e,t){let r=ne(n),i=r.targetIdByTarget.get(t);return i!==void 0?F.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function d0(n,e,t){return A(this,null,function*(){let r=ne(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(ic(o))K(iS,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function IR(n,e,t){let r=ne(n),i=ie.min(),s=de();return r.persistence.runTransaction("Execute query","readwrite",o=>j3(r,o,ur(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:ie.min(),t?s:de())).next(a=>(G3(r,jq(e),a),{documents:a,remoteKeys:s})))}function $3(n,e,t,r){let i=t.batch,s=i.keys(),o=F.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);Ee(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function G3(n,e,t){let r=n.collectionGroupReadTime.get(e)||ie.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}var h0=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var W3=100;function H3(){return vC()?8:xU(yC())>0?6:4}var f0=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=W3,this.relativeIndexReadCostPerDocument=H3()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new h0;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Fl()<=br.DEBUG&&K("QueryEngine","SDK will not create cache indexes for query:",Uo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),F.resolve()):(Fl()<=br.DEBUG&&K("QueryEngine","Query:",Uo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Fl()<=br.DEBUG&&K("QueryEngine","The SDK decides to create cache indexes for query:",Uo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ur(t))):F.resolve())}performQueryUsingIndex(e,t){if(JI(t))return F.resolve(null);let r=ur(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=kv(t,null,"F"),r=ur(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=de(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,kv(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return JI(t)||i.isEqual(ie.min())?F.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?F.resolve(null):(Fl()<=br.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Uo(t)),this.appendRemainingResults(e,o,t,RU(i,ql)).next(a=>a))})}applyQuery(e,t){let r=new Et(nR(e));return t.forEach((i,s)=>{qh(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Fl()<=br.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",Uo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,ds.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Sh=class{constructor(){this.activeTargetIds=Xq()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var p0=class{constructor(){this.localState=new Sh,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Sh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var m0=class{addCallback(e){}shutdown(){}};var g0=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var ih=null;function K3(){return 268435456+Math.round(2147483648*Math.random())}function lv(){return ih===null?ih=K3():ih++,"0x"+ih.toString(16)}function Q3(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var Y3="1.9.1",kt="GrpcConnection",X3=`gl-node/${process.versions.node} fire/${ia} grpc/${Y3}`;function cv(n,e,t,r){Ee(e===null||e.type==="OAuth");let i=new ls.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",X3),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var y0=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){K(kt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?ls.credentials.createSsl():ls.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=lv(),a=this.ensureActiveStub(),l=cv(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return Q3(u=>(K(kt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(h,f)=>{h?(K(kt,`RPC '${e}' ${o} failed with error:`,h),u(new j(oh(h.code),h.message))):(K(kt,`RPC '${e}' ${o} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=lv(),l=[],c=new On;K(kt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),h=cv(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),v=u[e](f,h),b=!1;return v.on("data",E=>{K(kt,`RPC ${e} ${a} received result:`,E),l.push(E),o!==void 0&&l.length===o&&(b=!0,c.resolve(l))}),v.on("end",()=>{K(kt,`RPC '${e}' ${a} completed.`),b||(b=!0,c.resolve(l))}),v.on("error",E=>{K(kt,`RPC '${e}' ${a} failed with error:`,E);let w=oh(E.code);c.reject(new j(w,E.message))}),c.promise}openStream(e,t,r){let i=lv(),s=this.ensureActiveStub(),o=cv(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),a.end())},u=new g0({sendFn:f=>{if(l)K(kt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{K(kt,`RPC '${e}' stream ${i} sending:`,f);try{a.write(f)}catch(v){throw xn("Failure sending:",f),xn("Error:",v),v}}},closeFn:()=>{K(kt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),h=!1;return a.on("data",f=>{l||(K(kt,`RPC '${e}' stream ${i} received:`,f),h||(u.callOnConnected(),h=!0),u.callOnMessage(f))}),a.on("end",()=>{K(kt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",f=>{if(!l){$o(kt,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let v=oh(f.code);c(new j(v,f.message))}}),K(kt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},AR={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},J3={nested:AR},Z3=Object.freeze({__proto__:null,nested:AR,default:J3});var ez={longs:String,enums:String,defaults:!0,oneofs:!1};function tz(){let n=wA.fromJSON(Z3,ez);return ls.loadPackageDefinition(n)}function nz(n){let e=tz();return new y0(e,n)}function rz(){return new m0}function jh(n){return new jv(n,!1)}var iz="ExponentialBackoff",sz=1e3,oz=1.5,az=60*1e3,Ch=class{constructor(e,t,r=sz,i=oz,s=az){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&K(iz,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var aA="PersistentStream",lz=60*1e3,cz=10*1e3,_h=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Ch(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return A(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,lz,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return A(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return A(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(xn(t.toString()),xn("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new j(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,cz,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>A(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return K(aA,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(K(aA,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},v0=class extends _h{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=D4(this.serializer,e),r=M4(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Hv(this.serializer),t.addTarget=z4(this.serializer,e);let r=U4(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Hv(this.serializer),t.removeTarget=e,this.sendRequest(t)}},S0=class extends _h{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return Ee(!!e.streamToken),this.lastStreamToken=e.streamToken,Ee(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){Ee(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=N4(e.writeResults,e.commitTime),r=dr(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=Hv(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>x4(this.serializer,r))};this.sendRequest(t)}};var C0=class{},_0=class extends C0{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new j(R.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,Gv(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new j(R.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,Gv(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new j(R.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function uz(n,e,t,r){return new _0(n,e,t,r)}function dz(n,e,t){let r=ne(n);return r.verifyInitialized(),new S0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function hz(n,e,t){let r=ne(n);return r.verifyInitialized(),new v0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var fz="OnlineStateTracker",lA=1,cA=10*1e3,b0=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",cA,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${cA/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=lA&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${lA} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(xn(t),this.shouldWarnClientIsOffline=!1):K(fz,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var ys="RemoteStore",pz=10,w0=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>A(this,null,function*(){_s(this)&&(K(ys,"Restarting streams for network reachability change."),yield Oz(this))}))}),this.onlineStateTracker=new b0(r,i)}};function mz(n,e,t,r,i){return new w0(n,e,t,r,i)}function $h(n){return A(this,null,function*(){if(_s(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function sc(n){return A(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function gz(n){return A(this,null,function*(){let e=ne(n);K(ys,"RemoteStore shutting down."),e.offlineCauses.add(5),yield sc(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function RR(n,e){let t=ne(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),lS(t)?aS(t):sa(t).isOpen()&&oS(t,e))}function sS(n,e){let t=ne(n),r=sa(t);t.listenTargets.delete(e),r.isOpen()&&DR(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():_s(t)&&t.onlineStateTracker.set("Unknown"))}function oS(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ie.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}sa(n).watch(e)}function DR(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),sa(n).unwatch(e)}function aS(n){n.watchChangeAggregator=new zv({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),sa(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function lS(n){return _s(n)&&!sa(n).isStarted()&&n.listenTargets.size>0}function _s(n){return ne(n).offlineCauses.size===0}function OR(n){n.watchChangeAggregator=void 0}function yz(n){return A(this,null,function*(){n.onlineStateTracker.set("Online")})}function vz(n){return A(this,null,function*(){n.listenTargets.forEach((e,t)=>{oS(n,e)})})}function Sz(n,e){return A(this,null,function*(){OR(n),lS(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),aS(n)):n.onlineStateTracker.set("Unknown")})}function Cz(n,e,t){return A(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof mh&&e.state===2&&e.cause){try{yield bz(n,e)}catch(r){K(ys,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield bh(n,r)}return}if(e instanceof Go?n.watchChangeAggregator.handleDocumentChange(e):e instanceof ph?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(ie.min()))try{let r=yield TR(n.localStore);t.compareTo(r)>=0&&(yield _z(n,t))}catch(r){K(ys,"Failed to raise snapshot:",r),yield bh(n,r)}})}function bh(n,e,t){return A(this,null,function*(){if(ic(e))n.offlineCauses.add(1),yield sc(n),n.onlineStateTracker.set("Offline"),t||(t=()=>TR(n.localStore)),n.asyncQueue.enqueueRetryable(()=>A(this,null,function*(){K(ys,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield $h(n)}));else throw e})}function MR(n,e){return e().catch(t=>bh(n,t,e))}function _z(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Tt.EMPTY_BYTE_STRING,s.snapshotVersion)),DR(n,r);let o=new Ql(s.target,r,i,s.sequenceNumber);oS(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function bz(n,e){return A(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function Gh(n){return A(this,null,function*(){let e=ne(n),t=Bi(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:K0;for(;wz(e);)try{let i=yield q3(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,Ez(e,i)}catch(i){yield bh(e,i)}xR(e)&&kR(e)})}function wz(n){return _s(n)&&n.writePipeline.length<pz}function Ez(n,e){n.writePipeline.push(e);let t=Bi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function xR(n){return _s(n)&&!Bi(n).isStarted()&&n.writePipeline.length>0}function kR(n){Bi(n).start()}function Tz(n){return A(this,null,function*(){Bi(n).writeHandshake()})}function Iz(n){return A(this,null,function*(){let e=Bi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function Az(n,e,t){return A(this,null,function*(){let r=n.writePipeline.shift(),i=Lv.from(r,e,t);yield MR(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Gh(n)})}function Rz(n,e){return A(this,null,function*(){e&&Bi(n).handshakeComplete&&(yield Dz(n,e)),xR(n)&&kR(n)})}function Dz(n,e){return A(this,null,function*(){if(p4(e.code)){let t=n.writePipeline.shift();Bi(n).inhibitBackoff(),yield MR(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield Gh(n)}})}function Oz(n){return A(this,null,function*(){let e=ne(n);e.offlineCauses.add(4),yield sc(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield $h(e)})}function uA(n,e){return A(this,null,function*(){let t=ne(n);t.asyncQueue.verifyOperationInProgress(),K(ys,"RemoteStore received new credentials");let r=_s(t);t.offlineCauses.add(3),yield sc(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield $h(t)})}function Mz(n,e){return A(this,null,function*(){let t=ne(n);e?(t.offlineCauses.delete(2),yield $h(t)):e||(t.offlineCauses.add(2),yield sc(t),t.onlineStateTracker.set("Unknown"))})}function sa(n){return n.watchStream||(n.watchStream=hz(n.datastore,n.asyncQueue,{onConnected:yz.bind(null,n),onOpen:vz.bind(null,n),onClose:Sz.bind(null,n),onWatchChange:Cz.bind(null,n)}),n.onNetworkStatusChange.push(e=>A(this,null,function*(){e?(n.watchStream.inhibitBackoff(),lS(n)?aS(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),OR(n))}))),n.watchStream}function Bi(n){return n.writeStream||(n.writeStream=dz(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:Tz.bind(null,n),onClose:Rz.bind(null,n),onHandshakeComplete:Iz.bind(null,n),onMutationResult:Az.bind(null,n)}),n.onNetworkStatusChange.push(e=>A(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield Gh(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(K(ys,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var xz="AsyncQueue",E0=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new On,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new j(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function cS(n,e){if(xn(xz,`${e}: ${n}`),ic(n))return new j(R.UNAVAILABLE,`${e}: ${n}`);throw n}var wh=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||Y.comparator(t.key,r.key):this.comparator=(t,r)=>Y.comparator(t.key,r.key),this.keyedMap=Ll(),this.sortedSet=new ze(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Eh=class{constructor(){this.changeMap=new ze(Y.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):Z()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},ea=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,wh.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Uh(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var T0=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function kz(){return new I0}var I0=class{constructor(){this.queries=PR(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){Lz(this,new j(R.ABORTED,"Firestore shutting down"))}};function PR(){return new Li(n=>tR(n),Uh)}function NR(n,e){return A(this,null,function*(){let t=ne(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new T0,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=cS(o,`Initialization of query '${Uo(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&uS(t)})}function FR(n,e){return A(this,null,function*(){let t=ne(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Pz(n,e){let t=ne(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&uS(t)}function Nz(n,e,t){let r=ne(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function Fz(n,e){let t=ne(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&uS(t)}function Lz(n,e){let t=ne(n),r=t.queries;t.queries=PR(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function uS(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var LR=function(n){return n.Default="default",n.Cache="cache",n}(LR||{}),Th=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ea(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=ea.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==LR.Cache}};var A0=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=de(),i=de();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Ih=class{constructor(e){this.key=e}},Ah=class{constructor(e){this.key=e}},R0=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=de(),this.mutatedKeys=de(),this.docComparator=nR(e),this.documentSet=new wh(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Eh,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{let f=i.get(u),v=qh(this.query,h)?h:null,b=f?this.mutatedKeys.has(f.key):!1,E=v?v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations:!1,w=!1;f&&v?f.data.isEqual(v.data)?b!==E&&(r.track({type:3,doc:v}),w=!0):this.shouldWaitForSyncedDocument(f,v)||(r.track({type:2,doc:v}),w=!0,(l&&this.docComparator(v,l)>0||c&&this.docComparator(v,c)<0)&&(a=!0)):!f&&v?(r.track({type:0,doc:v}),w=!0):f&&!v&&(r.track({type:1,doc:f}),w=!0,(l||c)&&(a=!0)),w&&(v?(o=o.add(v),E?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((h,f)=>Vz(h.type,f.type)||this.docComparator(h.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new ea(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Eh,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=de(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Ah(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Ih(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=de();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ea.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function Vz(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return Z()}};return t(n)-t(e)}var dS="SyncEngine",D0=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},O0=class{constructor(e){this.key=e,this.receivedDocument=!1}},M0=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new Li(a=>tR(a),Uh),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new ze(Y.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Xl,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Yl.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function Bz(n,e,t,r,i,s,o){let a=new M0(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function Uz(n,e,t=!0){return A(this,null,function*(){let r=$R(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield VR(r,e,t,!0),i})}function qz(n,e){return A(this,null,function*(){let t=$R(n);yield VR(t,e,!0,!1)})}function VR(n,e,t,r){return A(this,null,function*(){let i=yield z3(n.localStore,ur(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield zz(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&RR(n.remoteStore,i),a})}function zz(n,e,t,r,i){return A(this,null,function*(){n.applyDocChanges=(h,f,v)=>Jz(n,h,f,v);let s=yield IR(n.localStore,e,!0),o=new R0(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Kl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);jR(n,t,c.limboChanges);let u=new D0(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function jz(n,e,t){return A(this,null,function*(){let r=ne(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Uh(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield d0(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&sS(r.remoteStore,i.targetId),x0(r,i.targetId)}).catch(rc))):(x0(r,i.targetId),yield d0(r.localStore,i.targetId,!0))})}function $z(n,e){return A(this,null,function*(){let t=ne(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),sS(t.remoteStore,r.targetId))})}function Gz(n,e,t){return A(this,null,function*(){let r=tj(n);try{let i=yield k3(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),Yz(r,i.batchId,t),yield oc(r,i.changes),yield Gh(r.remoteStore)}catch(i){let s=cS(i,"Failed to persist write");t.reject(s)}})}function BR(n,e){return A(this,null,function*(){let t=ne(n);try{let r=yield L3(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(Ee(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?Ee(o.receivedDocument):i.removedDocuments.size>0&&(Ee(o.receivedDocument),o.receivedDocument=!1))}),yield oc(t,r,e)}catch(r){yield rc(r)}})}function dA(n,e,t){let r=ne(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),Fz(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Wz(n,e,t){return A(this,null,function*(){let r=ne(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new ze(Y.comparator);o=o.insert(s,kn.newNoDocument(s,ie.min()));let a=de().add(s),l=new fh(ie.min(),new Map,new ze(ve),o,a);yield BR(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),hS(r)}else yield d0(r.localStore,e,!1).then(()=>x0(r,e,t)).catch(rc)})}function Hz(n,e){return A(this,null,function*(){let t=ne(n),r=e.batch.batchId;try{let i=yield P3(t.localStore,e);qR(t,r,null),UR(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield oc(t,i)}catch(i){yield rc(i)}})}function Kz(n,e,t){return A(this,null,function*(){let r=ne(n);try{let i=yield F3(r.localStore,e);qR(r,e,t),UR(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield oc(r,i)}catch(i){yield rc(i)}})}function UR(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function Qz(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new j(R.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function Yz(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new ze(ve)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function qR(n,e,t){let r=ne(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function x0(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||zR(n,i)})}function zR(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(sS(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),hS(n))}function jR(n,e,t){for(let r of t)r instanceof Ih?(n.limboDocumentRefs.addReference(r.key,e),Xz(n,r)):r instanceof Ah?(K(dS,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||zR(n,r.key)):Z()}function Xz(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(K(dS,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),hS(n))}function hS(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new Y(Ve.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new O0(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),RR(n.remoteStore,new Ql(ur(Bh(t.path)),r,"TargetPurposeLimboResolution",EA.INVALID))}}function oc(n,e,t){return A(this,null,function*(){let r=ne(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let h=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){i.push(c);let h=A0.fromSnapshot(l.targetId,c);s.push(h)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield U3(r.localStore,s))})}function Jz(n,e,t,r){return A(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield IR(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return jR(n,e.targetId,a.limboChanges),a.snapshot})}function Zz(n,e){return A(this,null,function*(){let t=ne(n);if(!t.currentUser.isEqual(e)){K(dS,"User change. New user:",e.toKey());let i=yield ER(t.localStore,e);t.currentUser=e,Qz(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield oc(t,i.affectedDocuments)}})}function ej(n,e){let t=ne(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return de().add(r.key);{let i=de(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function $R(n){let e=ne(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=BR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ej.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Wz.bind(null,e),e.syncEngineListener.onWatchChange=Pz.bind(null,e.eventManager),e.syncEngineListener.onWatchError=Nz.bind(null,e.eventManager),e}function tj(n){let e=ne(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Hz.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Kz.bind(null,e),e}var hA=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return A(this,null,function*(){this.serializer=jh(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return x3(this.persistence,new f0,t.initialUser,this.serializer)}createPersistence(t){return new a0(c0.factory,this.serializer)}createSharedClientState(t){return new p0}terminate(){return A(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var nj=(()=>{class n{initialize(t,r){return A(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>dA(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zz.bind(null,this.syncEngine),yield Mz(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return kz()}createDatastore(t){let r=jh(t.databaseInfo.databaseId),i=nz(t.databaseInfo);return uz(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return mz(this.localStore,this.datastore,t.asyncQueue,r=>dA(this.syncEngine,r,0),rz())}createSyncEngine(t,r){return Bz(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return A(this,null,function*(){var t,r;yield gz(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})();function GR(n,e,t){if(!t)throw new j(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function rj(n,e,t,r){if(e===!0&&r===!0)throw new j(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function fA(n){if(!Y.isDocumentKey(n))throw new j(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function pA(n){if(Y.isDocumentKey(n))throw new j(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ij(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Wh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=sj(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":Z()}function sj(n){return n.constructor?n.constructor.name:null}function hr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new j(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Wh(n);throw new j(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Rh=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):xn("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Vi="FirestoreClient",oj=100,aj=11,lj=20,cj=22,k0=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=mt.UNAUTHENTICATED,this.clientId=lh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>A(this,null,function*(){K(Vi,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(K(Vi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:oj}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new On;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>A(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=cS(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function uv(n,e){return A(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),K(Vi,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>A(this,null,function*(){r.isEqual(i)||(yield ER(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function mA(n,e){return A(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield dj(n);K(Vi,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>uA(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>uA(e.remoteStore,i)),n._onlineComponents=e})}function uj(n){return n.name==="FirebaseError"?n.code===R.FAILED_PRECONDITION||n.code===R.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===cj||n.code===lj||n.code===aj:!0}function dj(n){return A(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){K(Vi,"Using user provided OfflineComponentProvider");try{yield uv(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!uj(t))throw t;$o("Error using user provided cache. Falling back to memory cache: "+t),yield uv(n,new hA)}}else K(Vi,"Using default OfflineComponentProvider"),yield uv(n,new hA);return n._offlineComponents})}function WR(n){return A(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(K(Vi,"Using user provided OnlineComponentProvider"),yield mA(n,n._uninitializedComponentsProvider._online)):(K(Vi,"Using default OnlineComponentProvider"),yield mA(n,new nj))),n._onlineComponents})}function hj(n){return WR(n).then(e=>e.syncEngine)}function P0(n){return A(this,null,function*(){let e=yield WR(n),t=e.eventManager;return t.onListen=Uz.bind(null,e.syncEngine),t.onUnlisten=jz.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=qz.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=$z.bind(null,e.syncEngine),t})}function fj(n,e,t,r){let i=new Rh(r),s=new Th(e,i,t);return n.asyncQueue.enqueueAndForget(()=>A(this,null,function*(){let o=yield P0(n);return NR(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>A(this,null,function*(){let o=yield P0(n);return FR(o,s)}))}}function pj(n,e,t={}){let r=new On;return n.asyncQueue.enqueueAndForget(()=>A(this,null,function*(){let i=yield P0(n);return gj(i,n.asyncQueue,e,t,r)})),r.promise}function mj(n,e){let t=new On;return n.asyncQueue.enqueueAndForget(()=>A(this,null,function*(){let r=yield hj(n);return Gz(r,e,t)})),t.promise}function gj(n,e,t,r,i){let s=new Rh({next:a=>{s.mute(),e.enqueueAndForget(()=>FR(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new j(R.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new j(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Th(Bh(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return NR(n,o)}function yj(n,e){return n.timeoutSeconds===e.timeoutSeconds}function HR(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var vj="ComponentProvider",gA=new Map;function Sj(n){let e=gA.get(n);e&&(K(vj,"Removing Datastore"),gA.delete(n),e.terminate())}function Cj(n,e,t,r){return new Cv(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,HR(r.experimentalLongPollingOptions),r.useFetchStreams)}var KR="firestore.googleapis.com",yA=!0,vA=5,SA=30,_j=!0,Dh=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new j(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=KR,this.ssl=yA}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:yA;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=wR;else{if(e.cacheSizeBytes!==bR&&e.cacheSizeBytes<oA)throw new j(R.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${oA}`);this.cacheSizeBytes=e.cacheSizeBytes}rj("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=_j:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=HR((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),bj(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yj(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function bj(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new j(R.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<vA)throw new j(R.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${vA})`);if(n.timeoutSeconds>SA)throw new j(R.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${SA})`)}}var ta=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Dh({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new j(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new j(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Dh(e),e.credentials!==void 0&&(this._authCredentials=TU(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return A(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return Sj(this),Promise.resolve()}};function QR(n,e,t,r={}){var i;n=hr(n,ta);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==KR&&s.host!==o&&$o("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=mt.MOCK_USER;else{a=gC(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new j(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new mt(c)}n._authCredentials=new hv(new ah(a,l))}}var vs=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Pt=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Pi=class n extends vs{constructor(e,t,r){super(e,t,Bh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Pt(this.firestore,null,new Y(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function YR(n,e,...t){if(n=nn(n),GR("collection","path",e),n instanceof ta){let r=Ve.fromString(e,...t);return pA(r),new Pi(n,null,r)}else{if(!(n instanceof Pt)&&!(n instanceof Pi))throw new j(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Ve.fromString(e,...t));return pA(r),new Pi(n.firestore,null,r)}}function fS(n,e,...t){if(n=nn(n),arguments.length===1&&(e=lh.newId()),GR("doc","path",e),n instanceof ta){let r=Ve.fromString(e,...t);return fA(r),new Pt(n,null,new Y(r))}else{if(!(n instanceof Pt)&&!(n instanceof Pi))throw new j(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Ve.fromString(e,...t));return fA(r),new Pt(n.firestore,n instanceof Pi?n.converter:null,new Y(r))}}var wj="AsyncQueue",Oh=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Ch(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new On;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return A(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(ic(e))K(wj,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=Ej(r);throw xn("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=E0.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&Z()}verifyOperationInProgress(){}drain(){return A(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function Ej(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var Ur=class extends ta{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Oh,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return A(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Oh(e),this._firestoreClient=void 0,yield e}})}};function Hh(n,e){let t=typeof n=="object"?n:va(),r=typeof n=="string"?n:e||_v,i=Af(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=mC("firestore");s&&QR(i,...s)}return i}function pS(n){if(n._terminated)throw new j(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Tj(n),n._firestoreClient}function Tj(n){var e,t,r;let i=n._freezeSettings(),s=Cj(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new k0(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&Ij(n._componentsProvider))}function Ij(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function Aj(n,e=!0){wU(_C),ya(new ga("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ur(new fv(t.getProvider("auth-internal")),new yv(t.getProvider("app-check-internal")),eq(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Ot(UI,qI,n),Ot(UI,qI,"esm2017")}var Jl=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Tt.fromBase64String(e))}catch(t){throw new j(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var na=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new j(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Zl=class{constructor(e){this._methodName=e}};var ec=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new j(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new j(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ve(this._lat,e._lat)||ve(this._long,e._long)}};var tc=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return O3(this._values,e._values)}};var Rj=/^__.*__$/,N0=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new fr(e,this.data,this.fieldMask,t,this.fieldTransforms):new gs(e,this.data,t,this.fieldTransforms)}},Mh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new fr(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function XR(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Z()}}var F0=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return kh(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(XR(this.dataSource)&&Rj.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},L0=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||jh(e)}createContext(e,t,r,i=!1){return new F0({dataSource:e,methodName:t,targetDoc:r,path:Qt.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function mS(n){let e=n._freezeSettings(),t=jh(n._databaseId);return new L0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Dj(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);gS("Data must be an object, but it was:",o,r);let a=JR(r,o),l,c;if(s.merge)l=new yn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let h of s.mergeFields){let f=V0(e,h,t);if(!o.contains(f))throw new j(R.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);eD(u,f)||u.push(f)}l=new yn(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new N0(new Kt(a),l,c)}var xh=class n extends Zl{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function Oj(n,e,t,r){let i=n.createContext(1,e,t);gS("Data must be an object, but it was:",i,r);let s=[],o=Kt.empty();Cs(r,(l,c)=>{let u=yS(e,l,t);c=nn(c);let h=i.childContextForFieldPath(u);if(c instanceof xh)s.push(u);else{let f=ac(c,h);f!=null&&(s.push(u),o.set(u,f))}});let a=new yn(s);return new Mh(o,a,i.fieldTransforms)}function Mj(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[V0(e,r,t)],l=[i];if(s.length%2!==0)throw new j(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(V0(e,s[f])),l.push(s[f+1]);let c=[],u=Kt.empty();for(let f=a.length-1;f>=0;--f)if(!eD(c,a[f])){let v=a[f],b=l[f];b=nn(b);let E=o.childContextForFieldPath(v);if(b instanceof xh)c.push(v);else{let w=ac(b,E);w!=null&&(c.push(v),u.set(v,w))}}let h=new yn(c);return new Mh(u,h,o.fieldTransforms)}function xj(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return ac(t,i)}function ac(n,e){if(n=nn(n),ZR(n))return gS("Unsupported field value:",e,n),JR(n,e);if(n instanceof Zl)return Pj(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return kj(n,e)}else return Nj(n,e)}function JR(n,e){let t={};return VA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Cs(n,(r,i)=>{let s=ac(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function kj(n,e){let t=[],r=0;for(let i of n){let s=ac(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function Pj(n,e){if(!XR(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function Nj(n,e){if(n=nn(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Jq(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=yt.fromDate(n);return{timestampValue:yh(e.serializer,t)}}else if(n instanceof yt){let t=new yt(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:yh(e.serializer,t)}}else{if(n instanceof ec)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Jl)return{bytesValue:mR(e.serializer,n._byteString)};if(n instanceof Pt){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:rS(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof tc)return Fj(n,e);throw e.createError(`Unsupported field value: ${Wh(n)}`)}}}function Fj(n,e){return{mapValue:{fields:{[Q0]:{stringValue:Y0},[Wo]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return nS(e.serializer,r)})}}}}}}function ZR(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof yt)&&!(n instanceof ec)&&!(n instanceof Jl)&&!(n instanceof Pt)&&!(n instanceof Zl)&&!(n instanceof tc)}function gS(n,e,t){if(!ZR(t)||!ij(t)){let r=Wh(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function V0(n,e,t){if(e=nn(e),e instanceof na)return e._internalPath;if(typeof e=="string")return yS(n,e);throw kh("Field path arguments must be of type string or ",n,!1,void 0,t)}var Lj=new RegExp("[~\\*/\\[\\]]");function yS(n,e,t){if(e.search(Lj)>=0)throw kh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new na(...e.split("."))._internalPath}catch{throw kh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function kh(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new j(R.INVALID_ARGUMENT,a+n+l)}function eD(n,e){return n.some(t=>t.isEqual(e))}var Ph=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Pt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new B0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(vS("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},B0=class extends Ph{data(){return super.data()}};function vS(n,e){return typeof e=="string"?yS(n,e):e instanceof na?e._internalPath:e._delegate._internalPath}function Vj(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new j(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var nc=class{},Nh=class extends nc{};function tD(n,e,...t){let r=[];e instanceof nc&&r.push(e),r=r.concat(t),$j(r);for(let i of r)n=i._apply(n);return n}var U0=class n extends Nh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return rD(e._query,t),new vs(e.firestore,e.converter,tS(e._query,t))}_parse(e){let t=mS(e.firestore);return Bj(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};var q0=class n extends nc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Pn.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(zj(e._query,t),new vs(e.firestore,e.converter,tS(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var z0=class n extends Nh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=Uj(e._query,this._field,this._direction);return new vs(e.firestore,e.converter,Vq(e._query,t))}};function nD(n,e="asc"){let t=e,r=vS("orderBy",n);return z0._create(r,t)}function Bj(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new j(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){_A(o,s);let c=[];for(let u of o)c.push(CA(r,n,u));a={arrayValue:{values:c}}}else a=CA(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&_A(o,s),a=xj(t,e,o,s==="in"||s==="not-in");return tt.create(i,s,a)}function Uj(n,e,t){if(n.startAt!==null)throw new j(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new j(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fs(e,t)}function CA(n,e,t){if(t=nn(t),typeof t=="string"){if(t==="")throw new j(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eR(e)&&t.indexOf("/")!==-1)throw new j(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(Ve.fromString(t));if(!Y.isDocumentKey(r))throw new j(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return HI(n,new Y(r))}else{if(t instanceof Pt)return HI(n,t._key);throw new j(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wh(t)}.`)}}function _A(n,e){if(!Array.isArray(n)||n.length===0)throw new j(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function qj(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function rD(n,e){let t=jj(n.filters,qj(e.op));if(t!==null)throw t===e.op?new j(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new j(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function zj(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)rD(t,i),t=tS(t,i)}function jj(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function $j(n){let e=n.filter(r=>r instanceof q0).length,t=n.filter(r=>r instanceof U0).length;if(e>1||e>0&&t>0)throw new j(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var j0=class{convertValue(e,t="none"){switch(hs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Z()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Cs(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Wo].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ne(o.doubleValue));return new tc(s)}convertGeoPoint(e){return new ec(Ne(e.latitude),Ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=H0(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zl(e));default:return null}}convertTimestamp(e){let t=Vr(e);return new yt(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=Ve.fromString(e);Ee(_R(r));let i=new dh(r.get(1),r.get(3)),s=new Y(r.popFirst(5));return i.isEqual(t)||xn(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Gj(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}function bA(n){return Wj(n,["next","error","complete"])}function Wj(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Ss=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Fh=class extends Ph{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new ra(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(vS("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},ra=class extends Fh{data(e={}){return super.data(e)}},$0=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ss(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ra(this._firestore,this._userDataWriter,r.key,r,new Ss(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new j(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=Hj(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Hj(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new ra(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Ss(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new ra(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Ss(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:Kj(r.type),doc:i,oldIndex:s,newIndex:o}})}}function Kj(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Z()}}function iD(n){n=hr(n,Pt);let e=hr(n.firestore,Ur),t=pS(e);return pj(t,n._key).then(r=>lD(e,n,r))}var Lh=class extends j0{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jl(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pt(this.firestore,null,t)}};function sD(n,e,t,...r){n=hr(n,Pt);let i=hr(n.firestore,Ur),s=mS(i);e=nn(e);let o;typeof e=="string"||e instanceof na?o=Mj(s,"updateDoc",n._key,e,t,r):o=Oj(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Lr.exists(!0));return CS(i,[a])}function oD(n){let e=hr(n.firestore,Ur),t=[new Hl(n._key,Lr.none())];return CS(e,t)}function aD(n,e){let t=hr(n.firestore,Ur),r=fS(n),i=Gj(n.converter,e),s=mS(n.firestore),a=Dj(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Lr.exists(!1));return CS(t,[a]).then(()=>r)}function SS(n,...e){var t,r,i;n=nn(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!bA(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(bA(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof Pt)c=hr(n.firestore,Ur),u=Bh(n._key.path),l={next:f=>{e[o]&&e[o](lD(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=hr(n,vs);c=hr(f.firestore,Ur),u=f._query;let v=new Lh(c);l={next:b=>{e[o]&&e[o](new $0(c,v,f,b))},error:e[o+1],complete:e[o+2]},Vj(n._query)}let h=pS(c);return fj(h,u,a,l)}function CS(n,e){let t=pS(n);return mj(t,e)}function lD(n,e,t){let r=t.docs.get(e._key),i=new Lh(n);return new Fh(n,i,e._key,r,new Ss(t.hasPendingWrites,t.fromCache),e.converter)}Aj("node");var Kh=function(){return Kh=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Kh.apply(this,arguments)};var Xj={includeMetadataChanges:!1};function cD(n,e){return e===void 0&&(e=Xj),new zr(function(t){var r=SS(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function uD(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Kh(Kh({},r),(t={},t[e.idField]=n.id,t))}function dD(n){return cD(n,{includeMetadataChanges:!0}).pipe(le(function(e){return e.docs}))}function hD(n,e){return e===void 0&&(e={}),dD(n).pipe(le(function(t){return t.map(function(r){return uD(r,e)})}))}var bs=class{constructor(e){return e}},fD="firestore",_S=class{constructor(){return Ua(fD)}};var bS=new fe("angularfire2.firestore-instances");function Jj(n,e){let t=hp(fD,n,e);return t&&new bs(t)}function Zj(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new bs(r)}}var e6={provide:_S,deps:[[new Xt,bS]]},t6={provide:bs,useFactory:Jj,deps:[[new Xt,bS],Ir]};function wS(n,...e){return Ot("angularfire",Cn.full,"fst"),As([t6,e6,{provide:bS,useFactory:Zj(n),multi:!0,deps:[zt,Hr,Wi,qa,[new Xt,lu],[new Xt,ei],...e]}])}var ES=sn(hD,!0);var pD=sn(aD,!0);var lc=sn(YR,!0);var mD=sn(oD,!0);var Qh=sn(fS,!0);var gD=sn(iD,!0);var yD=sn(nD,!0);var vD=sn(tD,!0);var SD=sn(sD,!0);var oa=class n{constructor(e,t){this.authService=e;this.firestore=t}addCommande(e,t,r){return A(this,null,function*(){let i=yield this.authService.getUserId();if(console.log("userID",i),i){let s={userId:i,dateCommande:e,details:t,montant:r},o=lc(this.firestore,"orders");pD(o,s).then(()=>console.log("Order successfully added!")).catch(a=>console.error("Error adding order:",a))}})}getAllOrders(){let e=lc(this.firestore,"orders");return ES(e,{idField:"id"})}getOrderId(e){let t=lc(this.firestore,"orders"),r=Qh(this.firestore,"orders",e);return gD(r)}updateOrder(e){let t=Qh(this.firestore,"products",e);SD(t,{name:"updated name"}).then(()=>console.log(`Order with ${e} updated successfully !`)).catch(i=>console.log(i))}deleteOrder(e){let t=Qh(this.firestore,"orders",e);mD(t).then(()=>console.log("data deleted !")).catch(r=>console.log(r))}getUserOrders(e){let t=lc(this.firestore,"orders"),r=vD(t,yD("dateCommande","desc"));return ES(r,{idField:"id"}).pipe(le(i=>i.filter(s=>s.userId===e).map(s=>Ae(q({},s),{dateCommande:s.dateCommande.toDate()}))))}static \u0275fac=function(t){return new(t||n)(ae(ut),ae(bs))};static \u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})};function r6(n,e){if(n&1){let t=St();D(0,"tr")(1,"th",13),U(2),O(),D(3,"td"),ue(4,"img",14),U(5),O(),D(6,"td",15)(7,"img",16),Ce("click",function(){let i=Re(t).$implicit,s=$e();return De(s.decrement(i))}),O(),U(8),D(9,"img",17),Ce("click",function(){let i=Re(t).$implicit,s=$e();return De(s.increment(i))}),O()(),D(10,"td",15),U(11),Cr(12,"currency"),O(),D(13,"td",15)(14,"img",18),Ce("click",function(){let i=Re(t).$implicit,s=$e();return De(s.delete(i))}),O()()()}if(n&2){let t=e.$implicit,r=e.index;B(2),Dt(r+1),B(2),re("src",t.produit.thumbnail,mr),B(),Xe(" ",t.produit.title," "),B(3),Xe(" ",t.qte," "),B(3),Xe(" ",Kr(12,5,t.produit.price*t.qte,"USD","symbol","1.2-2")," ")}}function i6(n,e){if(n&1){let t=St();D(0,"div")(1,"div",19)(2,"button",20),Ce("click",function(){Re(t);let i=$e();return De(i.validerCommande())}),D(3,"span",21),ue(4,"i",22),U(5,"\xA0\xA0\xA0\xA0ORDER NOW"),O(),D(6,"span",23),U(7,"CLICK ME"),O()()()()}}var Yh=class n{constructor(e,t,r,i){this.panierService=e;this.commandeService=t;this.authService=r;this.router=i}detailPanier=[];totalPaymentPrice;ngOnInit(){this.detailPanier=this.panierService.getPanier(),this.totalPaymentPrice=this.panierService.updateTotalPrice()}increment(e){this.panierService.increaseQuantity(e),this.totalPaymentPrice=this.panierService.updateTotalPrice()}decrement(e){this.panierService.decreaseQuantity(e),this.totalPaymentPrice=this.panierService.updateTotalPrice()}delete(e){this.panierService.remove(e),this.totalPaymentPrice=this.panierService.updateTotalPrice()}validerCommande(){this.authService.isAuthenticated()?confirm("Are you sure you want to confirm your order?")&&(this.commandeService.addCommande(new Date,this.detailPanier,this.totalPaymentPrice),alert("Your order has been confirmed!")):(alert("Please log in to confirm your order."),this.router.navigate(["/login"]))}static \u0275fac=function(t){return new(t||n)(G(Js),G(oa),G(ut),G(Le))};static \u0275cmp=Qe({type:n,selectors:[["app-panier"]],standalone:!0,features:[Je],decls:31,vars:8,consts:[[1,"container"],[1,"row","align-items-start"],[1,"col-md-6"],[1,"table","mt-3",2,"width","100%"],["scope","col"],[4,"ngFor","ngForOf"],["id","panier-items"],[1,"text-center","mt-3","py-3"],[2,"color","#fb774b","font-weight","700"],["src","shopping-bags.png",2,"height","80px"],[1,"mx-auto"],["src","check-mark.png",2,"height","30px"],[4,"ngIf"],["scope","row",1,"py-3"],[1,"img-thumbnail","me-2",2,"width","50px",3,"src"],[1,"py-3"],["src","minus.png",2,"width","20px","cursor","pointer",3,"click"],["src","plus1.png",2,"width","20px","cursor","pointer",3,"click"],["src","supprimer.png","alt","icon",2,"width","40px","cursor","pointer",3,"click"],[1,"container","d-flex","justify-content-center","mt-4"],[1,"order",3,"click"],[1,"text1"],[1,"fa-brands","fa-opencart"],[1,"text2"]],template:function(t,r){t&1&&(ue(0,"app-navbar"),D(1,"div",0)(2,"div",1)(3,"div",2)(4,"table",3)(5,"thead")(6,"tr")(7,"th",4),U(8,"#"),O(),D(9,"th",4),U(10,"Item"),O(),D(11,"th",4),U(12,"Quantity"),O(),D(13,"th",4),U(14,"Price"),O()()(),D(15,"tbody"),Ue(16,r6,15,10,"tr",5),O()()(),D(17,"div",2)(18,"section",6)(19,"div",7)(20,"h3",8),U(21,"Review Your Cart"),O(),ue(22,"img",9)(23,"hr",10),D(24,"p"),ue(25,"img",11),U(26," Check your cart items before validation."),O(),D(27,"h3",8),U(28),Cr(29,"currency"),O()(),Ue(30,i6,8,0,"div",12),O()()()()),t&2&&(B(16),re("ngForOf",r.detailPanier),B(12),Xe("Total Price : ",Kr(29,3,r.totalPaymentPrice,"USD","symbol","1.2-2"),""),B(2),re("ngIf",r.totalPaymentPrice!=0))},dependencies:[tn,Un,en,Ms,$n,Nt],styles:["*[_ngcontent-%COMP%]{padding:0;box-sizing:border-box}.order[_ngcontent-%COMP%]{position:relative;border-radius:50px;border:none;outline:none;background-image:linear-gradient(50deg,#ffb700 20%,#14dd7f 80%);width:280px;height:50px;color:#fff;overflow-y:hidden;font-size:22px}span[_ngcontent-%COMP%]{position:absolute;width:100%;top:50%;left:50%;transform:translate(-50%,-50%);transition:.3s}.text2[_ngcontent-%COMP%]{top:-100%}.order[_ngcontent-%COMP%]:hover{background-image:linear-gradient(50deg,#14dd7f 20%,#ffb700 80%)}.order[_ngcontent-%COMP%]:hover   .text1[_ngcontent-%COMP%]{opacity:0}.order[_ngcontent-%COMP%]:hover   .text2[_ngcontent-%COMP%]{top:50%}"]})};function s6(n,e){if(n&1&&(D(0,"div",19),ue(1,"img",20),O()),n&2){let t=e.$implicit;B(),re("src",t,mr)}}function o6(n,e){if(n&1&&(D(0,"div",21),U(1),O()),n&2){let t=$e();B(),Xe(" ",t.submissionMessage," ")}}var Xh=class n{constructor(e,t,r){this.productService=e;this.route=t;this.fb=r;this.commentForm=this.fb.group({comment:["",[Ya.required,Ya.minLength(5)]]})}stars=[1,2,3,4,5];fullStars=0;hasHalfStar=!1;detailsProduct;commentForm;selectedRating=3;submissionMessage=null;ngOnInit(){let e=this.route.snapshot.params.id;this.productService.getProductDetailsById(+e).subscribe(t=>{this.detailsProduct=t,this.calculateRatingStars(),console.log(t)},t=>{console.log("Error fetching products details",t)}),this.calculateRatingStars(),this.commentForm=this.fb.group({comment:[""]})}calculateRatingStars(){if(this.detailsProduct){let e=this.detailsProduct.rating;this.fullStars=Math.floor(e),this.hasHalfStar=e%1>=.5}}getRating(e){let t=e.target.closest(".rating");this.selectedRating=+t.getAttribute("data-coreui-value"),console.log("Rating selected:",this.selectedRating)}submitComment(){this.commentForm.valid&&(this.submissionMessage="Your comment has been submitted!",this.commentForm.reset())}static \u0275fac=function(t){return new(t||n)(G(Gn),G(jn),G(cb))};static \u0275cmp=Qe({type:n,selectors:[["app-details-produit"]],standalone:!0,features:[Je],decls:32,vars:14,consts:[[1,"container","sproduct","my-3","py-4"],[1,"row","mt-5"],[1,"col-lg-5","col-md-12","col-12","product-images"],["alt","product-img",1,"img-fluid","main-img",3,"src"],[1,"small-img-group","mt-1"],["class","small-img-col",4,"ngFor","ngForOf"],[1,"col-lg-5","col-md-12","col-12","product-details"],[1,"py-4"],[1,"quantity-group"],["type","number","value","1",1,"quantity-input"],[1,"buy-btn"],[1,"mt-2","mb-5"],[1,"comment-section"],[1,"comment-title"],["data-coreui-toggle","rating","data-coreui-value","3",1,"rating"],[1,"comment-form",3,"ngSubmit","formGroup"],["formControlName","comment","placeholder","Leave your comment here...",1,"comment-textarea"],["type","submit",1,"comment-submit",3,"disabled"],["class","submission-message",4,"ngIf"],[1,"small-img-col"],[1,"small-img",3,"src"],[1,"submission-message"]],template:function(t,r){t&1&&(ue(0,"app-navbar"),D(1,"section",0)(2,"div",1)(3,"div",2),ue(4,"img",3),D(5,"div",4),Ue(6,s6,2,1,"div",5),O()(),D(7,"div",6)(8,"h6"),U(9),O(),D(10,"h3",7),U(11),O(),D(12,"h2"),U(13),Cr(14,"currency"),O(),D(15,"div",8),ue(16,"input",9),O(),D(17,"button",10),U(18,"Add To Cart"),O(),D(19,"h4",11),U(20,"Product Details"),O(),D(21,"p"),U(22),O()()()(),D(23,"div",12)(24,"h4",13),U(25,"How satisfied are you?"),O(),ue(26,"div",14),D(27,"form",15),Ce("ngSubmit",function(){return r.submitComment()}),ue(28,"textarea",16),D(29,"button",17),U(30,"Submit"),O()(),Ue(31,o6,2,1,"div",18),O()),t&2&&(B(4),re("src",r.detailsProduct.images[0],mr),B(2),re("ngForOf",r.detailsProduct.images.slice(1)),B(3),Xe("Home / ",r.detailsProduct.category,""),B(2),Dt(r.detailsProduct.title),B(2),Dt(Kr(14,9,r.detailsProduct.price,"USD","symbol","1.2-2")),B(9),Dt(r.detailsProduct.description),B(5),re("formGroup",r.commentForm),B(2),re("disabled",!r.commentForm.valid),B(2),re("ngIf",r.submissionMessage&&r.commentForm.valid))},dependencies:[tn,Un,en,Ms,Nt,ub,Ys,Wn,ii,Qs,Pp,Np],styles:[".sproduct[_ngcontent-%COMP%]{padding:2rem;background-color:#f5f5f5}.product-images[_ngcontent-%COMP%]{text-align:center;width:400px}.main-img[_ngcontent-%COMP%]{width:100%;border-radius:8px;box-shadow:0 4px 8px #0000001a}.small-img-group[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-top:10px}.small-img-col[_ngcontent-%COMP%]{flex-basis:30%;cursor:pointer}.small-img[_ngcontent-%COMP%]{width:100%;border-radius:4px;transition:transform .3s ease}.small-img[_ngcontent-%COMP%]:hover{transform:scale(1.1);box-shadow:0 4px 8px #0003}.product-details[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:14px;color:#888;margin-bottom:10px}.product-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;margin-bottom:1rem}.product-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;color:#333;font-weight:700;margin-bottom:1rem}.quantity-group[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1rem}.quantity-input[_ngcontent-%COMP%]{width:60px;height:40px;border:1px solid #ddd;text-align:center;font-size:1rem;border-radius:4px}.buy-btn[_ngcontent-%COMP%]{background-color:#fb774b;color:#fff;padding:10px 20px;border:none;border-radius:4px;font-size:16px;cursor:pointer;transition:background-color .3s ease;box-shadow:0 4px 6px #0000001a}.buy-btn[_ngcontent-%COMP%]:hover{background-color:#e9653b}.product-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:1.5;color:#555;font-size:1rem;margin-top:20px}.product-details[_ngcontent-%COMP%]{padding-top:1.5rem}.comment-box[_ngcontent-%COMP%]{width:100%;border-radius:8px;padding:10px;font-size:1rem;border:1px solid #ddd;resize:none;box-shadow:0 2px 4px #0000001a}.comment-box[_ngcontent-%COMP%]:focus{outline:none;border-color:#fb774b;box-shadow:0 2px 8px #0003}.submit-btn[_ngcontent-%COMP%]{background-color:#fb774b;color:#fff;padding:10px 20px;border:none;border-radius:4px;font-size:16px;cursor:pointer;transition:background-color .3s ease;box-shadow:0 4px 6px #0000001a}.submit-btn[_ngcontent-%COMP%]:hover{background-color:#e9653b}.rating[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:10px 0;font-size:24px}.rating[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:#fb774b}.comment-section[_ngcontent-%COMP%]{margin:2rem auto;width:80%;max-width:500px;background-color:#fff;padding:1.5rem;border-radius:8px;box-shadow:0 2px 10px #0000001a;text-align:center}.comment-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:1rem;color:#333}.rating[_ngcontent-%COMP%]{margin-bottom:1rem}.comment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.comment-textarea[_ngcontent-%COMP%]{width:100%;height:100px;border:1px solid #ddd;border-radius:4px;padding:10px;resize:none;font-size:1rem;margin-bottom:1rem}.comment-submit[_ngcontent-%COMP%]{background-color:#fb774b;color:#fff;padding:10px;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s ease}.comment-submit[_ngcontent-%COMP%]:hover{background-color:#e9653b}.submission-message[_ngcontent-%COMP%]{margin-top:1rem;font-size:1rem;color:#28a745;font-weight:700}"]})};var a6=()=>["/sign-up"];function l6(n,e){n&1&&(D(0,"small",14),U(1,"L'email est obligatoire."),O())}function c6(n,e){n&1&&(D(0,"small",14),U(1,"L'email est incorrect."),O())}function u6(n,e){if(n&1&&(D(0,"div"),Ue(1,l6,2,0,"small",13)(2,c6,2,0,"small",13),O()),n&2){$e();let t=Zt(8);B(),re("ngIf",t.errors==null?null:t.errors.required),B(),re("ngIf",t.errors==null?null:t.errors.email)}}function d6(n,e){n&1&&(D(0,"small",14),U(1,"Le mot de passe est obligatoire."),O())}function h6(n,e){n&1&&(D(0,"small",14),U(1,"Le mot de passe doit contenir au moins 6 caract\xE8res."),O())}function f6(n,e){if(n&1&&(D(0,"div"),Ue(1,d6,2,0,"small",13)(2,h6,2,0,"small",13),O()),n&2){$e();let t=Zt(12);B(),re("ngIf",t.errors==null?null:t.errors.required),B(),re("ngIf",t.errors==null?null:t.errors.minlength)}}var Jh=class n{constructor(e,t){this.authService=e;this.router=t}email="";password="";onSubmit(){this.authService.login(this.email,this.password)}SignIn(){this.authService.login(this.email,this.password),this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||n)(G(ut),G(Le))};static \u0275cmp=Qe({type:n,selectors:[["app-auth"]],standalone:!0,features:[Je],decls:20,vars:7,consts:[["loginForm","ngForm"],["emailModel","ngModel"],["passwordModel","ngModel"],[1,"login-container"],[1,"login-form",3,"ngSubmit"],[1,"login-title"],[1,"form-group"],["type","email","id","email","name","email","placeholder","Email","required","","email","",1,"form-control",3,"ngModelChange","ngModel"],[4,"ngIf"],["type","password","id","password","name","password","placeholder","Password","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit",3,"click","disabled"],[1,"signup-text"],[1,"signup-link",3,"routerLink"],["class","error-message",4,"ngIf"],[1,"error-message"]],template:function(t,r){if(t&1){let i=St();ue(0,"app-navbar"),D(1,"div",3)(2,"form",4,0),Ce("ngSubmit",function(){return Re(i),De(r.onSubmit())}),D(4,"h2",5),U(5,"Sign In"),O(),D(6,"div",6)(7,"input",7,1),vr("ngModelChange",function(o){return Re(i),yr(r.email,o)||(r.email=o),De(o)}),O(),Ue(9,u6,3,2,"div",8),O(),D(10,"div",6)(11,"input",9,2),vr("ngModelChange",function(o){return Re(i),yr(r.password,o)||(r.password=o),De(o)}),O(),Ue(13,f6,3,2,"div",8),O(),D(14,"button",10),Ce("click",function(){return Re(i),De(r.SignIn())}),U(15," Login "),O(),D(16,"p",11),U(17," Not registered yet? "),D(18,"a",12),U(19,"Sign Up"),O()()()()}if(t&2){let i=Zt(3),s=Zt(8),o=Zt(12);B(7),gr("ngModel",r.email),B(2),re("ngIf",s.touched&&s.invalid),B(2),gr("ngModel",r.password),B(2),re("ngIf",o.touched&&o.invalid),B(),re("disabled",!i.valid),B(4),re("routerLink",qi(6,a6))}},dependencies:[Xs,Ys,Wn,ii,Qs,Za,Vp,Lp,Qi,Ja,Nt,$n,Jr,tn,en],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;background-color:#f5f5f5}.login-form[_ngcontent-%COMP%]{background-color:#fff;padding:40px;border-radius:8px;box-shadow:0 4px 8px #0000001a;width:400px;max-width:100%;text-align:center}.login-title[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:20px;color:#333;font-weight:700}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-control[_ngcontent-%COMP%]{width:100%;padding:15px;border:1px solid #ccc;border-radius:4px;font-size:16px;outline:none}.form-control[_ngcontent-%COMP%]:focus{border-color:#fb774b}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:15px;background-color:#fb774b;border:none;color:#fff;border-radius:4px;cursor:pointer;font-size:16px}.btn-submit[_ngcontent-%COMP%]:disabled{background-color:#aaa;cursor:not-allowed}.signup-text[_ngcontent-%COMP%]{margin-top:20px;font-size:14px;color:#666}.signup-link[_ngcontent-%COMP%]{color:#fb774b;text-decoration:none;font-weight:700}.signup-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.error-message[_ngcontent-%COMP%], .error-message-email[_ngcontent-%COMP%], .error-message-password[_ngcontent-%COMP%]{color:#e74c3c;font-size:14px;margin-top:5px;text-align:left;display:block}.form-group.invalid[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-color:#e74c3c}.form-group.invalid[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{border-color:#e74c3c;box-shadow:0 0 5px #e74c3c80}"]})};var p6=()=>["/auth"],Zh=class n{constructor(e){this.authService=e}email="";username="";password="";onSubmit(){console.log("Created user "),this.authService.SignUp(this.email,this.username,this.password)}static \u0275fac=function(t){return new(t||n)(G(ut))};static \u0275cmp=Qe({type:n,selectors:[["app-sign-up"]],standalone:!0,features:[Je],decls:18,vars:6,consts:[["signUpForm","ngForm"],[1,"signup-container"],[1,"signup-form",3,"ngSubmit"],[1,"signup-title"],[1,"form-group"],["type","email","id","email","name","email","placeholder","Email","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","username","name","username","placeholder","Username","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","name","password","placeholder","Password","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit",3,"disabled"],[1,"login-text"],[1,"login-link",3,"routerLink"]],template:function(t,r){if(t&1){let i=St();ue(0,"app-navbar"),D(1,"div",1)(2,"form",2,0),Ce("ngSubmit",function(){return Re(i),De(r.onSubmit())}),D(4,"h2",3),U(5,"Sign Up"),O(),D(6,"div",4)(7,"input",5),vr("ngModelChange",function(o){return Re(i),yr(r.email,o)||(r.email=o),De(o)}),O()(),D(8,"div",4)(9,"input",6),vr("ngModelChange",function(o){return Re(i),yr(r.username,o)||(r.username=o),De(o)}),O()(),D(10,"div",4)(11,"input",7),vr("ngModelChange",function(o){return Re(i),yr(r.password,o)||(r.password=o),De(o)}),O()(),D(12,"button",8),U(13," Sign Up "),O(),D(14,"p",9),U(15," Already have an account? "),D(16,"a",10),U(17,"Sign In"),O()()()()}if(t&2){let i=Zt(3);B(7),gr("ngModel",r.email),B(2),gr("ngModel",r.username),B(2),gr("ngModel",r.password),B(),re("disabled",!i.valid),B(4),re("routerLink",qi(5,p6))}},dependencies:[Xs,Ys,Wn,ii,Qs,Za,Qi,Ja,Nt,$n,Jr],styles:[".signup-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;background-color:#f5f5f5}.signup-form[_ngcontent-%COMP%]{background-color:#fff;padding:40px;border-radius:8px;box-shadow:0 4px 8px #0000001a;width:400px;max-width:100%;text-align:center}.signup-title[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:20px;color:#333;font-weight:700}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-control[_ngcontent-%COMP%]{width:100%;padding:15px;border:1px solid #ccc;border-radius:4px;font-size:16px;outline:none}.form-control[_ngcontent-%COMP%]:focus{border-color:#fb774b}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:15px;background-color:#fb774b;border:none;color:#fff;border-radius:4px;cursor:pointer;font-size:16px}.btn-submit[_ngcontent-%COMP%]:disabled{background-color:#aaa;cursor:not-allowed}.login-text[_ngcontent-%COMP%]{margin-top:20px;font-size:14px;color:#666}.login-link[_ngcontent-%COMP%]{color:#fb774b;text-decoration:none;font-weight:700}.login-link[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})};function m6(n,e){if(n&1&&(D(0,"tr")(1,"th",12),U(2),O(),D(3,"td"),ue(4,"img",13),U(5),O(),D(6,"td"),U(7),O(),D(8,"td"),U(9),Cr(10,"currency"),O()()),n&2){let t=e.$implicit,r=e.index;B(2),Dt(r+1),B(2),re("src",t.produit.thumbnail,mr),B(),Xe(" ",t.produit.title," "),B(2),Dt(t.qte),B(2),Dt(Kr(10,5,t.produit.price*t.qte,"USD","symbol","1.2-2"))}}function g6(n,e){if(n&1&&(D(0,"div",4)(1,"div",5)(2,"div",6),U(3),Cr(4,"date"),O(),D(5,"div",7)(6,"h5",8),U(7),Cr(8,"currency"),O(),D(9,"table",9)(10,"thead")(11,"tr")(12,"th",10),U(13,"#"),O(),D(14,"th",10),U(15,"Item"),O(),D(16,"th",10),U(17,"Quantity"),O(),D(18,"th",10),U(19,"Price"),O()()(),D(20,"tbody"),Ue(21,m6,11,10,"tr",11),O()()()()()),n&2){let t=e.$implicit;B(3),Xe(" Order Date: ",HS(4,3,t.dateCommande,"MM/dd/yyyy")," "),B(4),Xe("Order Total: ",Kr(8,6,t.montant,"USD","symbol","1.2-2"),""),B(14),re("ngForOf",t.details)}}var ef=class n{constructor(e,t){this.commandeService=e;this.authService=t}userOrders=[];ngOnInit(){this.authService.getUserId().then(e=>{e&&(console.log(e),this.commandeService.getUserOrders(e).subscribe(t=>{this.userOrders=t,console.log(t)}))})}static \u0275fac=function(t){return new(t||n)(G(oa),G(ut))};static \u0275cmp=Qe({type:n,selectors:[["app-orders"]],standalone:!0,features:[Je],decls:6,vars:1,consts:[[1,"container","mt-5"],[2,"color","#fb774b","text-align","center","font-weight","700"],[1,"mb-4",2,"border-top","2px solid #fb774b","width","50%","margin","auto"],["class","order-card mt-4",4,"ngFor","ngForOf"],[1,"order-card","mt-4"],[1,"card","border-secondary","mb-3"],[1,"card-header",2,"background-color","#fb774b","color","white"],[1,"card-body"],[1,"card-title",2,"color","#fb774b"],[1,"table","table-hover","mt-3"],["scope","col"],[4,"ngFor","ngForOf"],["scope","row"],[1,"img-thumbnail","me-2",2,"width","50px",3,"src"]],template:function(t,r){t&1&&(ue(0,"app-navbar"),D(1,"div",0)(2,"h2",1),U(3,"My Orders"),O(),ue(4,"hr",2),Ue(5,g6,22,11,"div",3),O()),t&2&&(B(5),re("ngForOf",r.userOrders))},dependencies:[Nt,tn,Un,Ms,rC],styles:[".order-card[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border:1px solid #fb774b;border-radius:5px}.order-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{font-weight:700}.order-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:20px}"]})};var tf=class n{constructor(e,t){this.authService=e;this.router=t}canActivate(e,t){return this.authService.isLoggedIn$.pipe(le(r=>(r||this.router.navigate(["/auth"]),r)))}static \u0275fac=function(t){return new(t||n)(ae(ut),ae(Le))};static \u0275prov=he({token:n,factory:n.\u0275fac,providedIn:"root"})};var _D=[{path:"",component:el},{path:"produits",component:el},{path:"panier",component:Yh},{path:"produits/:id",component:Xh},{path:"auth",component:Jh},{path:"sign-up",component:Zh},{path:"orders",component:ef,canActivate:[tf]}];var nf=class n{constructor(e,t){this.router=e;this.authService=t}intercept(e,t){if(this.authService.isLoggedIn$){let i=e.clone({headers:e.headers.set("Authorization","Bearer"+this.authService.getToken)});return t.handle(i)}return t.handle(e)}static \u0275fac=function(t){return new(t||n)(ae(Le),ae(ut))};static \u0275prov=he({token:n,factory:n.\u0275fac})};var TS={apiKey:"AIzaSyCWwlpnAlWszxCRgU3Sh5Y8pQbZOoQn5OU",authDomain:"e-commerce-efdf0.firebaseapp.com",projectId:"e-commerce-efdf0",storageBucket:"e-commerce-efdf0.appspot.com",messagingSenderId:"442217784507",appId:"1:442217784507:web:75a53255fdefae5a5e759e",measurementId:"G-12CM6T2H50"},bD={providers:[bf({eventCoalescing:!0}),u_(_D),hC(),lC(),wS(()=>Hh()),bf({eventCoalescing:!0}),gp(()=>Sc(TS)),wS(()=>Hh()),la(Ir),gp(()=>Sc(TS)),la(y_.initializeApp(TS)),la(ja),la(O_),{provide:aC,useClass:nf,multi:!0}]};var y6={providers:[fC()]},wD=XS(bD,y6);var v6=()=>uC(Uc,wD),o8=v6;export{o8 as a};
